const AppState = {
            lat: 21.3891,
            lng: 39.8579,
            method: 4,
            times: null,
            isMuted: true,
            clickSound: true,
            vibration: true,
            compassActive: false,
            notifications: true,
            currentMonth: new Date().getMonth() + 1,
            currentYear: new Date().getFullYear(),
            weatherEnabled: true,
            geolocationEnabled: true,
            lastWeatherUpdate: null,
            quizScore: 0,
            currentQuestion: 0,
            selectedCardBackground: 0,
            selectedLogo: 'mosque',
            currentSurah: null,
            currentQari: 'abdul_basit',
            quizQuestions: [],
            availableQuestions: [],
            currentDhikrIndex: 0,
            compassWatchId: null,
            currentHeading: 0,
            prayerTracker: {
                today: null,
                history: []
            },
            dailyAchievements: {
                prayers: 0,
                quranMinutes: 0,
                lastReset: null
            }
        };
        
        // ==================== ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© ====================
        const Constants = {
            prayerKeys: ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"],
            prayerNames: { Fajr:"ÿßŸÑŸÅÿ¨ÿ±", Sunrise:"ÿßŸÑÿ¥ÿ±ŸàŸÇ", Dhuhr:"ÿßŸÑÿ∏Ÿáÿ±", Asr:"ÿßŸÑÿπÿµÿ±", Maghrib:"ÿßŸÑŸÖÿ∫ÿ±ÿ®", Isha:"ÿßŸÑÿπÿ¥ÿßÿ°" },
            prayerIcons: { Fajr:"fa-cloud-sun", Sunrise:"fa-sun", Dhuhr:"fa-sun", Asr:"fa-cloud", Maghrib:"fa-moon", Isha:"fa-star" },
            
// 1. ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≥Ÿàÿ± ŸÉÿßŸÖŸÑÿ© (114 ÿ≥Ÿàÿ±ÿ©)
surahList: [
    { id: 1, name: "ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©", audioId: "001" }, { id: 2, name: "ÿßŸÑÿ®ŸÇÿ±ÿ©", audioId: "002" }, { id: 3, name: "ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ", audioId: "003" },
    { id: 4, name: "ÿßŸÑŸÜÿ≥ÿßÿ°", audioId: "004" }, { id: 5, name: "ÿßŸÑŸÖÿßÿ¶ÿØÿ©", audioId: "005" }, { id: 6, name: "ÿßŸÑÿ£ŸÜÿπÿßŸÖ", audioId: "006" },
    { id: 7, name: "ÿßŸÑÿ£ÿπÿ±ÿßŸÅ", audioId: "007" }, { id: 8, name: "ÿßŸÑÿ£ŸÜŸÅÿßŸÑ", audioId: "008" }, { id: 9, name: "ÿßŸÑÿ™Ÿàÿ®ÿ©", audioId: "009" },
    { id: 10, name: "ŸäŸàŸÜÿ≥", audioId: "010" }, { id: 11, name: "ŸáŸàÿØ", audioId: "011" }, { id: 12, name: "ŸäŸàÿ≥ŸÅ", audioId: "012" },
    { id: 13, name: "ÿßŸÑÿ±ÿπÿØ", audioId: "013" }, { id: 14, name: "ÿ•ÿ®ÿ±ÿßŸáŸäŸÖ", audioId: "014" }, { id: 15, name: "ÿßŸÑÿ≠ÿ¨ÿ±", audioId: "015" },
    { id: 16, name: "ÿßŸÑŸÜÿ≠ŸÑ", audioId: "016" }, { id: 17, name: "ÿßŸÑÿ•ÿ≥ÿ±ÿßÿ°", audioId: "017" }, { id: 18, name: "ÿßŸÑŸÉŸáŸÅ", audioId: "018" },
    { id: 19, name: "ŸÖÿ±ŸäŸÖ", audioId: "019" }, { id: 20, name: "ÿ∑Ÿá", audioId: "020" }, { id: 21, name: "ÿßŸÑÿ£ŸÜÿ®Ÿäÿßÿ°", audioId: "021" },
    { id: 22, name: "ÿßŸÑÿ≠ÿ¨", audioId: "022" }, { id: 23, name: "ÿßŸÑŸÖÿ§ŸÖŸÜŸàŸÜ", audioId: "023" }, { id: 24, name: "ÿßŸÑŸÜŸàÿ±", audioId: "024" },
    { id: 25, name: "ÿßŸÑŸÅÿ±ŸÇÿßŸÜ", audioId: "025" }, { id: 26, name: "ÿßŸÑÿ¥ÿπÿ±ÿßÿ°", audioId: "026" }, { id: 27, name: "ÿßŸÑŸÜŸÖŸÑ", audioId: "027" },
    { id: 28, name: "ÿßŸÑŸÇÿµÿµ", audioId: "028" }, { id: 29, name: "ÿßŸÑÿπŸÜŸÉÿ®Ÿàÿ™", audioId: "029" }, { id: 30, name: "ÿßŸÑÿ±ŸàŸÖ", audioId: "030" },
    { id: 31, name: "ŸÑŸÇŸÖÿßŸÜ", audioId: "031" }, { id: 32, name: "ÿßŸÑÿ≥ÿ¨ÿØÿ©", audioId: "032" }, { id: 33, name: "ÿßŸÑÿ£ÿ≠ÿ≤ÿßÿ®", audioId: "033" },
    { id: 34, name: "ÿ≥ÿ®ÿ£", audioId: "034" }, { id: 35, name: "ŸÅÿßÿ∑ÿ±", audioId: "035" }, { id: 36, name: "Ÿäÿ≥", audioId: "036" },
    { id: 37, name: "ÿßŸÑÿµÿßŸÅÿßÿ™", audioId: "037" }, { id: 38, name: "ÿµ", audioId: "038" }, { id: 39, name: "ÿßŸÑÿ≤ŸÖÿ±", audioId: "039" },
    { id: 40, name: "ÿ∫ÿßŸÅÿ±", audioId: "040" }, { id: 41, name: "ŸÅÿµŸÑÿ™", audioId: "041" }, { id: 42, name: "ÿßŸÑÿ¥Ÿàÿ±Ÿâ", audioId: "042" },
    { id: 43, name: "ÿßŸÑÿ≤ÿÆÿ±ŸÅ", audioId: "043" }, { id: 44, name: "ÿßŸÑÿØÿÆÿßŸÜ", audioId: "044" }, { id: 45, name: "ÿßŸÑÿ¨ÿßÿ´Ÿäÿ©", audioId: "045" },
    { id: 46, name: "ÿßŸÑÿ£ÿ≠ŸÇÿßŸÅ", audioId: "046" }, { id: 47, name: "ŸÖÿ≠ŸÖÿØ", audioId: "047" }, { id: 48, name: "ÿßŸÑŸÅÿ™ÿ≠", audioId: "048" },
    { id: 49, name: "ÿßŸÑÿ≠ÿ¨ÿ±ÿßÿ™", audioId: "049" }, { id: 50, name: "ŸÇ", audioId: "050" }, { id: 51, name: "ÿßŸÑÿ∞ÿßÿ±Ÿäÿßÿ™", audioId: "051" },
    { id: 52, name: "ÿßŸÑÿ∑Ÿàÿ±", audioId: "052" }, { id: 53, name: "ÿßŸÑŸÜÿ¨ŸÖ", audioId: "053" }, { id: 54, name: "ÿßŸÑŸÇŸÖÿ±", audioId: "054" },
    { id: 55, name: "ÿßŸÑÿ±ÿ≠ŸÖŸÜ", audioId: "055" }, { id: 56, name: "ÿßŸÑŸàÿßŸÇÿπÿ©", audioId: "056" }, { id: 57, name: "ÿßŸÑÿ≠ÿØŸäÿØ", audioId: "057" },
    { id: 58, name: "ÿßŸÑŸÖÿ¨ÿßÿØŸÑÿ©", audioId: "058" }, { id: 59, name: "ÿßŸÑÿ≠ÿ¥ÿ±", audioId: "059" }, { id: 60, name: "ÿßŸÑŸÖŸÖÿ™ÿ≠ŸÜÿ©", audioId: "060" },
    { id: 61, name: "ÿßŸÑÿµŸÅ", audioId: "061" }, { id: 62, name: "ÿßŸÑÿ¨ŸÖÿπÿ©", audioId: "062" }, { id: 63, name: "ÿßŸÑŸÖŸÜÿßŸÅŸÇŸàŸÜ", audioId: "063" },
    { id: 64, name: "ÿßŸÑÿ™ÿ∫ÿßÿ®ŸÜ", audioId: "064" }, { id: 65, name: "ÿßŸÑÿ∑ŸÑÿßŸÇ", audioId: "065" }, { id: 66, name: "ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÖ", audioId: "066" },
    { id: 67, name: "ÿßŸÑŸÖŸÑŸÉ", audioId: "067" }, { id: 68, name: "ÿßŸÑŸÇŸÑŸÖ", audioId: "068" }, { id: 69, name: "ÿßŸÑÿ≠ÿßŸÇÿ©", audioId: "069" },
    { id: 70, name: "ÿßŸÑŸÖÿπÿßÿ±ÿ¨", audioId: "070" }, { id: 71, name: "ŸÜŸàÿ≠", audioId: "071" }, { id: 72, name: "ÿßŸÑÿ¨ŸÜ", audioId: "072" },
    { id: 73, name: "ÿßŸÑŸÖÿ≤ŸÖŸÑ", audioId: "073" }, { id: 74, name: "ÿßŸÑŸÖÿØÿ´ÿ±", audioId: "074" }, { id: 75, name: "ÿßŸÑŸÇŸäÿßŸÖÿ©", audioId: "075" },
    { id: 76, name: "ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜ", audioId: "076" }, { id: 77, name: "ÿßŸÑŸÖÿ±ÿ≥ŸÑÿßÿ™", audioId: "077" }, { id: 78, name: "ÿßŸÑŸÜÿ®ÿ£", audioId: "078" },
    { id: 79, name: "ÿßŸÑŸÜÿßÿ≤ÿπÿßÿ™", audioId: "079" }, { id: 80, name: "ÿπÿ®ÿ≥", audioId: "080" }, { id: 81, name: "ÿßŸÑÿ™ŸÉŸàŸäÿ±", audioId: "081" },
    { id: 82, name: "ÿßŸÑÿßŸÜŸÅÿ∑ÿßÿ±", audioId: "082" }, { id: 83, name: "ÿßŸÑŸÖÿ∑ŸÅŸÅŸäŸÜ", audioId: "083" }, { id: 84, name: "ÿßŸÑÿßŸÜÿ¥ŸÇÿßŸÇ", audioId: "084" },
    { id: 85, name: "ÿßŸÑÿ®ÿ±Ÿàÿ¨", audioId: "085" }, { id: 86, name: "ÿßŸÑÿ∑ÿßÿ±ŸÇ", audioId: "086" }, { id: 87, name: "ÿßŸÑÿ£ÿπŸÑŸâ", audioId: "087" },
    { id: 88, name: "ÿßŸÑÿ∫ÿßÿ¥Ÿäÿ©", audioId: "088" }, { id: 89, name: "ÿßŸÑŸÅÿ¨ÿ±", audioId: "089" }, { id: 90, name: "ÿßŸÑÿ®ŸÑÿØ", audioId: "090" },
    { id: 91, name: "ÿßŸÑÿ¥ŸÖÿ≥", audioId: "091" }, { id: 92, name: "ÿßŸÑŸÑŸäŸÑ", audioId: "092" }, { id: 93, name: "ÿßŸÑÿ∂ÿ≠Ÿâ", audioId: "093" },
    { id: 94, name: "ÿßŸÑÿ¥ÿ±ÿ≠", audioId: "094" }, { id: 95, name: "ÿßŸÑÿ™ŸäŸÜ", audioId: "095" }, { id: 96, name: "ÿßŸÑÿπŸÑŸÇ", audioId: "096" },
    { id: 97, name: "ÿßŸÑŸÇÿØÿ±", audioId: "097" }, { id: 98, name: "ÿßŸÑÿ®ŸäŸÜÿ©", audioId: "098" }, { id: 99, name: "ÿßŸÑÿ≤ŸÑÿ≤ŸÑÿ©", audioId: "099" },
    { id: 100, name: "ÿßŸÑÿπÿßÿØŸäÿßÿ™", audioId: "100" }, { id: 101, name: "ÿßŸÑŸÇÿßÿ±ÿπÿ©", audioId: "101" }, { id: 102, name: "ÿßŸÑÿ™ŸÉÿßÿ´ÿ±", audioId: "102" },
    { id: 103, name: "ÿßŸÑÿπÿµÿ±", audioId: "103" }, { id: 104, name: "ÿßŸÑŸáŸÖÿ≤ÿ©", audioId: "104" }, { id: 105, name: "ÿßŸÑŸÅŸäŸÑ", audioId: "105" },
    { id: 106, name: "ŸÇÿ±Ÿäÿ¥", audioId: "106" }, { id: 107, name: "ÿßŸÑŸÖÿßÿπŸàŸÜ", audioId: "107" }, { id: 108, name: "ÿßŸÑŸÉŸàÿ´ÿ±", audioId: "108" },
    { id: 109, name: "ÿßŸÑŸÉÿßŸÅÿ±ŸàŸÜ", audioId: "109" }, { id: 110, name: "ÿßŸÑŸÜÿµÿ±", audioId: "110" }, { id: 111, name: "ÿßŸÑŸÖÿ≥ÿØ", audioId: "111" },
    { id: 112, name: "ÿßŸÑÿ•ÿÆŸÑÿßÿµ", audioId: "112" }, { id: 113, name: "ÿßŸÑŸÅŸÑŸÇ", audioId: "113" }, { id: 114, name: "ÿßŸÑŸÜÿßÿ≥", audioId: "114" }
],



    // ==================== ÿ£ÿ∂ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿØÿßÿÆŸÑ Constants ====================
    
    // 1. ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ¥Ÿáÿ± ÿßŸÑŸáÿ¨ÿ±Ÿäÿ© (ŸÖŸÅŸÇŸàÿØÿ© Ÿàÿ™ÿ≥ÿ®ÿ® ŸÖÿ¥ÿßŸÉŸÑ ŸÅŸä ÿßŸÑÿπÿ±ÿ∂)
    hijriMonths: [
        "ŸÖÿ≠ÿ±ŸÖ", "ÿµŸÅÿ±", "ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ£ŸàŸÑ", "ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ´ÿßŸÜŸä", "ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ", "ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ©",
        "ÿ±ÿ¨ÿ®", "ÿ¥ÿπÿ®ÿßŸÜ", "ÿ±ŸÖÿ∂ÿßŸÜ", "ÿ¥ŸàÿßŸÑ", "ÿ∞Ÿà ÿßŸÑŸÇÿπÿØÿ©", "ÿ∞Ÿà ÿßŸÑÿ≠ÿ¨ÿ©"
    ],

    // 2. ŸÇÿßÿ¶ŸÖÿ© ÿ∑ÿ±ŸÇ ÿßŸÑÿ≠ÿ≥ÿßÿ® (ŸÖŸÅŸÇŸàÿØÿ© Ÿàÿ™ÿ≥ÿ®ÿ® ÿßŸÑÿÆÿ∑ÿ£ ŸÅŸä fetchData)
    calculationMethods: {
    5: { name: "ÿßŸÑŸáŸäÿ¶ÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑÿπÿßŸÖÿ© ŸÑŸÑŸÖÿ≥ÿßÿ≠ÿ©" },
    4: { name: "ÿ¨ÿßŸÖÿπÿ© ÿ£ŸÖ ÿßŸÑŸÇÿ±Ÿâ (ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©)" },
    1: { name: "ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿπŸÑŸàŸÖ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© (ŸÉÿ±ÿßÿ™ÿ¥Ÿä)" },
    2: { name: "ÿßŸÑÿ¨ŸÖÿπŸäÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© ŸÑÿ£ŸÖÿ±ŸäŸÉÿß ÿßŸÑÿ¥ŸÖÿßŸÑŸäÿ©" },
    3: { name: "ÿ±ÿßÿ®ÿ∑ÿ© ÿßŸÑÿπÿßŸÑŸÖ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä" },
    16: { name: "ÿØÿ®Ÿä (ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖÿ™ÿ≠ÿØÿ©)" },
    13: { name: "ÿ±ÿ¶ÿßÿ≥ÿ© ÿßŸÑÿ¥ÿ§ŸàŸÜ ÿßŸÑÿØŸäŸÜŸäÿ© ÿßŸÑÿ™ÿ±ŸÉŸäÿ©" },
    12: { name: "ÿßŸÑÿßÿ™ÿ≠ÿßÿØ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿä" },
    14: { name: "Ÿàÿ≤ÿßÿ±ÿ© ÿßŸÑÿ¥ÿ§ŸàŸÜ ÿßŸÑÿØŸäŸÜŸäÿ© ÿßŸÑÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©" },
    0: { name: "ÿßŸÑŸÖÿ∞Ÿáÿ® ÿßŸÑÿ¨ÿπŸÅÿ±Ÿä" },
    9: { name: "Ÿàÿ≤ÿßÿ±ÿ© ÿßŸÑÿ£ŸàŸÇÿßŸÅ ŸàÿßŸÑÿ¥ÿ§ŸàŸÜ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© (ÿßŸÑŸÉŸàŸäÿ™)" },
    10: { name: "Ÿàÿ≤ÿßÿ±ÿ© ÿßŸÑÿ£ŸàŸÇÿßŸÅ (ŸÇÿ∑ÿ±)" }
},


    // 3. ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ∞ŸÉÿßÿ± (ŸÖŸÅŸÇŸàÿØÿ© Ÿàÿ™ÿ≥ÿ®ÿ® ÿßŸÑÿÆÿ∑ÿ£ reduce)
    dhikrList: [
        { arabic: "ÿ≥ÿ®ÿ≠ÿßŸÜ ÿßŸÑŸÑŸá", current: 0, max: 33 },
        { arabic: "ÿßŸÑÿ≠ŸÖÿØ ŸÑŸÑŸá", current: 0, max: 33 },
        { arabic: "ÿßŸÑŸÑŸá ÿ£ŸÉÿ®ÿ±", current: 0, max: 34 },
        { arabic: "ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿßŸÑŸÑŸá", current: 0, max: 100 },
        { arabic: "ÿ£ÿ≥ÿ™ÿ∫ŸÅÿ± ÿßŸÑŸÑŸá", current: 0, max: 100 },
        { arabic: "ÿ≥ÿ®ÿ≠ÿßŸÜ ÿßŸÑŸÑŸá Ÿàÿ®ÿ≠ŸÖÿØŸá", current: 0, max: 100 },
        { arabic: "ŸÑÿß ÿ≠ŸàŸÑ ŸàŸÑÿß ŸÇŸàÿ© ÿ•ŸÑÿß ÿ®ÿßŸÑŸÑŸá", current: 0, max: 100 },
        { arabic: "ÿ≠ÿ≥ÿ®Ÿä ÿßŸÑŸÑŸá ŸàŸÜÿπŸÖ ÿßŸÑŸàŸÉŸäŸÑ", current: 0, max: 100 },
        { arabic: "ÿ≥ÿ®ÿ≠ÿßŸÜ ÿßŸÑŸÑŸá ÿßŸÑÿπÿ∏ŸäŸÖ Ÿàÿ®ÿ≠ŸÖÿØŸá", current: 0, max: 100 }
    ],

          


            
            cardBackgrounds: [
                "https://images.unsplash.com/photo-1614854262318-831574f15f1f?q=80&w=1000",
                "https://images.unsplash.com/photo-1615887089461-1eeb6c3829ef?q=80&w=1000",
                "https://images.unsplash.com/photo-1614851099178-89d8cd6e7e4d?q=80&w=1000",
                "https://images.unsplash.com/photo-1614851099175-e5b30eb6f696?q=80&w=1000",
                "https://images.unsplash.com/photo-1614851099511-773084e691af?q=80&w=1000",
                "https://images.unsplash.com/photo-1614854262340-9c5c2a6a2b1f?q=80&w=1000"
            ]
        };
        
        // ==================== ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿØÿπŸäÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ© ====================
        const duaData = [
            {
                id: 1,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ®ŸêŸÉŸé ÿ£ŸéÿµŸíÿ®Ÿéÿ≠ŸíŸÜŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ÿ£ŸéŸÖŸíÿ≥ŸéŸäŸíŸÜŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ŸÜŸéÿ≠ŸíŸäŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ŸÜŸéŸÖŸèŸàÿ™Ÿèÿå ŸàŸéÿ•ŸêŸÑŸéŸäŸíŸÉŸé ÿßŸÑŸÜŸèŸëÿ¥ŸèŸàÿ±Ÿè",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ®ŸÉ ÿ£ÿµÿ®ÿ≠ŸÜÿßÿå Ÿàÿ®ŸÉ ÿ£ŸÖÿ≥ŸäŸÜÿßÿå Ÿàÿ®ŸÉ ŸÜÿ≠Ÿäÿßÿå Ÿàÿ®ŸÉ ŸÜŸÖŸàÿ™ÿå Ÿàÿ•ŸÑŸäŸÉ ÿßŸÑŸÜÿ¥Ÿàÿ±",
                category: "morning",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            },
            {
                id: 2,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéŸÜŸíÿ™Ÿé ÿ±Ÿéÿ®ŸêŸëŸä ŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑÿß ÿ£ŸéŸÜŸíÿ™Ÿéÿå ÿÆŸéŸÑŸéŸÇŸíÿ™ŸéŸÜŸêŸä ŸàŸéÿ£ŸéŸÜŸéÿß ÿπŸéÿ®ŸíÿØŸèŸÉŸéÿå ŸàŸéÿ£ŸéŸÜŸéÿß ÿπŸéŸÑŸéŸâ ÿπŸéŸáŸíÿØŸêŸÉŸé ŸàŸéŸàŸéÿπŸíÿØŸêŸÉŸé ŸÖŸéÿß ÿßÿ≥Ÿíÿ™Ÿéÿ∑ŸéÿπŸíÿ™Ÿèÿå ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ŸÖŸéÿß ÿµŸéŸÜŸéÿπŸíÿ™Ÿèÿå ÿ£Ÿéÿ®ŸèŸàÿ°Ÿè ŸÑŸéŸÉŸé ÿ®ŸêŸÜŸêÿπŸíŸÖŸéÿ™ŸêŸÉŸé ÿπŸéŸÑŸéŸäŸéŸëÿå ŸàŸéÿ£Ÿéÿ®ŸèŸàÿ°Ÿè ŸÑŸéŸÉŸé ÿ®Ÿêÿ∞ŸéŸÜŸíÿ®ŸêŸä ŸÅŸéÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸäÿå ŸÅŸéÿ•ŸêŸÜŸéŸëŸáŸè ŸÑÿß ŸäŸéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑÿ∞ŸèŸëŸÜŸèŸàÿ®Ÿé ÿ•ŸêŸÑÿß ÿ£ŸéŸÜŸíÿ™Ÿé",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ£ŸÜÿ™ ÿ±ÿ®Ÿäÿå ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿ£ŸÜÿ™ÿå ÿÆŸÑŸÇÿ™ŸÜŸä Ÿàÿ£ŸÜÿß ÿπÿ®ÿØŸÉÿå Ÿàÿ£ŸÜÿß ÿπŸÑŸâ ÿπŸáÿØŸÉ ŸàŸàÿπÿØŸÉ ŸÖÿß ÿßÿ≥ÿ™ÿ∑ÿπÿ™ÿå ÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿ¥ÿ± ŸÖÿß ÿµŸÜÿπÿ™ÿå ÿ£ÿ®Ÿàÿ° ŸÑŸÉ ÿ®ŸÜÿπŸÖÿ™ŸÉ ÿπŸÑŸäÿå Ÿàÿ£ÿ®Ÿàÿ° ÿ®ÿ∞ŸÜÿ®Ÿä ŸÅÿßÿ∫ŸÅÿ± ŸÑŸäÿå ŸÅÿ•ŸÜŸá ŸÑÿß Ÿäÿ∫ŸÅÿ± ÿßŸÑÿ∞ŸÜŸàÿ® ÿ•ŸÑÿß ÿ£ŸÜÿ™",
                category: "morning",
                source: "ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ®ÿÆÿßÿ±Ÿä"
            },
            {
                id: 3,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿµŸíÿ®Ÿéÿ≠Ÿíÿ™Ÿè ÿ£Ÿèÿ¥ŸíŸáŸêÿØŸèŸÉŸéÿå ŸàŸéÿ£Ÿèÿ¥ŸíŸáŸêÿØŸè ÿ≠ŸéŸÖŸéŸÑŸéÿ©Ÿé ÿπŸéÿ±Ÿíÿ¥ŸêŸÉŸéÿå ŸàŸéŸÖŸéŸÑÿßÿ¶ŸêŸÉŸéÿ™ŸéŸÉŸéÿå ŸàŸéÿ¨ŸéŸÖŸêŸäÿπŸé ÿÆŸéŸÑŸíŸÇŸêŸÉŸéÿå ÿ£ŸéŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜŸíÿ™Ÿé ÿßŸÑŸÑŸéŸëŸáŸè ŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑÿß ÿ£ŸéŸÜŸíÿ™Ÿéÿå ŸàŸéÿ£ŸéŸÜŸéŸë ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸãÿß ÿπŸéÿ®ŸíÿØŸèŸÉŸé ŸàŸéÿ±Ÿéÿ≥ŸèŸàŸÑŸèŸÉŸé",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿµÿ®ÿ≠ÿ™ ÿ£ÿ¥ŸáÿØŸÉÿå Ÿàÿ£ÿ¥ŸáÿØ ÿ≠ŸÖŸÑÿ© ÿπÿ±ÿ¥ŸÉÿå ŸàŸÖŸÑÿßÿ¶ŸÉÿ™ŸÉÿå Ÿàÿ¨ŸÖŸäÿπ ÿÆŸÑŸÇŸÉÿå ÿ£ŸÜŸÉ ÿ£ŸÜÿ™ ÿßŸÑŸÑŸá ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿ£ŸÜÿ™ÿå Ÿàÿ£ŸÜ ŸÖÿ≠ŸÖÿØŸãÿß ÿπÿ®ÿØŸÉ Ÿàÿ±ÿ≥ŸàŸÑŸÉ",
                category: "morning",
                source: "ÿ≥ŸÜŸÜ ÿ£ÿ®Ÿä ÿØÿßŸàÿØ"
            },
            {
                id: 4,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÖŸéÿß ÿ£ŸéÿµŸíÿ®Ÿéÿ≠Ÿé ÿ®ŸêŸä ŸÖŸêŸÜŸí ŸÜŸêÿπŸíŸÖŸéÿ©Ÿç ÿ£ŸéŸàŸí ÿ®Ÿêÿ£Ÿéÿ≠ŸéÿØŸç ŸÖŸêŸÜŸí ÿÆŸéŸÑŸíŸÇŸêŸÉŸéÿå ŸÅŸéŸÖŸêŸÜŸíŸÉŸé ŸàŸéÿ≠ŸíÿØŸéŸÉŸé ŸÑÿß ÿ¥Ÿéÿ±ŸêŸäŸÉŸé ŸÑŸéŸÉŸéÿå ŸÅŸéŸÑŸéŸÉŸé ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸàŸéŸÑŸéŸÉŸé ÿßŸÑÿ¥ŸèŸëŸÉŸíÿ±Ÿè",
                translation: "ÿßŸÑŸÑŸáŸÖ ŸÖÿß ÿ£ÿµÿ®ÿ≠ ÿ®Ÿä ŸÖŸÜ ŸÜÿπŸÖÿ© ÿ£Ÿà ÿ®ÿ£ÿ≠ÿØ ŸÖŸÜ ÿÆŸÑŸÇŸÉÿå ŸÅŸÖŸÜŸÉ Ÿàÿ≠ÿØŸÉ ŸÑÿß ÿ¥ÿ±ŸäŸÉ ŸÑŸÉÿå ŸÅŸÑŸÉ ÿßŸÑÿ≠ŸÖÿØ ŸàŸÑŸÉ ÿßŸÑÿ¥ŸÉÿ±",
                category: "morning",
                source: "ÿ≥ŸÜŸÜ ÿ£ÿ®Ÿä ÿØÿßŸàÿØ"
            },
            {
                id: 5,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿπŸéÿßŸÅŸêŸÜŸêŸä ŸÅŸêŸä ÿ®ŸéÿØŸéŸÜŸêŸäÿå ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿπŸéÿßŸÅŸêŸÜŸêŸä ŸÅŸêŸä ÿ≥ŸéŸÖŸíÿπŸêŸäÿå ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿπŸéÿßŸÅŸêŸÜŸêŸä ŸÅŸêŸä ÿ®ŸéÿµŸéÿ±ŸêŸäÿå ŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑÿß ÿ£ŸéŸÜŸíÿ™Ÿé",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿπÿßŸÅŸÜŸä ŸÅŸä ÿ®ÿØŸÜŸäÿå ÿßŸÑŸÑŸáŸÖ ÿπÿßŸÅŸÜŸä ŸÅŸä ÿ≥ŸÖÿπŸäÿå ÿßŸÑŸÑŸáŸÖ ÿπÿßŸÅŸÜŸä ŸÅŸä ÿ®ÿµÿ±Ÿäÿå ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿ£ŸÜÿ™",
                category: "morning",
                source: "ÿ≥ŸÜŸÜ ÿ£ÿ®Ÿä ÿØÿßŸàÿØ"
            },
            {
                id: 6,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ®ŸêŸÉŸé ÿ£ŸéŸÖŸíÿ≥ŸéŸäŸíŸÜŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ÿ£ŸéÿµŸíÿ®Ÿéÿ≠ŸíŸÜŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ŸÜŸéÿ≠ŸíŸäŸéÿßÿå ŸàŸéÿ®ŸêŸÉŸé ŸÜŸéŸÖŸèŸàÿ™Ÿèÿå ŸàŸéÿ•ŸêŸÑŸéŸäŸíŸÉŸé ÿßŸÑŸíŸÖŸéÿµŸêŸäÿ±Ÿè",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ®ŸÉ ÿ£ŸÖÿ≥ŸäŸÜÿßÿå Ÿàÿ®ŸÉ ÿ£ÿµÿ®ÿ≠ŸÜÿßÿå Ÿàÿ®ŸÉ ŸÜÿ≠Ÿäÿßÿå Ÿàÿ®ŸÉ ŸÜŸÖŸàÿ™ÿå Ÿàÿ•ŸÑŸäŸÉ ÿßŸÑŸÖÿµŸäÿ±",
                category: "evening",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            },
            {
                id: 7,
                text: "ÿ£ŸéŸÖŸíÿ≥ŸéŸäŸíŸÜŸéÿß ŸàŸéÿ£ŸéŸÖŸíÿ≥ŸéŸâ ÿßŸÑŸíŸÖŸèŸÑŸíŸÉŸè ŸÑŸêŸÑŸéŸëŸáŸêÿå ŸàŸéÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸêÿå ŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéÿ≠ŸíÿØŸéŸáŸè ŸÑÿß ÿ¥Ÿéÿ±ŸêŸäŸÉŸé ŸÑŸéŸáŸè",
                translation: "ÿ£ŸÖÿ≥ŸäŸÜÿß Ÿàÿ£ŸÖÿ≥Ÿâ ÿßŸÑŸÖŸÑŸÉ ŸÑŸÑŸáÿå ŸàÿßŸÑÿ≠ŸÖÿØ ŸÑŸÑŸáÿå ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿßŸÑŸÑŸá Ÿàÿ≠ÿØŸá ŸÑÿß ÿ¥ÿ±ŸäŸÉ ŸÑŸá",
                category: "evening",
                source: "ÿµÿ≠Ÿäÿ≠ ŸÖÿ≥ŸÑŸÖ"
            },
            {
                id: 8,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíŸáŸéŸÖŸêŸë ŸàŸéÿßŸÑŸíÿ≠Ÿéÿ≤ŸéŸÜŸêÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíÿπŸéÿ¨Ÿíÿ≤Ÿê ŸàŸéÿßŸÑŸíŸÉŸéÿ≥ŸéŸÑŸêÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíÿ¨Ÿèÿ®ŸíŸÜŸê ŸàŸéÿßŸÑŸíÿ®ŸèÿÆŸíŸÑŸêÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿ∫ŸéŸÑŸéÿ®Ÿéÿ©Ÿê ÿßŸÑÿØŸéŸëŸäŸíŸÜŸê ŸàŸéŸÇŸéŸáŸíÿ±Ÿê ÿßŸÑÿ±ŸêŸëÿ¨ŸéÿßŸÑŸê",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿßŸÑŸáŸÖ ŸàÿßŸÑÿ≠ÿ≤ŸÜÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿßŸÑÿπÿ¨ÿ≤ ŸàÿßŸÑŸÉÿ≥ŸÑÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿßŸÑÿ¨ÿ®ŸÜ ŸàÿßŸÑÿ®ÿÆŸÑÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿ∫ŸÑÿ®ÿ© ÿßŸÑÿØŸäŸÜ ŸàŸÇŸáÿ± ÿßŸÑÿ±ÿ¨ÿßŸÑ",
                category: "evening",
                source: "ÿ≥ŸÜŸÜ ÿ£ÿ®Ÿä ÿØÿßŸàÿØ"
            },
            {
                id: 9,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿπŸêŸÑŸíŸÖŸãÿß ŸÜŸéÿßŸÅŸêÿπŸãÿßÿå ŸàŸéÿ±Ÿêÿ≤ŸíŸÇŸãÿß ÿ∑ŸéŸäŸêŸëÿ®Ÿãÿßÿå ŸàŸéÿπŸéŸÖŸéŸÑÿßŸã ŸÖŸèÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑÿßŸã",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ÿπŸÑŸÖŸãÿß ŸÜÿßŸÅÿπŸãÿßÿå Ÿàÿ±ÿ≤ŸÇŸãÿß ÿ∑Ÿäÿ®Ÿãÿßÿå ŸàÿπŸÖŸÑÿßŸã ŸÖÿ™ŸÇÿ®ŸÑÿßŸã",
                category: "evening",
                source: "ÿ≥ŸÜŸÜ ÿßÿ®ŸÜ ŸÖÿßÿ¨Ÿá"
            },
            {
                id: 10,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéŸÜŸíÿ™Ÿé ÿ±Ÿéÿ®ŸêŸëŸä ŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑÿß ÿ£ŸéŸÜŸíÿ™Ÿéÿå ÿπŸéŸÑŸéŸäŸíŸÉŸé ÿ™ŸéŸàŸéŸÉŸéŸëŸÑŸíÿ™Ÿèÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ±Ÿéÿ®ŸèŸë ÿßŸÑŸíÿπŸéÿ±Ÿíÿ¥Ÿê ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸê",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ£ŸÜÿ™ ÿ±ÿ®Ÿä ŸÑÿß ÿ•ŸÑŸá ÿ•ŸÑÿß ÿ£ŸÜÿ™ÿå ÿπŸÑŸäŸÉ ÿ™ŸàŸÉŸÑÿ™ÿå Ÿàÿ£ŸÜÿ™ ÿ±ÿ® ÿßŸÑÿπÿ±ÿ¥ ÿßŸÑÿπÿ∏ŸäŸÖ",
                category: "evening",
                source: "ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ®ÿÆÿßÿ±Ÿä"
            },
            {
                id: 11,
                text: "ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸéŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸàŸéÿ®Ÿêÿ≠ŸéŸÖŸíÿØŸêŸÉŸéÿå ŸàŸéÿ™Ÿéÿ®Ÿéÿßÿ±ŸéŸÉŸé ÿßÿ≥ŸíŸÖŸèŸÉŸéÿå ŸàŸéÿ™ŸéÿπŸéÿßŸÑŸéŸâ ÿ¨ŸéÿØŸèŸëŸÉŸéÿå ŸàŸéŸÑÿß ÿ•ŸêŸÑŸéŸáŸé ÿ∫ŸéŸäŸíÿ±ŸèŸÉŸé",
                translation: "ÿ≥ÿ®ÿ≠ÿßŸÜŸÉ ÿßŸÑŸÑŸáŸÖ Ÿàÿ®ÿ≠ŸÖÿØŸÉÿå Ÿàÿ™ÿ®ÿßÿ±ŸÉ ÿßÿ≥ŸÖŸÉÿå Ÿàÿ™ÿπÿßŸÑŸâ ÿ¨ÿØŸÉÿå ŸàŸÑÿß ÿ•ŸÑŸá ÿ∫Ÿäÿ±ŸÉ",
                category: "prayer",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            },
            {
                id: 12,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸêŸä ŸàŸéÿßŸáŸíÿØŸêŸÜŸêŸä ŸàŸéÿπŸéÿßŸÅŸêŸÜŸêŸä ŸàŸéÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿßÿ∫ŸÅÿ± ŸÑŸä Ÿàÿßÿ±ÿ≠ŸÖŸÜŸä ŸàÿßŸáÿØŸÜŸä ŸàÿπÿßŸÅŸÜŸä Ÿàÿßÿ±ÿ≤ŸÇŸÜŸä",
                category: "prayer",
                source: "ÿµÿ≠Ÿäÿ≠ ŸÖÿ≥ŸÑŸÖ"
            },
            {
                id: 13,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíÿπŸéÿ¨Ÿíÿ≤Ÿê ŸàŸéÿßŸÑŸíŸÉŸéÿ≥ŸéŸÑŸêÿå ŸàŸéÿßŸÑŸíÿ¨Ÿèÿ®ŸíŸÜŸê ŸàŸéÿßŸÑŸíŸáŸéÿ±ŸéŸÖŸêÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿπŸéÿ∞Ÿéÿßÿ®Ÿê ÿßŸÑŸíŸÇŸéÿ®Ÿíÿ±Ÿêÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ŸÅŸêÿ™ŸíŸÜŸéÿ©Ÿê ÿßŸÑŸíŸÖŸéÿ≠ŸíŸäŸéÿß ŸàŸéÿßŸÑŸíŸÖŸéŸÖŸéÿßÿ™Ÿê",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿßŸÑÿπÿ¨ÿ≤ ŸàÿßŸÑŸÉÿ≥ŸÑÿå ŸàÿßŸÑÿ¨ÿ®ŸÜ ŸàÿßŸÑŸáÿ±ŸÖÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿπÿ∞ÿßÿ® ÿßŸÑŸÇÿ®ÿ±ÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ŸÅÿ™ŸÜÿ© ÿßŸÑŸÖÿ≠Ÿäÿß ŸàÿßŸÑŸÖŸÖÿßÿ™",
                category: "prayer",
                source: "ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ®ÿÆÿßÿ±Ÿä"
            },
            {
                id: 14,
                text: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê",
                translation: "ÿ±ÿ®ŸÜÿß ÿ¢ÿ™ŸÜÿß ŸÅŸä ÿßŸÑÿØŸÜŸäÿß ÿ≠ÿ≥ŸÜÿ© ŸàŸÅŸä ÿßŸÑÿ¢ÿÆÿ±ÿ© ÿ≠ÿ≥ŸÜÿ© ŸàŸÇŸÜÿß ÿπÿ∞ÿßÿ® ÿßŸÑŸÜÿßÿ±",
                category: "prayer",
                source: "ÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ®ŸÇÿ±ÿ©: 201"
            },
            {
                id: 15,
                text: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸêŸä ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿÆŸéŸäŸíÿ±Ÿè ÿßŸÑÿ±ŸéŸëÿßÿ≠ŸêŸÖŸêŸäŸÜŸé",
                translation: "ÿ±ÿ® ÿßÿ∫ŸÅÿ± ŸÑŸä Ÿàÿßÿ±ÿ≠ŸÖŸÜŸä Ÿàÿ£ŸÜÿ™ ÿÆŸäÿ± ÿßŸÑÿ±ÿßÿ≠ŸÖŸäŸÜ",
                category: "prayer",
                source: "ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÖÿ§ŸÖŸÜŸàŸÜ: 118"
            },
            {
                id: 16,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíŸáŸèÿØŸéŸâ ŸàŸéÿßŸÑÿ™ŸèŸëŸÇŸéŸâ ŸàŸéÿßŸÑŸíÿπŸéŸÅŸéÿßŸÅŸé ŸàŸéÿßŸÑŸíÿ∫ŸêŸÜŸéŸâ",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ÿßŸÑŸáÿØŸâ ŸàÿßŸÑÿ™ŸÇŸâ ŸàÿßŸÑÿπŸÅÿßŸÅ ŸàÿßŸÑÿ∫ŸÜŸâ",
                category: "general",
                source: "ÿµÿ≠Ÿäÿ≠ ŸÖÿ≥ŸÑŸÖ"
            },
            {
                id: 17,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíÿÆŸéŸäŸíÿ±Ÿê ŸÉŸèŸÑŸêŸëŸáŸê ÿπŸéÿßÿ¨ŸêŸÑŸêŸáŸê ŸàŸéÿ¢ÿ¨ŸêŸÑŸêŸáŸêÿå ŸÖŸéÿß ÿπŸéŸÑŸêŸÖŸíÿ™Ÿè ŸÖŸêŸÜŸíŸáŸè ŸàŸéŸÖŸéÿß ŸÑŸéŸÖŸí ÿ£ŸéÿπŸíŸÑŸéŸÖŸíÿå ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑÿ¥ŸéŸëÿ±ŸêŸë ŸÉŸèŸÑŸêŸëŸáŸê ÿπŸéÿßÿ¨ŸêŸÑŸêŸáŸê ŸàŸéÿ¢ÿ¨ŸêŸÑŸêŸáŸêÿå ŸÖŸéÿß ÿπŸéŸÑŸêŸÖŸíÿ™Ÿè ŸÖŸêŸÜŸíŸáŸè ŸàŸéŸÖŸéÿß ŸÑŸéŸÖŸí ÿ£ŸéÿπŸíŸÑŸéŸÖŸí",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ŸÖŸÜ ÿßŸÑÿÆŸäÿ± ŸÉŸÑŸá ÿπÿßÿ¨ŸÑŸá Ÿàÿ¢ÿ¨ŸÑŸáÿå ŸÖÿß ÿπŸÑŸÖÿ™ ŸÖŸÜŸá ŸàŸÖÿß ŸÑŸÖ ÿ£ÿπŸÑŸÖÿå Ÿàÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿßŸÑÿ¥ÿ± ŸÉŸÑŸá ÿπÿßÿ¨ŸÑŸá Ÿàÿ¢ÿ¨ŸÑŸáÿå ŸÖÿß ÿπŸÑŸÖÿ™ ŸÖŸÜŸá ŸàŸÖÿß ŸÑŸÖ ÿ£ÿπŸÑŸÖ",
                category: "general",
                source: "ÿ≥ŸÜŸÜ ÿßÿ®ŸÜ ŸÖÿßÿ¨Ÿá"
            },
            {
                id: 18,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéÿµŸíŸÑŸêÿ≠Ÿí ŸÑŸêŸä ÿØŸêŸäŸÜŸêŸä ÿßŸÑŸéŸëÿ∞ŸêŸä ŸáŸèŸàŸé ÿπŸêÿµŸíŸÖŸéÿ©Ÿè ÿ£ŸéŸÖŸíÿ±ŸêŸäÿå ŸàŸéÿ£ŸéÿµŸíŸÑŸêÿ≠Ÿí ŸÑŸêŸä ÿØŸèŸÜŸíŸäŸéÿßŸäŸé ÿßŸÑŸéŸëÿ™ŸêŸä ŸÅŸêŸäŸáŸéÿß ŸÖŸéÿπŸéÿßÿ¥ŸêŸäÿå ŸàŸéÿ£ŸéÿµŸíŸÑŸêÿ≠Ÿí ŸÑŸêŸä ÿ¢ÿÆŸêÿ±Ÿéÿ™ŸêŸä ÿßŸÑŸéŸëÿ™ŸêŸä ŸÅŸêŸäŸáŸéÿß ŸÖŸéÿπŸéÿßÿØŸêŸäÿå ŸàŸéÿßÿ¨ŸíÿπŸéŸÑŸê ÿßŸÑŸíÿ≠ŸéŸäŸéÿßÿ©Ÿé ÿ≤ŸêŸäŸéÿßÿØŸéÿ©Ÿã ŸÑŸêŸä ŸÅŸêŸä ŸÉŸèŸÑŸêŸë ÿÆŸéŸäŸíÿ±Ÿçÿå ŸàŸéÿßŸÑŸíŸÖŸéŸàŸíÿ™Ÿé ÿ±Ÿéÿßÿ≠Ÿéÿ©Ÿã ŸÑŸêŸä ŸÖŸêŸÜŸí ŸÉŸèŸÑŸêŸë ÿ¥Ÿéÿ±ŸçŸë",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ£ÿµŸÑÿ≠ ŸÑŸä ÿØŸäŸÜŸä ÿßŸÑÿ∞Ÿä ŸáŸà ÿπÿµŸÖÿ© ÿ£ŸÖÿ±Ÿäÿå Ÿàÿ£ÿµŸÑÿ≠ ŸÑŸä ÿØŸÜŸäÿßŸä ÿßŸÑÿ™Ÿä ŸÅŸäŸáÿß ŸÖÿπÿßÿ¥Ÿäÿå Ÿàÿ£ÿµŸÑÿ≠ ŸÑŸä ÿ¢ÿÆÿ±ÿ™Ÿä ÿßŸÑÿ™Ÿä ŸÅŸäŸáÿß ŸÖÿπÿßÿØŸäÿå Ÿàÿßÿ¨ÿπŸÑ ÿßŸÑÿ≠Ÿäÿßÿ© ÿ≤ŸäÿßÿØÿ© ŸÑŸä ŸÅŸä ŸÉŸÑ ÿÆŸäÿ±ÿå ŸàÿßŸÑŸÖŸàÿ™ ÿ±ÿßÿ≠ÿ© ŸÑŸä ŸÖŸÜ ŸÉŸÑ ÿ¥ÿ±",
                category: "general",
                source: "ÿµÿ≠Ÿäÿ≠ ŸÖÿ≥ŸÑŸÖ"
            },
            {
                id: 19,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸàŸéÿßŸÑŸíÿπŸéÿßŸÅŸêŸäŸéÿ©Ÿé ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ŸàŸéÿßŸÑÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿêÿå ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸàŸéÿßŸÑŸíÿπŸéÿßŸÅŸêŸäŸéÿ©Ÿé ŸÅŸêŸä ÿØŸêŸäŸÜŸêŸä ŸàŸéÿØŸèŸÜŸíŸäŸéÿßŸäŸé ŸàŸéÿ£ŸéŸáŸíŸÑŸêŸä ŸàŸéŸÖŸéÿßŸÑŸêŸä",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ÿßŸÑÿπŸÅŸà ŸàÿßŸÑÿπÿßŸÅŸäÿ© ŸÅŸä ÿßŸÑÿØŸÜŸäÿß ŸàÿßŸÑÿ¢ÿÆÿ±ÿ©ÿå ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ÿßŸÑÿπŸÅŸà ŸàÿßŸÑÿπÿßŸÅŸäÿ© ŸÅŸä ÿØŸäŸÜŸä ŸàÿØŸÜŸäÿßŸä Ÿàÿ£ŸáŸÑŸä ŸàŸÖÿßŸÑŸä",
                category: "general",
                source: "ÿ≥ŸÜŸÜ ÿ£ÿ®Ÿä ÿØÿßŸàÿØ"
            },
            {
                id: 20,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸíŸÜŸêŸä ŸÖŸêŸÜŸé ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ£Ÿéÿ≠Ÿíÿ≥ŸéŸÜŸèŸàÿß ÿßÿ≥Ÿíÿ™Ÿéÿ®Ÿíÿ¥Ÿéÿ±ŸèŸàÿßÿå ŸàŸéÿ•Ÿêÿ∞Ÿéÿß ÿ£Ÿéÿ≥Ÿéÿßÿ°ŸèŸàÿß ÿßÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸéÿ±ŸèŸàÿß",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿßÿ¨ÿπŸÑŸÜŸä ŸÖŸÜ ÿßŸÑÿ∞ŸäŸÜ ÿ•ÿ∞ÿß ÿ£ÿ≠ÿ≥ŸÜŸàÿß ÿßÿ≥ÿ™ÿ®ÿ¥ÿ±Ÿàÿßÿå Ÿàÿ•ÿ∞ÿß ÿ£ÿ≥ÿßÿ°Ÿàÿß ÿßÿ≥ÿ™ÿ∫ŸÅÿ±Ÿàÿß",
                category: "general",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            },
            {
                id: 21,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸí ÿ≤ŸéŸàŸéÿßŸÑŸê ŸÜŸêÿπŸíŸÖŸéÿ™ŸêŸÉŸéÿå ŸàŸéÿ™Ÿéÿ≠ŸéŸàŸèŸëŸÑŸê ÿπŸéÿßŸÅŸêŸäŸéÿ™ŸêŸÉŸéÿå ŸàŸéŸÅŸèÿ¨Ÿéÿßÿ°Ÿéÿ©Ÿê ŸÜŸêŸÇŸíŸÖŸéÿ™ŸêŸÉŸéÿå ŸàŸéÿ¨ŸéŸÖŸêŸäÿπŸê ÿ≥ŸéÿÆŸéÿ∑ŸêŸÉŸé",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿπŸàÿ∞ ÿ®ŸÉ ŸÖŸÜ ÿ≤ŸàÿßŸÑ ŸÜÿπŸÖÿ™ŸÉÿå Ÿàÿ™ÿ≠ŸàŸÑ ÿπÿßŸÅŸäÿ™ŸÉÿå ŸàŸÅÿ¨ÿßÿ°ÿ© ŸÜŸÇŸÖÿ™ŸÉÿå Ÿàÿ¨ŸÖŸäÿπ ÿ≥ÿÆÿ∑ŸÉ",
                category: "general",
                source: "ÿµÿ≠Ÿäÿ≠ ŸÖÿ≥ŸÑŸÖ"
            },
            {
                id: 22,
                text: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸÑÿß ÿ™Ÿèÿ§ŸéÿßÿÆŸêÿ∞ŸíŸÜŸéÿß ÿ•ŸêŸÜŸí ŸÜŸéÿ≥ŸêŸäŸÜŸéÿß ÿ£ŸéŸàŸí ÿ£ŸéÿÆŸíÿ∑Ÿéÿ£ŸíŸÜŸéÿßÿå ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸàŸéŸÑÿß ÿ™Ÿéÿ≠ŸíŸÖŸêŸÑŸí ÿπŸéŸÑŸéŸäŸíŸÜŸéÿß ÿ•ŸêÿµŸíÿ±Ÿãÿß ŸÉŸéŸÖŸéÿß ÿ≠ŸéŸÖŸéŸÑŸíÿ™ŸéŸáŸè ÿπŸéŸÑŸéŸâ ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ŸÖŸêŸÜŸí ŸÇŸéÿ®ŸíŸÑŸêŸÜŸéÿßÿå ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸàŸéŸÑÿß ÿ™Ÿèÿ≠ŸéŸÖŸêŸëŸÑŸíŸÜŸéÿß ŸÖŸéÿß ŸÑÿß ÿ∑ŸéÿßŸÇŸéÿ©Ÿé ŸÑŸéŸÜŸéÿß ÿ®ŸêŸáŸêÿå ŸàŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸéŸëÿß ŸàŸéÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸéŸÜŸéÿß ŸàŸéÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸéÿßÿå ÿ£ŸéŸÜŸíÿ™Ÿé ŸÖŸéŸàŸíŸÑÿßŸÜŸéÿß ŸÅŸéÿßŸÜŸíÿµŸèÿ±ŸíŸÜŸéÿß ÿπŸéŸÑŸéŸâ ÿßŸÑŸíŸÇŸéŸàŸíŸÖŸê ÿßŸÑŸíŸÉŸéÿßŸÅŸêÿ±ŸêŸäŸÜŸé",
                translation: "ÿ±ÿ®ŸÜÿß ŸÑÿß ÿ™ÿ§ÿßÿÆÿ∞ŸÜÿß ÿ•ŸÜ ŸÜÿ≥ŸäŸÜÿß ÿ£Ÿà ÿ£ÿÆÿ∑ÿ£ŸÜÿßÿå ÿ±ÿ®ŸÜÿß ŸàŸÑÿß ÿ™ÿ≠ŸÖŸÑ ÿπŸÑŸäŸÜÿß ÿ•ÿµÿ±Ÿãÿß ŸÉŸÖÿß ÿ≠ŸÖŸÑÿ™Ÿá ÿπŸÑŸâ ÿßŸÑÿ∞ŸäŸÜ ŸÖŸÜ ŸÇÿ®ŸÑŸÜÿßÿå ÿ±ÿ®ŸÜÿß ŸàŸÑÿß ÿ™ÿ≠ŸÖŸÑŸÜÿß ŸÖÿß ŸÑÿß ÿ∑ÿßŸÇÿ© ŸÑŸÜÿß ÿ®Ÿáÿå ŸàÿßÿπŸÅ ÿπŸÜÿß Ÿàÿßÿ∫ŸÅÿ± ŸÑŸÜÿß Ÿàÿßÿ±ÿ≠ŸÖŸÜÿßÿå ÿ£ŸÜÿ™ ŸÖŸàŸÑÿßŸÜÿß ŸÅÿßŸÜÿµÿ±ŸÜÿß ÿπŸÑŸâ ÿßŸÑŸÇŸàŸÖ ÿßŸÑŸÉÿßŸÅÿ±ŸäŸÜ",
                category: "general",
                source: "ÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ®ŸÇÿ±ÿ©: 286"
            },
            {
                id: 23,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ŸÅŸêÿπŸíŸÑŸé ÿßŸÑŸíÿÆŸéŸäŸíÿ±Ÿéÿßÿ™Ÿêÿå ŸàŸéÿ™Ÿéÿ±ŸíŸÉŸé ÿßŸÑŸíŸÖŸèŸÜŸíŸÉŸéÿ±Ÿéÿßÿ™Ÿêÿå ŸàŸéÿ≠Ÿèÿ®ŸéŸë ÿßŸÑŸíŸÖŸéÿ≥ŸéÿßŸÉŸêŸäŸÜŸêÿå ŸàŸéÿ£ŸéŸÜŸí ÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿé ŸÑŸêŸä ŸàŸéÿ™Ÿéÿ±Ÿíÿ≠ŸéŸÖŸéŸÜŸêŸäÿå ŸàŸéÿ•Ÿêÿ∞Ÿéÿß ÿ£Ÿéÿ±ŸéÿØŸíÿ™Ÿé ŸÅŸêÿ™ŸíŸÜŸéÿ©Ÿé ŸÇŸéŸàŸíŸÖŸç ŸÅŸéÿ™ŸéŸàŸéŸÅŸéŸëŸÜŸêŸä ÿ∫ŸéŸäŸíÿ±Ÿé ŸÖŸéŸÅŸíÿ™ŸèŸàŸÜŸç",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿ•ŸÜŸä ÿ£ÿ≥ÿ£ŸÑŸÉ ŸÅÿπŸÑ ÿßŸÑÿÆŸäÿ±ÿßÿ™ÿå Ÿàÿ™ÿ±ŸÉ ÿßŸÑŸÖŸÜŸÉÿ±ÿßÿ™ÿå Ÿàÿ≠ÿ® ÿßŸÑŸÖÿ≥ÿßŸÉŸäŸÜÿå Ÿàÿ£ŸÜ ÿ™ÿ∫ŸÅÿ± ŸÑŸä Ÿàÿ™ÿ±ÿ≠ŸÖŸÜŸäÿå Ÿàÿ•ÿ∞ÿß ÿ£ÿ±ÿØÿ™ ŸÅÿ™ŸÜÿ© ŸÇŸàŸÖ ŸÅÿ™ŸàŸÅŸÜŸä ÿ∫Ÿäÿ± ŸÖŸÅÿ™ŸàŸÜ",
                category: "general",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            },
            {
                id: 24,
                text: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßŸÉŸíŸÅŸêŸÜŸêŸä ÿ®Ÿêÿ≠ŸéŸÑÿßŸÑŸêŸÉŸé ÿπŸéŸÜŸí ÿ≠Ÿéÿ±ŸéÿßŸÖŸêŸÉŸéÿå ŸàŸéÿ£Ÿéÿ∫ŸíŸÜŸêŸÜŸêŸä ÿ®ŸêŸÅŸéÿ∂ŸíŸÑŸêŸÉŸé ÿπŸéŸÖŸéŸëŸÜŸí ÿ≥ŸêŸàŸéÿßŸÉŸé",
                translation: "ÿßŸÑŸÑŸáŸÖ ÿßŸÉŸÅŸÜŸä ÿ®ÿ≠ŸÑÿßŸÑŸÉ ÿπŸÜ ÿ≠ÿ±ÿßŸÖŸÉÿå Ÿàÿ£ÿ∫ŸÜŸÜŸä ÿ®ŸÅÿ∂ŸÑŸÉ ÿπŸÖŸÜ ÿ≥ŸàÿßŸÉ",
                category: "general",
                source: "ÿ≥ŸÜŸÜ ÿßŸÑÿ™ÿ±ŸÖÿ∞Ÿä"
            }
        ];
        
        // ==================== ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑŸÉÿßŸÖŸÑÿ© ====================
        const eventsData = [
            {
                id: 1,
                name: "ÿ±ÿ£ÿ≥ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸáÿ¨ÿ±Ÿäÿ©",
                month: 1,
                day: 1,
                type: "holiday",
                desc: "ÿ®ÿØÿßŸäÿ© ÿßŸÑÿπÿßŸÖ ÿßŸÑŸáÿ¨ÿ±Ÿä ÿßŸÑÿ¨ÿØŸäÿØÿå ÿßÿ≥ÿ™ÿ¥ŸáÿßÿØ ÿßŸÑÿ≠ÿ≥ŸäŸÜ ÿ®ŸÜ ÿπŸÑŸä ÿ±ÿ∂Ÿä ÿßŸÑŸÑŸá ÿπŸÜŸáŸÖÿß",
                importance: "high",
                color: "#FFD700"
            },
            {
                id: 2,
                name: "ŸäŸàŸÖ ÿπÿßÿ¥Ÿàÿ±ÿßÿ°",
                month: 1,
                day: 10,
                type: "important",
                desc: "ŸäŸàŸÖ ÿµŸäÿßŸÖ ÿπÿßÿ¥Ÿàÿ±ÿßÿ°ÿå ŸÜÿ¨ÿßÿ© ŸÖŸàÿ≥Ÿâ ÿπŸÑŸäŸá ÿßŸÑÿ≥ŸÑÿßŸÖ ŸàŸÇŸàŸÖŸá ŸÖŸÜ ŸÅÿ±ÿπŸàŸÜ",
                importance: "high",
                color: "#FF6B6B"
            },
            {
                id: 3,
                name: "ŸäŸàŸÖ ÿßŸÑÿ™ÿ±ŸàŸäÿ©",
                month: 1,
                day: 8,
                type: "important",
                desc: "ŸäŸàŸÖ ÿßŸÑÿ™ÿ±ŸàŸäÿ© ŸÅŸä ÿßŸÑÿ≠ÿ¨",
                importance: "medium",
                color: "#4ECDC4"
            },
            {
                id: 4,
                name: "ŸàŸÅÿßÿ© ÿßŸÑÿ±ÿ≥ŸàŸÑ Ô∑∫",
                month: 2,
                day: 12,
                type: "important",
                desc: "ŸàŸÅÿßÿ© ÿßŸÑŸÜÿ®Ÿä ŸÖÿ≠ŸÖÿØ ÿµŸÑŸâ ÿßŸÑŸÑŸá ÿπŸÑŸäŸá Ÿàÿ≥ŸÑŸÖ",
                importance: "high",
                color: "#FF6B6B"
            },
            {
                id: 5,
                name: "ÿßŸÑŸÖŸàŸÑÿØ ÿßŸÑŸÜÿ®ŸàŸä ÿßŸÑÿ¥ÿ±ŸäŸÅ",
                month: 3,
                day: 12,
                type: "holiday",
                desc: "ŸÖŸàŸÑÿØ ÿßŸÑŸÜÿ®Ÿä ŸÖÿ≠ŸÖÿØ ÿµŸÑŸâ ÿßŸÑŸÑŸá ÿπŸÑŸäŸá Ÿàÿ≥ŸÑŸÖ",
                importance: "high",
                color: "#FFD700"
            },
            {
                id: 6,
                name: "ÿßŸÑŸáÿ¨ÿ±ÿ© ÿßŸÑŸÜÿ®ŸàŸäÿ©",
                month: 3,
                day: 1,
                type: "important",
                desc: "ÿ®ÿØÿßŸäÿ© ÿßŸÑŸáÿ¨ÿ±ÿ© ÿßŸÑŸÜÿ®ŸàŸäÿ© ŸÖŸÜ ŸÖŸÉÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖÿØŸäŸÜÿ©",
                importance: "high",
                color: "#4ECDC4"
            },
            {
                id: 7,
                name: "ŸàŸÅÿßÿ© ÿßŸÑÿ•ŸÖÿßŸÖ ŸÖÿßŸÑŸÉ",
                month: 4,
                day: 14,
                type: "important",
                desc: "ŸàŸÅÿßÿ© ÿßŸÑÿ•ŸÖÿßŸÖ ŸÖÿßŸÑŸÉ ÿ®ŸÜ ÿ£ŸÜÿ≥ ÿ±ÿ≠ŸÖŸá ÿßŸÑŸÑŸá",
                importance: "medium",
                color: "#95A5A6"
            },
            {
                id: 8,
                name: "ŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸäÿ±ŸÖŸàŸÉ",
                month: 5,
                day: 15,
                type: "historical",
                desc: "ŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸäÿ±ŸÖŸàŸÉ ÿßŸÑŸÉÿ®ÿ±Ÿâ",
                importance: "medium",
                color: "#3498DB"
            },
            {
                id: 9,
                name: "ŸàŸÅÿßÿ© ÿπŸÖÿ± ÿ®ŸÜ ÿßŸÑÿÆÿ∑ÿßÿ®",
                month: 6,
                day: 26,
                type: "important",
                desc: "ÿßÿ≥ÿ™ÿ¥ŸáÿßÿØ ÿßŸÑÿÆŸÑŸäŸÅÿ© ÿπŸÖÿ± ÿ®ŸÜ ÿßŸÑÿÆÿ∑ÿßÿ® ÿ±ÿ∂Ÿä ÿßŸÑŸÑŸá ÿπŸÜŸá",
                importance: "high",
                color: "#FF6B6B"
            },
            {
                id: 10,
                name: "ÿßŸÑÿ•ÿ≥ÿ±ÿßÿ° ŸàÿßŸÑŸÖÿπÿ±ÿßÿ¨",
                month: 7,
                day: 27,
                type: "holiday",
                desc: "ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ•ÿ≥ÿ±ÿßÿ° ŸàÿßŸÑŸÖÿπÿ±ÿßÿ¨",
                importance: "high",
                color: "#9B59B6"
            },
            {
                id: 11,
                name: "ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ£ÿ¥Ÿáÿ± ÿßŸÑÿ≠ÿ±ŸÖ",
                month: 7,
                day: 1,
                type: "important",
                desc: "ÿ®ÿØÿßŸäÿ© ÿ¥Ÿáÿ± ÿ±ÿ¨ÿ® ÿ£ÿ≠ÿØ ÿßŸÑÿ£ÿ¥Ÿáÿ± ÿßŸÑÿ≠ÿ±ŸÖ",
                importance: "medium",
                color: "#3498DB"
            },
            {
                id: 12,
                name: "ŸÑŸäŸÑÿ© ÿßŸÑŸÜÿµŸÅ ŸÖŸÜ ÿ¥ÿπÿ®ÿßŸÜ",
                month: 8,
                day: 15,
                type: "important",
                desc: "ŸÑŸäŸÑÿ© ÿßŸÑŸÜÿµŸÅ ŸÖŸÜ ÿ¥ÿπÿ®ÿßŸÜ",
                importance: "high",
                color: "#2ECC71"
            },
            {
                id: 13,
                name: "ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÇÿ®ŸÑÿ©",
                month: 8,
                day: 15,
                type: "historical",
                desc: "ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÇÿ®ŸÑÿ© ŸÖŸÜ ÿ®Ÿäÿ™ ÿßŸÑŸÖŸÇÿØÿ≥ ÿ•ŸÑŸâ ÿßŸÑŸÉÿπÿ®ÿ©",
                importance: "medium",
                color: "#3498DB"
            },
            {
                id: 14,
                name: "ÿ®ÿØÿßŸäÿ© ÿ¥Ÿáÿ± ÿ±ŸÖÿ∂ÿßŸÜ",
                month: 9,
                day: 1,
                type: "ramadan",
                desc: "ÿ®ÿØÿßŸäÿ© ÿ¥Ÿáÿ± ÿ±ŸÖÿ∂ÿßŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ŸÉ",
                importance: "high",
                color: "#2ECC71"
            },
            {
                id: 15,
                name: "ŸÑŸäŸÑÿ© ÿßŸÑŸÇÿØÿ±",
                month: 9,
                day: 27,
                type: "ramadan",
                desc: "ŸÑŸäŸÑÿ© ÿßŸÑŸÇÿØÿ± ÿÆŸäÿ± ŸÖŸÜ ÿ£ŸÑŸÅ ÿ¥Ÿáÿ±",
                importance: "very-high",
                color: "#9B59B6"
            },
            {
                id: 16,
                name: "ÿ∫ÿ≤Ÿàÿ© ÿ®ÿØÿ± ÿßŸÑŸÉÿ®ÿ±Ÿâ",
                month: 9,
                day: 17,
                type: "historical",
                desc: "ÿ∫ÿ≤Ÿàÿ© ÿ®ÿØÿ± ÿßŸÑŸÉÿ®ÿ±Ÿâ",
                importance: "high",
                color: "#E74C3C"
            },
            {
                id: 17,
                name: "ŸÅÿ™ÿ≠ ŸÖŸÉÿ©",
                month: 9,
                day: 20,
                type: "historical",
                desc: "ŸÅÿ™ÿ≠ ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©",
                importance: "high",
                color: "#1ABC9C"
            },
            {
                id: 18,
                name: "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
                month: 10,
                day: 1,
                type: "eid",
                desc: "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ± ÿßŸÑÿ≥ÿπŸäÿØ",
                importance: "very-high",
                color: "#FFD700"
            },
            {
                id: 19,
                name: "ÿ£ŸäÿßŸÖ ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
                month: 10,
                day: 2,
                type: "eid",
                desc: "ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ´ÿßŸÜŸä ŸÖŸÜ ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
                importance: "high",
                color: "#FFD700"
            },
            {
                id: 20,
                name: "ÿ£ŸäÿßŸÖ ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
                month: 10,
                day: 3,
                type: "eid",
                desc: "ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ´ÿßŸÑÿ´ ŸÖŸÜ ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
                importance: "high",
                color: "#FFD700"
            },
            {
                id: 21,
                name: "ÿ∫ÿ≤Ÿàÿ© ÿ≠ŸÜŸäŸÜ",
                month: 10,
                day: 10,
                type: "historical",
                desc: "ÿ∫ÿ≤Ÿàÿ© ÿ≠ŸÜŸäŸÜ",
                importance: "medium",
                color: "#3498DB"
            },
            {
                id: 22,
                name: "ÿ∫ÿ≤Ÿàÿ© ÿßŸÑÿÆŸÜÿØŸÇ",
                month: 11,
                day: 5,
                type: "historical",
                desc: "ÿ∫ÿ≤Ÿàÿ© ÿßŸÑÿÆŸÜÿØŸÇ (ÿßŸÑÿ£ÿ≠ÿ≤ÿßÿ®)",
                importance: "medium",
                color: "#3498DB"
            },
            {
                id: 23,
                name: "ÿµŸÑÿ≠ ÿßŸÑÿ≠ÿØŸäÿ®Ÿäÿ©",
                month: 11,
                day: 1,
                type: "historical",
                desc: "ÿµŸÑÿ≠ ÿßŸÑÿ≠ÿØŸäÿ®Ÿäÿ©",
                importance: "medium",
                color: "#1ABC9C"
            },
            {
                id: 24,
                name: "ŸäŸàŸÖ ÿπÿ±ŸÅÿ©",
                month: 12,
                day: 9,
                type: "hajj",
                desc: "ŸäŸàŸÖ ÿπÿ±ŸÅÿ©ÿå ŸäŸàŸÖ ÿßŸÑÿ≠ÿ¨ ÿßŸÑÿ£ŸÉÿ®ÿ±",
                importance: "very-high",
                color: "#E67E22"
            },
            {
                id: 25,
                name: "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ",
                month: 12,
                day: 10,
                type: "eid",
                desc: "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ ÿßŸÑŸÖÿ®ÿßÿ±ŸÉ",
                importance: "very-high",
                color: "#FFD700"
            },
            {
                id: 26,
                name: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ",
                month: 12,
                day: 11,
                type: "hajj",
                desc: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ ÿßŸÑÿ£ŸàŸÑŸâ",
                importance: "high",
                color: "#F39C12"
            },
            {
                id: 27,
                name: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ",
                month: 12,
                day: 12,
                type: "hajj",
                desc: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ ÿßŸÑÿ´ÿßŸÜŸäÿ©",
                importance: "high",
                color: "#F39C12"
            },
            {
                id: 28,
                name: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ",
                month: 12,
                day: 13,
                type: "hajj",
                desc: "ÿ£ŸäÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ±ŸäŸÇ ÿßŸÑÿ´ÿßŸÑÿ´ÿ©",
                importance: "high",
                color: "#F39C12"
            },
            {
                id: 29,
                name: "ŸäŸàŸÖ ÿßŸÑŸÜÿ≠ÿ±",
                month: 12,
                day: 10,
                type: "hajj",
                desc: "ŸäŸàŸÖ ÿßŸÑŸÜÿ≠ÿ± (ÿ∞ÿ®ÿ≠ ÿßŸÑÿ£ÿ∂ÿßÿ≠Ÿä)",
                importance: "high",
                color: "#E74C3C"
            }
        ];
        
        // ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ====================
        const Utils = {
    pad: (n, length = 2) => {
        const str = n.toString();
        return str.length >= length ? str : '0'.repeat(length - str.length) + str;
    },
    
    formatTime24to12: (time24) => {
        if(!time24) return "--:--";
        const [hours, minutes] = time24.split(':').map(Number);
        const period = hours >= 12 ? 'ŸÖ' : 'ÿµ';
        const hours12 = hours % 12 || 12;
        return `${hours12}:${Utils.pad(minutes)} ${period}`;
    },


            
            getWeatherIcon: (code) => {
                if(code === 0) return '‚òÄÔ∏è';
                if(code <= 3) return '‚õÖ';
                if(code <= 48) return 'üå´Ô∏è';
                if(code <= 55) return 'üåßÔ∏è';
                if(code <= 65) return 'üåßÔ∏è';
                if(code <= 77) return 'üå®Ô∏è';
                if(code <= 82) return '‚õàÔ∏è';
                if(code <= 86) return 'üå®Ô∏è';
                if(code <= 99) return '‚õàÔ∏è';
                return '‚òÄÔ∏è';
            },
            
            getWeatherDescription: (code) => {
                if(code === 0) return 'ÿµÿßŸÅŸä';
                if(code <= 3) return 'ÿ∫ÿßÿ¶ŸÖ ÿ¨ÿ≤ÿ¶ŸäÿßŸã';
                if(code <= 48) return 'ÿ∂ÿ®ÿßÿ®';
                if(code <= 55) return 'ÿ±ÿ∞ÿßÿ∞';
                if(code <= 65) return 'ŸÖÿ∑ÿ±';
                if(code <= 77) return 'ÿ´ŸÑÿ¨';
                if(code <= 82) return 'ÿπŸàÿßÿµŸÅ ÿ±ÿπÿØŸäÿ©';
                if(code <= 86) return 'ÿ≤ÿÆÿßÿ™ ÿ´ŸÑÿ¨';
                if(code <= 99) return 'ÿπŸàÿßÿµŸÅ ÿ±ÿπÿØŸäÿ© ÿ¥ÿØŸäÿØÿ©';
                return 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
            }
        };
        
// ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ====================
const SoundManager = {
    playClick: () => {
        // ÿßŸÑÿ¥ÿ±ÿ∑: ÿßŸÑÿµŸàÿ™ ÿßŸÑÿπÿßŸÖ ŸÖŸÅÿπŸÑ + ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜŸÇÿ±ÿßÿ™ ŸÖŸÅÿπŸÑ
        if(!AppState.isMuted && AppState.clickSound) {
            const click = document.getElementById('click-sound');
            click.currentTime = 0;
            click.play().catch(e => {});
        }
    },
    
    playAdhan: () => {
        const adhanEnabled = document.getElementById('adhan-toggle').checked;
        // ÿßŸÑÿ¥ÿ±ÿ∑: ÿßŸÑÿµŸàÿ™ ÿßŸÑÿπÿßŸÖ ŸÖŸÅÿπŸÑ + ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ∞ÿßŸÜ ŸÖŸÅÿπŸÑ
        if(!AppState.isMuted && adhanEnabled) {
            const a = document.getElementById('adhan-audio');
            a.currentTime = 0;
            a.play().catch(e => console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∞ÿßŸÜ:", e));
        }
    },
    
    vibrate: () => {
        // ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÖÿ≥ÿ™ŸÇŸÑ ÿπŸÜ ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™ÿå ŸÑŸÉŸÜ Ÿäÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿ•ÿπÿØÿßÿØ ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤
        if(AppState.vibration && navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
};

        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ====================
        const NotificationManager = {
            show: (message, isError = false) => {
                if(!AppState.notifications && !isError) return;
                
                const notification = document.getElementById('notification');
                notification.innerText = message;
                notification.style.display = 'block';
                notification.style.background = isError ? '#ff4444' : 'var(--accent)';
                notification.style.color = isError ? '#fff' : 'var(--bg-color)';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ====================
        const LoaderManager = {
            show: () => {
                document.getElementById('loader').classList.remove('hide');
            },
            
            hide: () => {
                document.getElementById('loader').classList.add('hide');
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ====================
        const PageManager = {
            currentPage: 'home',
            
            navigateTo: (pageId) => {
                SoundManager.playClick();
                
                document.querySelectorAll('.page').forEach(p => {
                    p.classList.remove('active');
                });
                
                const targetPage = document.getElementById(`page-${pageId}`);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
                
                PageManager.updateBottomNav(pageId);
                PageManager.currentPage = pageId;
                
                switch(pageId) {
                    case 'calendar':
                        CalendarManager.fetchCalendar();
                        break;
case 'quran':
        // ŸÜÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥Ÿàÿ± ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
        if(document.getElementById('surah-list').children.length === 0) {
            QuranManager.init();
        }
        break;
                    case 'quiz':
                        QuizManager.newQuiz();
                        break;
                    case 'dua':
                        DuaManager.loadDuas();
                        break;
                    case 'events':
                        EventManager.loadEvents();
                        break;
                    case 'home':
                        ClockManager.update();
                        if (AppState.times) {
                            PrayerManager.renderHome();
                        }
                        AchievementManager.updateDisplay();
                        break;
                }
            },
            
                                    updateBottomNav: (pageId) => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                const navMap = { 'home': 0, 'calendar': 1, 'qibla': 2, 'athkar': 3, 'live': 4, 'quran': 5, 'settings': 6 };
                const navItems = document.querySelectorAll('.nav-item');
                if (navMap[pageId] !== undefined && navItems[navMap[pageId]]) {
                    navItems[navMap[pageId]].classList.add('active');
                }
            }
        }; // <--- ŸáÿßŸÖ ÿ¨ÿØÿßŸã: ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸàÿ≥ ŸàÿßŸÑŸÅÿßÿµŸÑÿ© ÿßŸÑŸÖŸÜŸÇŸàÿ∑ÿ© ŸáŸÜÿß

        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ====================
        const AchievementManager = {
            init: () => {
                const saved = localStorage.getItem('dailyAchievements');
                if(saved) {
                    AppState.dailyAchievements = JSON.parse(saved);
                }
                
                const today = new Date().toDateString();
                if(AppState.dailyAchievements.lastReset !== today) {
                    AppState.dailyAchievements = {
                        prayers: 0,
                        quranMinutes: 0,
                        lastReset: today
                    };
                    AchievementManager.save();
                }
                
                AchievementManager.updateDisplay();
            },
            
            increment: (type, value = 1) => {
                if (type !== 'dhikr') {
                    AppState.dailyAchievements[type] += value;
                    if (AppState.dailyAchievements[type] < 0) AppState.dailyAchievements[type] = 0;
                    AchievementManager.save();
                }
                AchievementManager.updateDisplay();
            },
            
            save: () => {
                localStorage.setItem('dailyAchievements', JSON.stringify(AppState.dailyAchievements));
            },
            
            updateDisplay: () => {
                const totalDhikr = Constants.dhikrList.reduce((sum, dhikr) => sum + dhikr.current, 0);
                
                document.getElementById('today-dhikr-count').textContent = totalDhikr;
                document.getElementById('today-prayer-count').textContent = AppState.dailyAchievements.prayers;
                document.getElementById('today-quran-count').textContent = AppState.dailyAchievements.quranMinutes;
                
                document.getElementById('achievement-prayers').textContent = AppState.dailyAchievements.prayers;
                document.getElementById('achievement-dhikr').textContent = totalDhikr;
                document.getElementById('achievement-quran').textContent = AppState.dailyAchievements.quranMinutes;
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≥ÿßÿπÿ© ====================
        const ClockManager = {
            update: () => {
                const d = new Date();
                
document.getElementById('digital-clock').innerText = d.toLocaleTimeString('ar-EG', {hour12:true});
                
                const hh = d.getHours() * 30 + d.getMinutes()/2;
                const mm = d.getMinutes() * 6;
                const ss = d.getSeconds() * 6;
                document.getElementById('hour-hand').style.transform = `rotate(${hh}deg)`;
                document.getElementById('min-hand').style.transform = `rotate(${mm}deg)`;
                document.getElementById('sec-hand').style.transform = `rotate(${ss}deg)`;
                
                if(AppState.times) {
                    PrayerManager.updateCountdown();
                }
                
                PrayerManager.checkPrayerTime(d);
            },
            
            start: () => {
                ClockManager.update();
                setInterval(ClockManager.update, 1000);
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÑÿßÿ© ====================
        const PrayerManager = {
            fetchData: async () => {
    LoaderManager.show();
    try {
        const now = new Date();
        const timestamp = Math.floor(now.getTime() / 1000);
        
        // ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ API ÿßŸÑÿµŸÑÿßÿ©
        const url = `https://api.aladhan.com/v1/timings/${timestamp}?latitude=${AppState.lat}&longitude=${AppState.lng}&method=${AppState.method}`;
        
        const res = await fetch(url);
        const data = await res.json();
        
        if(data.code === 200 && data.data) {
            AppState.times = {
                Fajr: data.data.timings.Fajr.substring(0, 5),
                Sunrise: data.data.timings.Sunrise.substring(0, 5),
                Dhuhr: data.data.timings.Dhuhr.substring(0, 5),
                Asr: data.data.timings.Asr.substring(0, 5),
                Maghrib: data.data.timings.Maghrib.substring(0, 5),
                Isha: data.data.timings.Isha.substring(0, 5)
            };
            
            // === ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ŸáŸÜÿß: ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ ÿßŸÑÿ∞Ÿä ŸÉÿßŸÜ Ÿäÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿßŸÑŸÖÿµŸÅŸàŸÅÿ© ===
            // ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿµŸÅŸàŸÅÿ©ÿå ŸÜÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ®ÿßŸÑŸÅÿπŸÑ
            const savedLocation = CityManager.loadSavedLocation();
            if (savedLocation) {
                document.getElementById('location-name').innerText = savedLocation.name;
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäŸÜÿ© ŸÅŸä ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ¨ÿØŸäÿØ ÿ£Ÿäÿ∂ÿßŸã
                const displayBox = document.getElementById('location-name-display');
                if(displayBox) displayBox.innerText = savedLocation.name;
            }
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßÿ≥ŸÖ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®
            const methodName = Constants.calculationMethods[AppState.method]?.name || "ÿ£ŸÖ ÿßŸÑŸÇÿ±Ÿâ";
            document.getElementById('method-name').innerText = methodName;

            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ
            const h = data.data.date.hijri;
            document.getElementById('hijri-date').innerText = `${h.day} ${h.month.ar} ${h.year} ŸáŸÄ`;
            document.getElementById('hijri-day-info').innerText = `${h.day} ${h.month.ar} ${h.year} ŸáŸÄ - ${h.weekday.ar}`;
            
            document.getElementById('greg-date').innerText = now.toLocaleDateString('ar-EG', {
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric'
            });
            
            PrayerManager.renderHome();
            localStorage.setItem('lastUpdate', new Date().toISOString());
            NotificationManager.show("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑÿµŸÑÿßÿ©");
        } else {
            NotificationManager.show("ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™", true);
        }
    } catch(e) { 
        console.error("ÿÆÿ∑ÿ£ ŸÅŸä fetchData:", e);
        NotificationManager.show("ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿå ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™", true);
    } 
    finally { 
        LoaderManager.hide();
    }
},

            
            showDefaultPrayerTimes: () => {
                AppState.times = {
                    Fajr: "05:00",
                    Sunrise: "06:30",
                    Dhuhr: "12:30",
                    Asr: "15:45",
                    Maghrib: "18:30",
                    Isha: "20:00"
                };
                
                const now = new Date();
                document.getElementById('hijri-date').innerText = "1 ÿ±ŸÖÿ∂ÿßŸÜ 1445 ŸáŸÄ";
                document.getElementById('greg-date').innerText = now.toLocaleDateString('ar-EG', {
                    weekday: 'long', 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric'
                });
                
                PrayerManager.renderHome();
                NotificationManager.show("ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©", true);
            },
            
            renderHome: () => {
                const list = document.getElementById('prayers-list');
                list.innerHTML = "";
                
                Constants.prayerKeys.forEach(k => {
                    const div = document.createElement('div');
                    div.className = 'prayer-row';
                    div.id = `row-${k}`;
                    div.innerHTML = `
                        <div style="display:flex;align-items:center;gap:10px">
                            <i class="fas ${Constants.prayerIcons[k]}"></i> ${Constants.prayerNames[k]}
                        </div>
                        <div style="font-family:'Cairo'">${Utils.formatTime24to12(AppState.times[k])}</div>
                    `;
                    list.appendChild(div);
                });
                
                PrayerManager.updateCountdown();
            },
            
            updateCountdown: () => {
                if(!AppState.times) return;
                
                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;
                
                let nextPrayer = null;
                let minDiff = Infinity;
                
                const prayerMinutes = {};
                Constants.prayerKeys.forEach(prayer => {
                    const [hours, minutes] = AppState.times[prayer].split(':').map(Number);
                    prayerMinutes[prayer] = hours * 60 + minutes;
                });
                
                for(const prayer of Constants.prayerKeys) {
                    let diff = prayerMinutes[prayer] - currentMinutes;
                    
                    if(diff < 0) {
                        diff += 24 * 60;
                    }
                    
                    if(diff < minDiff) {
                        minDiff = diff;
                        nextPrayer = prayer;
                    }
                }
                
                if(nextPrayer) {
                    document.querySelectorAll('.prayer-row').forEach(e => e.classList.remove('active'));
                    const activeRow = document.getElementById(`row-${nextPrayer}`);
                    if(activeRow) activeRow.classList.add('active');
                    
                    document.getElementById('next-prayer').innerText = Constants.prayerNames[nextPrayer];
                    
                    const hours = Math.floor(minDiff / 60);
                    const minutes = Math.floor(minDiff % 60);
                    const seconds = Math.floor((minDiff * 60) % 60);
                    
                    document.getElementById('countdown').innerText = `${Utils.pad(hours)}:${Utils.pad(minutes)}:${Utils.pad(seconds)}`;
                }
            },
            
            checkPrayerTime: (now) => {
                if(!AppState.times) return;
                
                const currentTime = `${Utils.pad(now.getHours())}:${Utils.pad(now.getMinutes())}`;
                const currentSeconds = now.getSeconds();
                
                for(const prayer of Constants.prayerKeys) {
                    if(AppState.times[prayer] && AppState.times[prayer] === currentTime && currentSeconds === 0) {
                        if(!AppState.isMuted && document.getElementById('adhan-toggle').checked) {
                            SoundManager.playAdhan();
                        }
                       // ÿßŸÑŸÉŸàÿØ ÿßŸÑÿ≠ÿßŸÑŸä
if(AppState.notifications && document.getElementById('notification-toggle').checked) {
    NotificationManager.show(`ÿ≠ÿßŸÜ ÿßŸÑÿ¢ŸÜ ŸàŸÇÿ™ ÿµŸÑÿßÿ© ${Constants.prayerNames[prayer]}`);
    
    // === ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©: ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ ===
    if (Notification.permission === "granted") {
        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÜÿ∏ÿßŸÖ Ÿäÿ∏Ÿáÿ± ŸÅŸä ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ≠ÿßŸÑÿ©
        new Notification("ÿßŸÑŸÖÿ§ÿ∞ŸÜ", {
            body: `ÿ≠ÿßŸÜ ÿßŸÑÿ¢ŸÜ ŸÖŸàÿπÿØ ÿµŸÑÿßÿ© ${Constants.prayerNames[prayer]}`,
            icon: 'https://cdn-icons-png.flaticon.com/512/4358/4358666.png', // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ£ŸäŸÇŸàŸÜÿ©
            vibrate: [200, 100, 200]
        });
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission();
    }
}

                        break;
                    }
                }
            }
        };
        
// ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿØŸÜ ŸàÿßŸÑŸÖŸàŸÇÿπ (ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿπÿßŸÑŸÖŸä ÿßŸÑÿ¨ÿØŸäÿØ) ====================
const CityManager = {
    // ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖÿå ŸÅŸÇÿ∑ ŸÜÿ≠ŸÖŸÑ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏
    initCities: () => {
        const savedLocation = CityManager.loadSavedLocation();
        if (!savedLocation) {
            // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸáŸÜÿßŸÉ ŸÖŸàŸÇÿπ ŸÖÿ≠ŸÅŸàÿ∏ÿå ÿ≠ÿßŸàŸÑ ÿ™ÿ≠ÿØŸäÿØŸá ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
            CityManager.detectLocation();
        } else {
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
            document.getElementById('location-name-display').innerText = savedLocation.name;
            PrayerManager.fetchData();
        }
    },

    // 1. ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿπÿ®ÿ± GPS Ÿàÿ™ÿ≠ŸàŸäŸÑŸá ŸÑÿßÿ≥ŸÖ ŸÖÿØŸäŸÜÿ© (Reverse Geocoding)
    detectLocation: () => {
        toggleLocationSearch(false); // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ ÿπÿ®ÿ± ÿßŸÑÿ£ŸÇŸÖÿßÿ± ÿßŸÑÿµŸÜÿßÿπŸäÿ©...");
        document.getElementById('location-name-display').innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿØŸäÿØ...';

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    AppState.lat = lat;
                    AppState.lng = lng;

                    // ÿ¨ŸÑÿ® ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäŸÜÿ© ŸÖŸÜ ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ API ŸÖÿ¨ÿßŸÜŸä
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`);
                        const data = await response.json();
                        
                        // ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿßÿ≥ŸÖ (ÿßŸÑŸÖÿØŸäŸÜÿ©ÿå ÿßŸÑÿØŸàŸÑÿ©)
                        const city = data.address.city || data.address.town || data.address.village || data.address.county || "ŸÖŸàŸÇÿπ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";
                        const country = data.address.country || "";
                        const displayName = `${city}ÿå ${country}`;

                        // ÿ≠ŸÅÿ∏ Ÿàÿ™ÿ≠ÿØŸäÿ´
                        CityManager.saveLocation(displayName, lat, lng, AppState.method);
                        document.getElementById('location-name-display').innerText = displayName;
                        
                        NotificationManager.show(`ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ: ${displayName}`);
                        PrayerManager.fetchData();
                        CompassManager.init();
                        if(AppState.weatherEnabled) WeatherManager.fetch();

                    } catch (e) {
                        console.error(e);
                        // ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿßÿ≥ŸÖÿå ŸÜÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ŸÅŸÇÿ∑
                        const displayName = `ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™: ${lat.toFixed(2)}, ${lng.toFixed(2)}`;
                        CityManager.saveLocation(displayName, lat, lng, AppState.method);
                        document.getElementById('location-name-display').innerText = displayName;
                        PrayerManager.fetchData();
                    }
                },
                (error) => {
                    console.warn('GPS Error:', error);
                    NotificationManager.show('ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸãÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ®ÿ≠ÿ´ ŸäÿØŸàŸäÿßŸã', true);
                    document.getElementById('location-name-display').innerText = "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ";
                    toggleLocationSearch(true); // ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ®ÿ≠ÿ´
                },
                { timeout: 10000, enableHighAccuracy: true }
            );
        } else {
            NotificationManager.show('ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ', true);
        }
    },

    // 2. ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿØŸäŸÜÿ© (Geocoding Search)
    searchTimeout: null,
    searchOnline: (query) => {
        const resultsDiv = document.getElementById('online-search-results');
        
        if (query.length < 2) {
            resultsDiv.style.display = 'none';
            return;
        }

        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<div style="padding:10px; text-align:center; color:var(--accent)"><i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´...</div>';

        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Debounce ŸÑÿπÿØŸÖ ÿ•ÿ±ŸáÿßŸÇ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ± ŸÖÿπ ŸÉŸÑ ÿ≠ÿ±ŸÅ
        clearTimeout(CityManager.searchTimeout);
        CityManager.searchTimeout = setTimeout(async () => {
            try {
                // ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ OpenStreetMap Nominatim API (ŸÖÿ¨ÿßŸÜŸä)
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&accept-language=ar&limit=5`);
                const data = await response.json();

                resultsDiv.innerHTML = '';
                
                if (data.length === 0) {
                    resultsDiv.innerHTML = '<div style="padding:10px; text-align:center;">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿ™ÿßÿ¶ÿ¨</div>';
                    return;
                }

                data.forEach(place => {
                    const div = document.createElement('div');
                    div.className = 'search-result-item';
                    div.innerHTML = `<i class="fas fa-map-marker-alt" style="color:var(--accent)"></i> <span>${place.display_name}</span>`;
                    
                    div.onclick = () => {
                        const lat = parseFloat(place.lat);
                        const lng = parseFloat(place.lon);
                        // ŸÜÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ£ŸàŸÑ ŸÖŸÜ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸàŸäŸÑ ŸÉÿßÿ≥ŸÖ ÿ±ÿ¶Ÿäÿ≥Ÿä
                        const shortName = place.display_name.split('ÿå')[0]; 
                        
                        AppState.lat = lat;
                        AppState.lng = lng;
                        
                        CityManager.saveLocation(shortName, lat, lng, AppState.method);
                        
                        document.getElementById('location-name-display').innerText = shortName;
                        document.getElementById('global-city-search').value = '';
                        resultsDiv.style.display = 'none';
                        toggleLocationSearch(false);
                        
                        NotificationManager.show(`ÿ™ŸÖ ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ÿ•ŸÑŸâ: ${shortName}`);
                        PrayerManager.fetchData();
                        CompassManager.init();
                        if(AppState.weatherEnabled) WeatherManager.fetch();
                    };
                    
                    resultsDiv.appendChild(div);
                });

            } catch (e) {
                console.error("Search Error", e);
                resultsDiv.innerHTML = '<div style="padding:10px; text-align:center; color:red">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´</div>';
            }
        }, 500); // ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ŸÜÿµŸÅ ÿ´ÿßŸÜŸäÿ© ÿ®ÿπÿØ ÿßŸÑÿ™ŸàŸÇŸÅ ÿπŸÜ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
    },

    saveLocation: (name, lat, lng, method) => {
        const locationData = { name, lat, lng, method };
        localStorage.setItem('userLocation', JSON.stringify(locationData));
        // ŸÜÿ≠ŸÅÿ∏ ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿäÿ∂ÿßŸã ŸÑŸÑÿπÿ±ÿ∂ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        document.getElementById('location-name').innerText = name; 
        localStorage.setItem('locationName', name);
    },

    loadSavedLocation: () => {
        const saved = localStorage.getItem('userLocation');
        if (saved) {
            const data = JSON.parse(saved);
            AppState.lat = data.lat;
            AppState.lng = data.lng;
            AppState.method = data.method;
            return data;
        }
        return null;
    }
};

// ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÅÿ™ÿ≠/ÿ∫ŸÑŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ®ÿ≠ÿ´
function toggleLocationSearch(forceState) {
    const modal = document.getElementById('location-modal');
    if (typeof forceState !== 'undefined') {
        modal.style.display = forceState ? 'flex' : 'none';
    } else {
        modal.style.display = modal.style.display === 'none' ? 'flex' : 'none';
    }
    
    if (modal.style.display === 'flex') {
        setTimeout(() => document.getElementById('global-city-search').focus(), 100);
    }
}


        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ´ŸäŸÖÿßÿ™ ====================
        const ThemeManager = {
            change: (theme) => {
                SoundManager.playClick();
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                document.getElementById('theme-select').value = theme;
                
                if(theme === 'ramadan') {
                    document.getElementById('ramadan-counter').style.display = 'flex';
                    EventManager.updateRamadanCounter();
                } else {
                    document.getElementById('ramadan-counter').style.display = 'none';
                }
            },
            
            loadSaved: () => {
                const theme = localStorage.getItem('theme') || 'kaaba';
                ThemeManager.change(theme);
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸàÿµŸÑÿ© ====================
        const CompassManager = {
            init: () => {
                const lat1 = AppState.lat * Math.PI/180;
                const lng1 = AppState.lng * Math.PI/180;
                const lat2 = 21.4225 * Math.PI/180;
                const lng2 = 39.8262 * Math.PI/180;
                
                const y = Math.sin(lng2 - lng1) * Math.cos(lat2);
                const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lng2 - lng1);
                
                let bearing = Math.atan2(y, x) * 180/Math.PI;
                bearing = (bearing + 360) % 360;
                
                const roundedBearing = Math.round(bearing);
                document.getElementById('qibla-degree').innerText = roundedBearing;
                
                CompassManager.updateDirectionText(roundedBearing);
            },
            
            updateDirectionText: (bearing) => {
                let direction = "";
                if(bearing >= 337.5 || bearing < 22.5) direction = "ÿ¥ŸÖÿßŸÑ";
                else if(bearing >= 22.5 && bearing < 67.5) direction = "ÿ¥ŸÖÿßŸÑ ÿ¥ÿ±ŸÇ";
                else if(bearing >= 67.5 && bearing < 112.5) direction = "ÿ¥ÿ±ŸÇ";
                else if(bearing >= 112.5 && bearing < 157.5) direction = "ÿ¨ŸÜŸàÿ® ÿ¥ÿ±ŸÇ";
                else if(bearing >= 157.5 && bearing < 202.5) direction = "ÿ¨ŸÜŸàÿ®";
                else if(bearing >= 202.5 && bearing < 247.5) direction = "ÿ¨ŸÜŸàÿ® ÿ∫ÿ±ÿ®";
                else if(bearing >= 247.5 && bearing < 292.5) direction = "ÿ∫ÿ±ÿ®";
                else if(bearing >= 292.5 && bearing < 337.5) direction = "ÿ¥ŸÖÿßŸÑ ÿ∫ÿ±ÿ®";
                
                document.getElementById('qibla-direction').innerText = direction;
            },
            
            start: () => {
                SoundManager.playClick();
                
                if (AppState.compassWatchId !== null) {
                    CompassManager.stop();
                    return;
                }
                
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                CompassManager.initiate();
                            } else {
                                NotificationManager.show("Ÿäÿ¨ÿ® ÿßŸÑÿ≥ŸÖÿßÿ≠ ÿ®ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ®ŸàÿµŸÑÿ©", true);
                            }
                        })
                        .catch(console.error);
                } else {
                    CompassManager.initiate();
                }
            },
            
            initiate: () => {
                if (window.DeviceOrientationEvent) {
                    window.addEventListener('deviceorientation', CompassManager.handleOrientation);
                    document.getElementById('compass-btn').innerHTML = '<i class="fas fa-stop"></i> ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ®ŸàÿµŸÑÿ©';
                    AppState.compassActive = true;
                    NotificationManager.show("ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ®ŸàÿµŸÑÿ©");
                } else {
                    NotificationManager.show("ÿ¨Ÿáÿßÿ≤ŸÉ ŸÑÿß ŸäÿØÿπŸÖ ÿßŸÑÿ®ŸàÿµŸÑÿ©", true);
                }
            },
            
            handleOrientation: (event) => {
                let alpha = event.alpha;
                
                if (event.webkitCompassHeading) {
                    alpha = event.webkitCompassHeading;
                }
                
                if (alpha !== null) {
                    AppState.currentHeading = alpha;
                    
                    const arrow = document.getElementById('compass-arrow');
                    arrow.style.transform = `translate(-50%, -100%) rotate(${360 - alpha}deg)`;
                    
                    const qiblaBearing = CompassManager.calculateQiblaBearing(AppState.lat, AppState.lng);
                    const diff = (qiblaBearing - alpha + 360) % 360;
                    
                    document.getElementById('qibla-degree').textContent = Math.round(diff);
                    
                    CompassManager.updateDirectionText(diff);
                    
                    const compass = document.getElementById('compass');
                    compass.style.transform = `rotate(${alpha}deg)`;
                }
            },
            
            calculateQiblaBearing: (lat, lng) => {
                const œÜ1 = lat * Math.PI / 180;
                const Œª1 = lng * Math.PI / 180;
                const œÜ2 = 21.4225 * Math.PI / 180;
                const Œª2 = 39.8262 * Math.PI / 180;
                
                const y = Math.sin(Œª2 - Œª1) * Math.cos(œÜ2);
                const x = Math.cos(œÜ1) * Math.sin(œÜ2) - Math.sin(œÜ1) * Math.cos(œÜ2) * Math.cos(Œª2 - Œª1);
                
                let Œ∏ = Math.atan2(y, x);
                let bearing = (Œ∏ * 180 / Math.PI + 360) % 360;
                
                return bearing;
            },
            
            stop: () => {
                if (AppState.compassWatchId) {
                    navigator.compass.clearWatch(AppState.compassWatchId);
                    AppState.compassWatchId = null;
                }
                window.removeEventListener('deviceorientation', CompassManager.handleOrientation);
                document.getElementById('compass-btn').innerHTML = '<i class="fas fa-compass"></i> ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ®ŸàÿµŸÑÿ©';
                AppState.compassActive = false;
                NotificationManager.show("ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ®ŸàÿµŸÑÿ©");
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ∞ŸÉÿßÿ± ====================
        const DhikrManager = {
            changeDhikr: (index) => {
                SoundManager.playClick();
                AppState.currentDhikrIndex = parseInt(index);
                DhikrManager.updateDisplay();
            },

            increment: () => {
                SoundManager.playClick();
                SoundManager.vibrate();
                
                const currentDhikr = Constants.dhikrList[AppState.currentDhikrIndex];
                
                if(currentDhikr.current >= currentDhikr.max) {
                    NotificationManager.show("ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑÿπÿØÿØ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®! ‚úÖ", true);
                    
                    if(AppState.vibration && navigator.vibrate) {
                        navigator.vibrate([100, 50, 100]);
                    }
                    
                    document.getElementById('tasbih-count').style.color = '#4CAF50';
                    setTimeout(() => {
                        document.getElementById('tasbih-count').style.color = 'var(--text-color)';
                    }, 1000);
                    
                    return;
                }
                
                currentDhikr.current++;
                
                DhikrManager.updateDisplay();
                DhikrManager.updateDailyTotal();
                DhikrManager.save();
                
                AchievementManager.updateDisplay();
                
                if(currentDhikr.current === currentDhikr.max) {
                    NotificationManager.show("ŸÖÿ®ÿßÿ±ŸÉ! ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑÿ∞ŸÉÿ± üéâ");
                    
                    const countElement = document.getElementById('tasbih-count');
                    const originalColor = countElement.style.color;
                    countElement.style.color = '#FFD700';
                    countElement.style.transform = 'scale(1.2)';
                    
                    setTimeout(() => {
                        countElement.style.color = originalColor;
                        countElement.style.transform = 'scale(1)';
                    }, 1000);
                } else if(currentDhikr.current === currentDhikr.max - 5) {
                    NotificationManager.show("ÿ™ÿ®ŸÇŸâ 5 ŸÅŸÇÿ∑ ŸÑŸÑÿ•ŸÉŸÖÿßŸÑ! üí´");
                }
            },

            reset: () => {
                SoundManager.playClick();
                Constants.dhikrList[AppState.currentDhikrIndex].current = 0;
                DhikrManager.updateDisplay();
                DhikrManager.save();
                AchievementManager.updateDisplay();
            },

            save: () => {
                localStorage.setItem('dhikrData', JSON.stringify(Constants.dhikrList.map(d => ({ current: d.current }))));
            },

            load: () => {
                SoundManager.playClick();
                const saved = localStorage.getItem('dhikrData');
                if(saved) {
                    const savedData = JSON.parse(saved);
                    savedData.forEach((item, index) => {
                        if(Constants.dhikrList[index]) {
                            Constants.dhikrList[index].current = item.current;
                        }
                    });
                    DhikrManager.updateDisplay();
                    DhikrManager.updateDailyTotal();
                    AchievementManager.updateDisplay();
                    NotificationManager.show("ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ£ÿ∞ŸÉÿßÿ±");
                }
            },

            updateDisplay: () => {
                const current = Constants.dhikrList[AppState.currentDhikrIndex];
                document.getElementById('tasbih-count').textContent = current.current;
                document.getElementById('dhikr-text').textContent = current.arabic;
                document.getElementById('dhikr-target').textContent = `/ ${current.max}`;
            },

            updateDailyTotal: () => {
    // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÖŸàÿ¨ŸàÿØÿ© ŸÇÿ®ŸÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®
    if (!Constants.dhikrList) return;
    
    const total = Constants.dhikrList.reduce((sum, dhikr) => sum + (dhikr.current || 0), 0);
    const element = document.getElementById('daily-total');
    if (element) {
        element.textContent = `${total} ÿ∞ŸÉÿ±`;
    }
},

            
            loadFromStorage: () => {
                const saved = localStorage.getItem('dhikrData');
                if(saved) {
                    const savedData = JSON.parse(saved);
                    savedData.forEach((item, index) => {
                        if(Constants.dhikrList[index]) {
                            Constants.dhikrList[index].current = item.current;
                        }
                    });
                }
                DhikrManager.updateDailyTotal();
                DhikrManager.updateDisplay();
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ŸÇŸàŸäŸÖ ====================
        const CalendarManager = {
            fetchCalendar: async () => {
                try {
                    const url = `https://api.aladhan.com/v1/calendar/${AppState.currentYear}/${AppState.currentMonth}?latitude=${AppState.lat}&longitude=${AppState.lng}&method=${AppState.method}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    if(data.code === 200 && data.data) {
                        CalendarManager.render(data.data);
                    }
                } catch(e) {
                    console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ™ŸÇŸàŸäŸÖ:", e);
                    NotificationManager.show("ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇŸàŸäŸÖ", true);
                    CalendarManager.render([]);
                }
            },

            render: (calendarData) => {
                const tbody = document.getElementById('calendar-body');
                tbody.innerHTML = '';
                
                const today = new Date();
                const currentDay = today.getDate();
                const currentMonth = today.getMonth() + 1;
                
                if(calendarData.length === 0) {
                    for(let i = 1; i <= 30; i++) {
                        const tr = document.createElement('tr');
                        const isToday = (i === currentDay && AppState.currentMonth === currentMonth);
                        
                        tr.className = isToday ? 'today-row' : '';
                        tr.innerHTML = `
                            <td>${i}</td>
                            <td>05:00</td>
                            <td>12:30</td>
                            <td>15:45</td>
                            <td>18:30</td>
                            <td>20:00</td>
                        `;
                        tbody.appendChild(tr);
                    }
                } else {
                    calendarData.forEach(day => {
                        const dayNum = day.date.gregorian.day;
                        const isToday = (parseInt(dayNum) === currentDay && AppState.currentMonth === currentMonth);
                        
                        const tr = document.createElement('tr');
                        tr.className = isToday ? 'today-row' : '';
                        tr.innerHTML = `
                            <td>${dayNum}</td>
                            <td>${day.timings.Fajr.substring(0,5)}</td>
                            <td>${day.timings.Dhuhr.substring(0,5)}</td>
                            <td>${day.timings.Asr.substring(0,5)}</td>
                            <td>${day.timings.Maghrib.substring(0,5)}</td>
                            <td>${day.timings.Isha.substring(0,5)}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
                CalendarManager.updateMonthDisplay();
            },

            updateMonthDisplay: () => {
                const monthNames = [
                    "ŸäŸÜÿßŸäÿ±", "ŸÅÿ®ÿ±ÿßŸäÿ±", "ŸÖÿßÿ±ÿ≥", "ÿ£ÿ®ÿ±ŸäŸÑ", "ŸÖÿßŸäŸà", "ŸäŸàŸÜŸäŸà",
                    "ŸäŸàŸÑŸäŸà", "ÿ£ÿ∫ÿ≥ÿ∑ÿ≥", "ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±", "ÿ£ŸÉÿ™Ÿàÿ®ÿ±", "ŸÜŸàŸÅŸÖÿ®ÿ±", "ÿØŸäÿ≥ŸÖÿ®ÿ±"
                ];
                
                document.getElementById('current-month').textContent = 
                    `${monthNames[AppState.currentMonth - 1]} ${AppState.currentYear}`;
            },

            prevMonth: () => {
                SoundManager.playClick();
                AppState.currentMonth--;
                if(AppState.currentMonth < 1) {
                    AppState.currentMonth = 12;
                    AppState.currentYear--;
                }
                CalendarManager.fetchCalendar();
            },

            nextMonth: () => {
                SoundManager.playClick();
                AppState.currentMonth++;
                if(AppState.currentMonth > 12) {
                    AppState.currentMonth = 1;
                    AppState.currentYear++;
                }
                CalendarManager.fetchCalendar();
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ŸÇÿ≥ ====================
        const WeatherManager = {
            fetch: async () => {
                if(!AppState.weatherEnabled) return;
                
                if(AppState.lastWeatherUpdate && (new Date() - AppState.lastWeatherUpdate) < 30 * 60 * 1000) {
                    return;
                }
                
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${AppState.lat}&longitude=${AppState.lng}&current_weather=true&timezone=auto`;
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    if(data && data.current_weather) {
                        const temp = data.current_weather.temperature;
                        const windspeed = data.current_weather.windspeed;
                        const weathercode = data.current_weather.weathercode;
                        
                        document.getElementById('weather-temp').innerText = `${temp}¬∞C`;
                        
                        const weatherDesc = Utils.getWeatherDescription(weathercode);
                        document.getElementById('weather-desc').innerText = weatherDesc;
                        
                        const weatherIcon = Utils.getWeatherIcon(weathercode);
                        document.getElementById('weather-icon').innerText = weatherIcon;
                        
                        document.getElementById('weather-details').innerText = 
                            `ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ©: ${temp}¬∞C | ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ±Ÿäÿßÿ≠: ${windspeed} ŸÉŸÖ/ÿ≥`;
                        
                        document.getElementById('weather-info').style.display = 'flex';
                        document.getElementById('weather-card').style.display = 'flex';
                        
                        AppState.lastWeatherUpdate = new Date();
                    }
                } catch(e) {
                    console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÇÿ≥:", e);
                }
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿØÿπŸäÿ© ====================
        const DuaManager = {
            loadDuas: () => {
                const list = document.getElementById('dua-list');
                list.innerHTML = '';
                
                duaData.forEach(dua => {
                    const card = document.createElement('div');
                    card.className = 'dua-card';
                    card.dataset.category = dua.category;
                    card.innerHTML = `
                        <div class="dua-text" style="font-family: 'Amiri', serif; font-size: 1.3rem; line-height: 1.6; margin-bottom: 15px;">
                            ${dua.text}
                        </div>
                        <div class="dua-translation" style="font-size: 0.95rem; color: var(--accent); margin-bottom: 10px; border-right: 3px solid var(--accent); padding-right: 10px;">
                            ${dua.translation}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; font-size: 0.85rem; opacity: 0.7;">
                            <span>${dua.source}</span>
                            <button onclick="DuaManager.copyToClipboard('${dua.text.replace(/'/g, "\\'")}')" class="btn-outline" style="padding: 5px 15px; font-size: 0.8rem;">
                                <i class="fas fa-copy"></i> ŸÜÿ≥ÿÆ
                            </button>
                        </div>
                    `;
                    
                    list.appendChild(card);
                });
            },
            
            filterDua: (category) => {
                SoundManager.playClick();
                
                document.querySelectorAll('.dua-category').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                const allDuas = document.querySelectorAll('.dua-card');
                allDuas.forEach(dua => {
                    if(category === 'all' || dua.dataset.category === category) {
                        dua.style.display = 'block';
                        dua.style.animation = 'fadeIn 0.5s ease';
                    } else {
                        dua.style.display = 'none';
                    }
                });
                
                const count = Array.from(allDuas).filter(dua => 
                    category === 'all' || dua.dataset.category === category
                ).length;
                
                NotificationManager.show(`ÿπÿ±ÿ∂ ${count} ÿØÿπÿßÿ°`);
            },
            
            copyToClipboard: (text) => {
                SoundManager.playClick();
                
                navigator.clipboard.writeText(text).then(() => {
                    NotificationManager.show('ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿØÿπÿßÿ° ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿßŸÅÿ∏ÿ©');
                }).catch(err => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜÿ≥ÿÆ:', err);
                    NotificationManager.show('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜÿ≥ÿÆ', true);
                });
            },
            
            searchDuas: (searchTerm) => {
                const term = searchTerm.toLowerCase().trim();
                if(term.length < 2) {
                    DuaManager.loadDuas();
                    return;
                }
                
                const filteredDuas = duaData.filter(dua => 
                    dua.text.toLowerCase().includes(term) || 
                    dua.translation.toLowerCase().includes(term) ||
                    dua.source.toLowerCase().includes(term)
                );
                
                const list = document.getElementById('dua-list');
                list.innerHTML = '';
                
                if(filteredDuas.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--accent);">
                            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <div>ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ£ÿØÿπŸäÿ© ÿ™ÿ∑ÿßÿ®ŸÇ "${searchTerm}"</div>
                        </div>
                    `;
                    return;
                }
                
                filteredDuas.forEach(dua => {
                    const card = document.createElement('div');
                    card.className = 'dua-card';
                    card.innerHTML = `
                        <div class="dua-text" style="font-family: 'Amiri', serif; font-size: 1.3rem; line-height: 1.6; margin-bottom: 15px;">
                            ${dua.text}
                        </div>
                        <div class="dua-translation" style="font-size: 0.95rem; color: var(--accent); margin-bottom: 10px; border-right: 3px solid var(--accent); padding-right: 10px;">
                            ${dua.translation}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; font-size: 0.85rem; opacity: 0.7;">
                            <span>${dua.source}</span>
                            <span style="background: ${dua.category === 'morning' ? '#3498db' : dua.category === 'evening' ? '#e74c3c' : dua.category === 'prayer' ? '#2ecc71' : '#9b59b6'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">
                                ${dua.category === 'morning' ? 'ÿßŸÑÿµÿ®ÿßÿ≠' : dua.category === 'evening' ? 'ÿßŸÑŸÖÿ≥ÿßÿ°' : dua.category === 'prayer' ? 'ÿßŸÑÿµŸÑÿßÿ©' : 'ÿπÿßŸÖ'}
                            </span>
                        </div>
                    `;
                    
                    list.appendChild(card);
                });
                
                NotificationManager.show(`ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${filteredDuas.length} ÿØÿπÿßÿ°`);
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ====================
        const EventManager = {
            loadEvents: () => {
                const eventsList = document.getElementById('events-list');
                eventsList.innerHTML = "";
                
                const sortedEvents = [...eventsData].sort((a, b) => {
                    if (a.month === b.month) {
                        return a.day - b.day;
                    }
                    return a.month - b.month;
                });
                
                sortedEvents.forEach(event => {
                    const eventCard = EventManager.createEventCard(event);
                    eventsList.appendChild(eventCard);
                });
                
                EventManager.updateRamadanCounter();
                EventManager.showNextEvent();
            },
            
            createEventCard: (event) => {
                const eventCard = document.createElement('div');
                let eventClass = 'event-card';
                
                switch(event.type) {
                    case 'eid':
                        eventClass += ' event-eid';
                        break;
                    case 'ramadan':
                        eventClass += ' event-ramadan';
                        break;
                    case 'hajj':
                        eventClass += ' event-important';
                        break;
                    case 'holiday':
                        eventClass += ' event-holiday';
                        break;
                    case 'important':
                        eventClass += ' event-important';
                        break;
                }
                
                let importanceColor = '#95A5A6';
                let importanceText = 'ÿπÿßÿØŸä';
                
                switch(event.importance) {
                    case 'very-high':
                        importanceColor = '#E74C3C';
                        importanceText = 'ÿπÿßŸÑŸä ÿ¨ÿØÿßŸã';
                        break;
                    case 'high':
                        importanceColor = '#E67E22';
                        importanceText = 'ÿπÿßŸÑŸä';
                        break;
                    case 'medium':
                        importanceColor = '#3498DB';
                        importanceText = 'ŸÖÿ™Ÿàÿ≥ÿ∑';
                        break;
                }
                
                let icon = 'fa-calendar';
                switch(event.type) {
                    case 'eid':
                        icon = 'fa-gift';
                        break;
                    case 'ramadan':
                        icon = 'fa-moon';
                        break;
                    case 'hajj':
                        icon = 'fa-kaaba';
                        break;
                    case 'holiday':
                        icon = 'fa-star';
                        break;
                    case 'historical':
                        icon = 'fa-landmark';
                        break;
                }
                
                const monthName = Constants.hijriMonths[event.month - 1];
                eventCard.className = eventClass;
                eventCard.innerHTML = `
                    <div class="event-date">
                        <i class="fas ${icon}"></i>
                        <span>${event.day} ${monthName}</span>
                        <span style="margin-right: auto; margin-left: 10px; background: ${importanceColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem;">
                            ${importanceText}
                        </span>
                    </div>
                    <div class="event-title">${event.name}</div>
                    <div class="event-desc">${event.desc}</div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem; opacity: 0.8;">
                        <span>${event.type === 'eid' ? 'üéâ ÿπŸäÿØ' : event.type === 'ramadan' ? 'üåô ÿ±ŸÖÿ∂ÿßŸÜ' : event.type === 'hajj' ? 'üïã ÿ≠ÿ¨' : 'üìÖ ŸÖŸÜÿßÿ≥ÿ®ÿ©'}</span>
                        <button onclick="EventManager.shareEvent(${event.id})" class="btn-outline" style="padding: 2px 10px; font-size: 0.7rem;">
                            <i class="fas fa-share-alt"></i> ŸÖÿ¥ÿßÿ±ŸÉÿ©
                        </button>
                    </div>
                `;
                
                eventCard.style.transition = 'all 0.3s ease';
                eventCard.style.cursor = 'pointer';
                eventCard.onmouseenter = () => {
                    eventCard.style.transform = 'translateY(-5px)';
                    eventCard.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
                };
                eventCard.onmouseleave = () => {
                    eventCard.style.transform = 'translateY(0)';
                    eventCard.style.boxShadow = 'none';
                };
                
                eventCard.onclick = () => EventManager.showEventDetails(event);
                
                return eventCard;
            },
            
            showEventDetails: (event) => {
                SoundManager.playClick();
                
                const monthName = Constants.hijriMonths[event.month - 1];
                const detailsHTML = `
                    <div style="background: var(--card-bg); border-radius: 15px; padding: 20px; margin: 20px; max-width: 400px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 2.5rem; color: ${event.color || 'var(--accent)'}; margin-bottom: 10px;">
                                <i class="fas ${event.type === 'eid' ? 'fa-gift' : event.type === 'ramadan' ? 'fa-moon' : event.type === 'hajj' ? 'fa-kaaba' : 'fa-calendar'}"></i>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;">${event.name}</div>
                            <div style="color: var(--accent); font-size: 1.1rem;">${event.day} ${monthName}</div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px; color: var(--accent);">üìù ÿßŸÑŸàÿµŸÅ:</div>
                            <div style="line-height: 1.6;">${event.desc}</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.8rem; opacity: 0.7;">ÿßŸÑŸÜŸàÿπ</div>
                                <div style="font-weight: bold;">${event.type === 'eid' ? 'ÿπŸäÿØ' : event.type === 'ramadan' ? 'ÿ±ŸÖÿ∂ÿßŸÜ' : event.type === 'hajj' ? 'ÿ≠ÿ¨' : 'ŸÖŸÜÿßÿ≥ÿ®ÿ©'}</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.8rem; opacity: 0.7;">ÿßŸÑÿ£ŸáŸÖŸäÿ©</div>
                                <div style="font-weight: bold; color: ${event.importance === 'very-high' ? '#E74C3C' : event.importance === 'high' ? '#E67E22' : '#3498DB'}">
                                    ${event.importance === 'very-high' ? 'ÿπÿßŸÑŸä ÿ¨ÿØÿßŸã' : event.importance === 'high' ? 'ÿπÿßŸÑŸä' : 'ŸÖÿ™Ÿàÿ≥ÿ∑'}
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="EventManager.shareEvent(${event.id})" class="btn-outline" style="flex: 1;">
                                <i class="fas fa-share-alt"></i> ŸÖÿ¥ÿßÿ±ŸÉÿ©
                            </button>
                            <button onclick="closeModal()" class="btn-outline" style="flex: 1; background: var(--accent); color: var(--bg-color); border: none;">
                                <i class="fas fa-times"></i> ÿ•ÿ∫ŸÑÿßŸÇ
                            </button>
                        </div>
                    </div>
                `;
                
                EventManager.showModal(detailsHTML, 'ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©');
            },
            
            shareEvent: (eventId) => {
                SoundManager.playClick();
                
                const event = eventsData.find(e => e.id === eventId);
                if (!event) return;
                
                const monthName = Constants.hijriMonths[event.month - 1];
                const shareText = `ŸÖŸÜÿßÿ≥ÿ®ÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©: ${event.name}\nÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ${event.day} ${monthName}\n${event.desc}\n\nŸÖŸÜ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖÿ§ÿ∞ŸÜ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸä`;
                
                if (navigator.share) {
                    navigator.share({
                        title: event.name,
                        text: shareText,
                        url: window.location.href
                    }).then(() => {
                        NotificationManager.show('ÿ™ŸÖÿ™ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                    }).catch(error => {
                        console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©:', error);
                        EventManager.copyToClipboard(shareText);
                    });
                } else {
                    EventManager.copyToClipboard(shareText);
                }
            },
            
            copyToClipboard: (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    NotificationManager.show('ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿßŸÅÿ∏ÿ©');
                });
            },
            
            showModal: (content, title = '') => {
                const modal = document.createElement('div');
                modal.id = 'custom-modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="background: var(--card-bg); border-radius: 15px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto;">
                        ${title ? `<div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 1.2rem; font-weight: bold;">${title}</div>` : ''}
                        ${content}
                    </div>
                `;
                
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                };
                
                document.body.appendChild(modal);
            },
            
            updateRamadanCounter: () => {
                const today = new Date();
                const ramadanStart = new Date(today.getFullYear(), 3, 2);
                const diffTime = Math.abs(today - ramadanStart);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const ramadanCounter = document.getElementById('ramadan-counter');
                if (diffDays >= 0 && diffDays <= 30) {
                    ramadanCounter.style.display = 'flex';
                    document.getElementById('ramadan-days').textContent = `ÿßŸÑŸäŸàŸÖ ${diffDays + 1} ŸÖŸÜ ÿ±ŸÖÿ∂ÿßŸÜ`;
                    
                    ramadanCounter.innerHTML = `
                        <div>
                            <div style="font-size:1.2rem; font-weight:bold">üåô ÿ¥Ÿáÿ± ÿ±ŸÖÿ∂ÿßŸÜ ÿßŸÑŸÖÿ®ÿßÿ±ŸÉ</div>
                            <div>ÿßŸÑŸäŸàŸÖ ${diffDays + 1} ŸÖŸÜ ÿ±ŸÖÿ∂ÿßŸÜ</div>
                            <div style="font-size:0.9rem; opacity:0.8; margin-top:5px">${30 - diffDays} ŸäŸàŸÖ ŸÖÿ™ÿ®ŸÇŸä ŸÑŸÑÿ•ŸÅÿ∑ÿßÿ±</div>
                        </div>
                        <div style="font-size:2.5rem; color:#ffd700">
                            <i class="fas fa-moon"></i>
                        </div>
                    `;
                } else {
                    ramadanCounter.style.display = 'none';
                }
            },
            
            showNextEvent: () => {
                const today = new Date();
                const todayHijri = EventManager.getHijriDate(today);
                
                const upcomingEvents = eventsData.filter(event => {
                    if (event.month > todayHijri.month || 
                        (event.month === todayHijri.month && event.day >= todayHijri.day)) {
                        return true;
                    }
                    return false;
                }).sort((a, b) => {
                    if (a.month === b.month) return a.day - b.day;
                    return a.month - b.month;
                });
                
                if (upcomingEvents.length > 0) {
                    const nextEvent = upcomingEvents[0];
                    const monthName = Constants.hijriMonths[nextEvent.month - 1];
                    
                    document.getElementById('next-event-notification').style.display = 'flex';
                    document.getElementById('next-event-title').textContent = nextEvent.name;
                    document.getElementById('next-event-time').textContent = `${nextEvent.day} ${monthName} - ${nextEvent.desc}`;
                    
                    const notification = document.getElementById('next-event-notification');
                    if (!notification.querySelector('.close-btn')) {
                        const closeBtn = document.createElement('button');
                        closeBtn.className = 'close-btn';
                        closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                        closeBtn.style.cssText = `
                            background: none;
                            border: none;
                            color: white;
                            cursor: pointer;
                            font-size: 1rem;
                            margin-right: auto;
                        `;
                        closeBtn.onclick = () => {
                            notification.style.display = 'none';
                        };
                        notification.appendChild(closeBtn);
                    }
                }
            },
            
            getHijriDate: (date) => {
                const islamicYearStart = 622;
                const currentYear = date.getFullYear();
                const hijriYear = Math.floor((currentYear - islamicYearStart) * 0.97);
                
                const daysInYear = date.getDayOfYear ? date.getDayOfYear() : 
                    Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                
                const hijriMonth = Math.floor((daysInYear % 354) / 29.5) + 1;
                const hijriDay = Math.floor((daysInYear % 354) % 29.5) + 1;
                
                return {
                    year: hijriYear,
                    month: hijriMonth,
                    day: hijriDay
                };
            },
            
            searchEvents: (searchTerm) => {
                const term = searchTerm.toLowerCase().trim();
                const eventsList = document.getElementById('events-list');
                
                if (term.length < 2) {
                    EventManager.loadEvents();
                    return;
                }
                
                const filteredEvents = eventsData.filter(event => 
                    event.name.toLowerCase().includes(term) || 
                    event.desc.toLowerCase().includes(term) ||
                    Constants.hijriMonths[event.month - 1].toLowerCase().includes(term)
                );
                
                eventsList.innerHTML = '';
                
                if (filteredEvents.length === 0) {
                    eventsList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--accent); grid-column: 1 / -1;">
                            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <div>ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿ™ÿ∑ÿßÿ®ŸÇ "${searchTerm}"</div>
                        </div>
                    `;
                    return;
                }
                
                filteredEvents.forEach(event => {
                    const eventCard = EventManager.createEventCard(event);
                    eventsList.appendChild(eventCard);
                });
                
                NotificationManager.show(`ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${filteredEvents.length} ŸÖŸÜÿßÿ≥ÿ®ÿ©`);
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ====================
        const CardManager = {
            loadBackgrounds: () => {
                const grid = document.getElementById('background-grid');
                grid.innerHTML = '';
                
                Constants.cardBackgrounds.forEach((bg, index) => {
                    const thumb = document.createElement('div');
                    thumb.className = 'bg-thumbnail';
                    thumb.style.backgroundImage = `url('${bg}')`;
                    thumb.onclick = () => CardManager.selectBackground(index);
                    
                    if(index === AppState.selectedCardBackground) {
                        thumb.classList.add('active');
                    }
                    
                    grid.appendChild(thumb);
                });
                
                CardManager.loadLocalBackgrounds();
                CardManager.update();
            },
            
            loadLocalBackgrounds: () => {
                const savedBackgrounds = JSON.parse(localStorage.getItem('cardBackgrounds') || '[]');
                savedBackgrounds.forEach((bgData, index) => {
                    const thumb = document.createElement('div');
                    thumb.className = 'bg-thumbnail';
                    thumb.style.backgroundImage = `url('${bgData}')`;
                    thumb.onclick = () => CardManager.selectLocalBackground(index);
                    
                    const grid = document.getElementById('background-grid');
                    grid.appendChild(thumb);
                });
            },
            
            uploadBackground: (event) => {
                const file = event.target.files[0];
                if(!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const bgData = e.target.result;
                    
                    const savedBackgrounds = JSON.parse(localStorage.getItem('cardBackgrounds') || '[]');
                    savedBackgrounds.push(bgData);
                    localStorage.setItem('cardBackgrounds', JSON.stringify(savedBackgrounds));
                    
                    const thumb = document.createElement('div');
                    thumb.className = 'bg-thumbnail';
                    thumb.style.backgroundImage = `url('${bgData}')`;
                    thumb.onclick = () => {
                        document.getElementById('card-bg').style.backgroundImage = `url('${bgData}')`;
                        document.querySelectorAll('.bg-thumbnail').forEach(t => t.classList.remove('active'));
                        thumb.classList.add('active');
                    };
                    
                    const grid = document.getElementById('background-grid');
                    grid.appendChild(thumb);
                    
                    NotificationManager.show('ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿÆŸÑŸÅŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                };
                reader.readAsDataURL(file);
            },
            
            selectLocalBackground: (index) => {
                SoundManager.playClick();
                const savedBackgrounds = JSON.parse(localStorage.getItem('cardBackgrounds') || '[]');
                if(savedBackgrounds[index]) {
                    document.getElementById('card-bg').style.backgroundImage = 
                        `url('${savedBackgrounds[index]}')`;
                    
                    document.querySelectorAll('.bg-thumbnail').forEach((thumb, i) => {
                        thumb.classList.toggle('active', i === (index + Constants.cardBackgrounds.length));
                    });
                }
            },
            
            selectBackground: (index) => {
                SoundManager.playClick();
                AppState.selectedCardBackground = index;
                document.querySelectorAll('.bg-thumbnail').forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === index);
                });
                document.getElementById('card-bg').style.backgroundImage = 
                    `url('${Constants.cardBackgrounds[index]}')`;
            },
            
            selectLogo: (logoType) => {
                SoundManager.playClick();
                AppState.selectedLogo = logoType;
                const logoElement = document.getElementById('card-logo');
                logoElement.innerHTML = '';
                let icon = 'fas fa-mosque';
                let color = 'var(--accent)';
                switch(logoType) {
                    case 'kaaba': icon = 'fas fa-kaaba'; color = '#d4af37'; break;
                    case 'star': icon = 'fas fa-star'; color = '#4CAF50'; break;
                    case 'moon': icon = 'fas fa-moon'; color = '#2196F3'; break;
                }
                const i = document.createElement('i');
                i.className = icon;
                logoElement.appendChild(i);
                logoElement.style.borderColor = color;
            },
            
            update: () => {
                const name = document.getElementById('card-name').value || 'ÿßÿ≥ŸÖŸÉ ŸáŸÜÿß';
                const message = document.getElementById('card-message').value || 'ÿ™ŸáŸÜÿ¶ÿ© ÿ∑Ÿäÿ®ÿ©';
                document.getElementById('card-name-display').textContent = name;
                document.getElementById('card-message-display').textContent = message;
            },
            
            download: async () => {
                SoundManager.playClick();
                NotificationManager.show('ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ...');
                
                if(typeof html2canvas === 'function') {
                    try {
                        const cardElement = document.getElementById('card-preview');
                        
                        const canvas = await html2canvas(cardElement, {
                            scale: 2,
                            backgroundColor: null,
                            logging: false,
                            useCORS: true
                        });
                        
                        const link = document.createElement('a');
                        link.download = 'ÿ®ÿ∑ÿßŸÇÿ©-ÿ™ŸáŸÜÿ¶ÿ©-ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        
                        NotificationManager.show('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿ®ŸÜÿ¨ÿßÿ≠ ‚úÖ');
                        
                    } catch(error) {
                        console.error('ÿÆÿ∑ÿ£ ŸÅŸä html2canvas:', error);
                        CardManager.fallbackDownload();
                    }
                } else {
                    CardManager.fallbackDownload();
                }
            },

            fallbackDownload: () => {
                const cardPreview = document.getElementById('card-preview');
                const bgUrl = cardPreview.style.backgroundImage.slice(5, -2);
                
                const link = document.createElement('a');
                link.download = 'ÿ®ÿ∑ÿßŸÇÿ©-ÿ™ŸáŸÜÿ¶ÿ©.png';
                link.href = bgUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDUwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiMxQTIzN0UiLz48dGV4dCB4PSIyNTAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Ô∫ëÔªÑÔ∫éÔªóÔ∫î Ô∫óÔª¨Ôª®Ô∫åÔ∫î Ô∫áÔ∫≥ÔªºÔª£Ôª¥Ô∫îPC90ZXh0Pjwvc3ZnPg==';
                link.click();
                
                NotificationManager.show('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©');
            },
            
            share: () => {
                SoundManager.playClick();
                if(navigator.share) {
                    navigator.share({
                        title: 'ÿ®ÿ∑ÿßŸÇÿ© ÿ™ŸáŸÜÿ¶ÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©',
                        text: 'ÿ™ŸáŸÜÿ¶ÿ© ÿ∑Ÿäÿ®ÿ© ÿ®ŸÖŸÜÿßÿ≥ÿ®ÿ© ÿßŸÑÿπŸäÿØ',
                        url: window.location.href
                    }).then(() => {
                        NotificationManager.show('ÿ™ŸÖÿ™ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                    }).catch(error => {
                        console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©:', error);
                        NotificationManager.show('ŸÑŸÖ ÿ™ÿ™ŸÖ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©', true);
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        NotificationManager.show('ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑');
                    });
                }
            }
        };
        
		
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ====================
        const StreamManager = {
            playMakkahStream: () => {
                SoundManager.playClick();
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ÿ´ ŸÖŸÜ ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©...");
                StreamManager.loadYouTubeEmbed('makkah-stream', 'Eebw68Bj6aE');
                const streamContainer = document.getElementById('makkah-stream');
                
                streamContainer.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.src = "https://www.youtube.com/embed/Eebw68Bj6aE?si=ilMGLUkTFkkxklsh&autoplay=1&playsinline=1&rel=0&modestbranding=1&showinfo=0&controls=1&mute=0";
                iframe.title = "ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ÿßŸÑÿ≠ÿ±ŸÖ ÿßŸÑŸÖŸÉŸä";
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                iframe.referrerpolicy = "strict-origin-when-cross-origin";
                iframe.allowFullscreen = true;
                iframe.style.width = "100%";
                iframe.style.height = "100%";
                iframe.style.border = "none";
                
                streamContainer.appendChild(iframe);
                streamContainer.style.display = 'block';
                document.getElementById('makkah-alternative').style.display = 'none';
            },
            
            playMadinahStream: () => {
                SoundManager.playClick();
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ÿ´ ŸÖŸÜ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©...");
                StreamManager.loadYouTubeEmbed('madinah-stream', 'TpT8b8JFZ6E');
                const streamContainer = document.getElementById('madinah-stream');
                
                streamContainer.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.src = "https://www.youtube.com/embed/TpT8b8JFZ6E?si=OmMzG8GoW-mXnkv0&autoplay=1&playsinline=1&rel=0&modestbranding=1&showinfo=0&controls=1&mute=0";
                iframe.title = "ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ÿßŸÑÿ≠ÿ±ŸÖ ÿßŸÑŸÖÿØŸÜŸä";
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                iframe.referrerpolicy = "strict-origin-when-cross-origin";
                iframe.allowFullscreen = true;
                iframe.style.width = "100%";
                iframe.style.height = "100%";
                iframe.style.border = "none";
                
                streamContainer.appendChild(iframe);
                streamContainer.style.display = 'block';
                document.getElementById('madinah-alternative').style.display = 'none';
            },
                        playRadioCairo: () => {
                SoundManager.playClick();
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ•ÿ∞ÿßÿπÿ© ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ ŸÖŸÜ ÿßŸÑŸÇÿßŸáÿ±ÿ©...");
                
                // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿπŸÜÿµÿ± ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
                const audio = document.getElementById('quran-audio');
                // ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ®ÿ´ ÿßŸÑÿ∞Ÿä ÿ£ÿ±ÿ≥ŸÑÿ™Ÿá
                audio.src = 'https://stream.radiojar.com/8s5u5tpdtwzuv';
                
                audio.play().catch(e => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà:', e);
                    NotificationManager.show('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ÿ´ÿå ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã', true);
                });
            },

            loadYouTubeEmbed: (containerId, videoId) => {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.width = "100%";
                iframe.height = "100%";
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&playsinline=1&rel=0&modestbranding=1&showinfo=0&controls=1`;
                iframe.title = "YouTube video player";
                iframe.frameBorder = "0";
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                iframe.allowFullscreen = true;
                iframe.id = `youtube-${containerId}`;
                
                container.appendChild(iframe);
                container.style.display = 'block';
                
                return iframe;
            },
            
            openYouTubeMakkah: () => {
                SoundManager.playClick();
                window.open('https://www.youtube.com/live/-PTPGZQN3l0', '_blank');
                NotificationManager.show("ŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ŸÖŸÉÿ© ŸÅŸä YouTube");
            },
            
            openYouTubeMadinah: () => {
                SoundManager.playClick();
                window.open('https://www.youtube.com/live/GFMfFcrJMHY', '_blank');
                NotificationManager.show("ŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ÿßŸÑŸÖÿØŸäŸÜÿ© ŸÅŸä YouTube");
            },
            
            playRadioMakkah: () => {
                SoundManager.playClick();
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ±ÿßÿØŸäŸà ÿßŸÑÿ≠ÿ±ŸÖ ÿßŸÑŸÖŸÉŸä...");
                
                const audio = document.getElementById('quran-audio');
                audio.src = 'https://qurango.net/radio/tarateel';
                audio.play().catch(e => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà:', e);
                    NotificationManager.show('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿπÿ®ÿ± ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ≥ŸÖŸä ŸÑŸÑÿ≠ÿ±ŸÖ', true);
                });
            },
            
            playRadioMadinah: () => {
                SoundManager.playClick();
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ±ÿßÿØŸäŸà ÿßŸÑÿ≠ÿ±ŸÖ ÿßŸÑŸÖÿØŸÜŸä...");
                
                const audio = document.getElementById('quran-audio');
                audio.src = 'https://qurango.net/radio/sakeenah';
                audio.play().catch(e => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà:', e);
                    NotificationManager.show('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿπÿ®ÿ± ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ≥ŸÖŸä ŸÑŸÑÿ≠ÿ±ŸÖ', true);
                });
            },
            
            stopAllStreams: () => {
    // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™ (ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ)
    const iframes = document.querySelectorAll('.stream-container iframe');
    iframes.forEach(iframe => {
        iframe.src = '';
    });
    
    document.querySelectorAll('.stream-container').forEach(container => {
        container.style.display = 'none';
    });
    
    document.getElementById('makkah-alternative').style.display = 'block';
    document.getElementById('madinah-alternative').style.display = 'block';
    
    // === Ÿáÿ∞ÿß ŸáŸà ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑŸÖŸáŸÖ ŸÑŸÑÿ±ÿßÿØŸäŸà ===
    const audio = document.getElementById('quran-audio');
    if(audio) {
        audio.pause();
        audio.currentTime = 0; // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿµŸàÿ™ ŸÑŸÑÿ®ÿØÿßŸäÿ©
    }
    
    NotificationManager.show("ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ÿ´Ÿàÿ´");
}

		 }; 
		
		
        // ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™ ====================
        const QuizManager = {
            newQuiz: () => {
                SoundManager.playClick();
                AppState.quizScore = 0;
                AppState.currentQuestion = 0;
                
                const allQuizQuestions = [
                    {
                        question: "ŸÖÿß ŸáŸä ÿßŸÑÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖŸâ ŸÇŸÑÿ® ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü",
                        options: ["ÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ®ŸÇÿ±ÿ©", "ÿ≥Ÿàÿ±ÿ© Ÿäÿßÿ≥ŸäŸÜ", "ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©", "ÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ•ÿÆŸÑÿßÿµ"],
                        correct: 1
                    },
                    {
                        question: "ŸÉŸÖ ÿπÿØÿØ ÿ£ÿ±ŸÉÿßŸÜ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖÿü",
                        options: ["4", "5", "6", "7"],
                        correct: 1
                    },
                    {
                        question: "ŸÖÿß ŸáŸä ÿ£ŸàŸÑ ÿ¢Ÿäÿ© ŸÜÿ≤ŸÑÿ™ ŸÖŸÜ ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü",
                        options: ["ÿ•ŸÇÿ±ÿ£ ÿ®ÿßÿ≥ŸÖ ÿ±ÿ®ŸÉ ÿßŸÑÿ∞Ÿä ÿÆŸÑŸÇ", "ÿ®ÿ≥ŸÖ ÿßŸÑŸÑŸá ÿßŸÑÿ±ÿ≠ŸÖŸÜ ÿßŸÑÿ±ÿ≠ŸäŸÖ", "ÿßŸÑÿ≠ŸÖÿØ ŸÑŸÑŸá ÿ±ÿ® ÿßŸÑÿπÿßŸÑŸÖŸäŸÜ", "ŸÇŸÑ ŸáŸà ÿßŸÑŸÑŸá ÿ£ÿ≠ÿØ"],
                        correct: 0
                    },
                    {
                        question: "ŸÉŸÖ ÿπÿØÿØ ÿ≥ÿ¨ÿØÿßÿ™ ÿßŸÑÿ™ŸÑÿßŸàÿ© ŸÅŸä ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü",
                        options: ["14", "15", "16", "17"],
                        correct: 1
                    },
                    {
                        question: "ŸÖÿß ŸáŸä ÿ£ÿ∑ŸàŸÑ ÿ≥Ÿàÿ±ÿ© ŸÅŸä ÿßŸÑŸÇÿ±ÿ¢ŸÜÿü",
                        options: ["ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÜÿ≥ÿßÿ°", "ÿ≥Ÿàÿ±ÿ© ÿßŸÑÿ®ŸÇÿ±ÿ©", "ÿ≥Ÿàÿ±ÿ© ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ", "ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÖÿßÿ¶ÿØÿ©"],
                        correct: 1
                    }
                ];
                
                AppState.quizQuestions = [...allQuizQuestions]
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 5);
                
                document.getElementById('quiz-score').textContent = 'ÿßŸÑŸÜŸÇÿßÿ∑: 0';
                QuizManager.showNextQuestion();
                NotificationManager.show('ÿ™ŸÖ ÿ®ÿØÿ° ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿ¨ÿØŸäÿØÿ©!');
            },
            
            showNextQuestion: () => {
                if(AppState.currentQuestion >= AppState.quizQuestions.length) {
                    document.getElementById('quiz-question').textContent = 'ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©!';
                    document.getElementById('quiz-options').innerHTML = 
                        `<div style="text-align:center; padding:20px">
                            <div style="font-size:1.5rem; color:var(--accent); margin-bottom:10px">üèÜ</div>
                            <div>ŸÑŸÇÿØ ÿ£ŸÜŸáŸäÿ™ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©!</div>
                            <div style="font-weight:bold; margin-top:10px">ŸÜŸÇÿßÿ∑ŸÉ: ${AppState.quizScore}/${AppState.quizQuestions.length}</div>
                            <button onclick="QuizManager.newQuiz()" class="btn-outline" style="margin-top:15px">
                                <i class="fas fa-sync"></i> ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿ¨ÿØŸäÿØÿ©
                            </button>
                        </div>`;
                    return;
                }
                
                const question = AppState.quizQuestions[AppState.currentQuestion];
                document.getElementById('quiz-question').textContent = question.question;
                
                const optionsDiv = document.getElementById('quiz-options');
                optionsDiv.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option';
                    optionDiv.textContent = option;
                    optionDiv.onclick = () => QuizManager.checkAnswer(index);
                    
                    optionsDiv.appendChild(optionDiv);
                });
            },
            
            checkAnswer: (selectedIndex) => {
                if(AppState.quizQuestions.length === 0) return;
                
                const question = AppState.quizQuestions[AppState.currentQuestion];
                const options = document.querySelectorAll('.quiz-option');
                
                options.forEach(opt => {
                    opt.classList.remove('correct', 'wrong');
                });
                
                options[question.correct].classList.add('correct');
                if(selectedIndex !== question.correct) {
                    options[selectedIndex].classList.add('wrong');
                }
                
                if(selectedIndex === question.correct) {
                    AppState.quizScore++;
                    NotificationManager.show("ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©! üëç");
                } else {
                    NotificationManager.show("ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©", true);
                }
                
                document.getElementById('quiz-score').textContent = `ÿßŸÑŸÜŸÇÿßÿ∑: ${AppState.quizScore}`;
                
                setTimeout(() => {
                    AppState.currentQuestion++;
                    QuizManager.showNextQuestion();
                }, 1500);
            },

            nextQuestion: () => {
                SoundManager.playClick();
                if(AppState.currentQuestion < AppState.quizQuestions.length) {
                    AppState.currentQuestion++;
                    QuizManager.showNextQuestion();
                }
            }
        };
        
        // ==================== ÿ•ÿØÿßÿ±ÿ© ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑÿµŸÑÿßÿ© ====================
        const PrayerTrackerManager = {
            init: () => {
                const todayKey = new Date().toDateString();
                const saved = localStorage.getItem('prayerTracker');
                
                if (saved) {
                    const data = JSON.parse(saved);
                    AppState.prayerTracker.history = data.history || [];
                    
                    const todayData = data.history?.find(d => d.date === todayKey);
                    AppState.prayerTracker.today = todayData || PrayerTrackerManager.createNewDay();
                } else {
                    AppState.prayerTracker.today = PrayerTrackerManager.createNewDay();
                }
                
                PrayerTrackerManager.render();
            },
            
            createNewDay: () => {
                return {
                    date: new Date().toDateString(),
                    prayers: {
                        Fajr: { prayed: false, time: '', onTime: false },
                        Dhuhr: { prayed: false, time: '', onTime: false },
                        Asr: { prayed: false, time: '', onTime: false },
                        Maghrib: { prayed: false, time: '', onTime: false },
                        Isha: { prayed: false, time: '', onTime: false }
                    },
                    score: 0
                };
            },
            
            render: () => {
                const list = document.getElementById('prayer-tracker-list');
                list.innerHTML = '';
                
                let prayedCount = 0;
                const totalPrayers = 5;
                
                Constants.prayerKeys.forEach(prayer => {
                    if (prayer === 'Sunrise') return;
                    
                    const prayerData = AppState.prayerTracker.today.prayers[prayer] || { prayed: false };
                    const isPrayed = prayerData.prayed;
                    
                    if (isPrayed) prayedCount++;
                    
                    const div = document.createElement('div');
                    div.className = 'prayer-row';
                    div.style.marginBottom = '8px';
                    div.innerHTML = `
                        <div style="display:flex; align-items:center; gap:10px">
                            <i class="fas ${Constants.prayerIcons[prayer]} ${isPrayed ? 'text-success' : ''}"></i>
                            ${Constants.prayerNames[prayer]}
                            <span style="font-size:0.8rem; opacity:0.7">${AppState.times?.[prayer] || '--:--'}</span>
                        </div>
                        <div>
                            <button onclick="PrayerTrackerManager.togglePrayer('${prayer}')" class="btn-outline" style="padding:5px 15px">
                                ${isPrayed ? '<i class="fas fa-check"></i> ÿ™ŸÖÿ™' : '<i class="fas fa-times"></i> ŸÑŸÖ ÿ™ÿ™ŸÖ'}
                            </button>
                        </div>
                    `;
                    
                    if (isPrayed) {
                        div.style.background = 'rgba(76, 175, 80, 0.1)';
                        div.style.borderRight = '4px solid #4CAF50';
                    }
                    
                    list.appendChild(div);
                });
                
                const score = Math.round((prayedCount / totalPrayers) * 100);
                AppState.prayerTracker.today.score = score;
                document.getElementById('today-score').textContent = `${score}%`;
                document.getElementById('today-date').textContent = new Date().toLocaleDateString('ar-EG');
                
                PrayerTrackerManager.updateChart();
                PrayerTrackerManager.save();
            },
            
            togglePrayer: (prayer) => {
                SoundManager.playClick();
                
                if (!AppState.prayerTracker.today.prayers[prayer]) {
                    AppState.prayerTracker.today.prayers[prayer] = { prayed: false, time: '', onTime: false };
                }
                
                const wasPrayed = AppState.prayerTracker.today.prayers[prayer].prayed;
                AppState.prayerTracker.today.prayers[prayer].prayed = !wasPrayed;
                
                if (!wasPrayed) {
                    AppState.prayerTracker.today.prayers[prayer].time = new Date().toLocaleTimeString('ar-EG');
                    AchievementManager.increment('prayers');
                } else {
                    AchievementManager.increment('prayers', -1);
                }
                
                PrayerTrackerManager.render();
                NotificationManager.show(AppState.prayerTracker.today.prayers[prayer].prayed ? 
                    `ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸÑÿßÿ© ${Constants.prayerNames[prayer]} ‚úÖ` : 
                    `ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸÑÿßÿ© ${Constants.prayerNames[prayer]}`);
            },
            
            resetTodayPrayers: () => {
                SoundManager.playClick();
                if (confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿµŸÑŸàÿßÿ™ ÿßŸÑŸäŸàŸÖÿü")) {
                    AppState.prayerTracker.today = PrayerTrackerManager.createNewDay();
                    PrayerTrackerManager.render();
                    NotificationManager.show("ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿµŸÑŸàÿßÿ™ ÿßŸÑŸäŸàŸÖ");
                }
            },
            
            save: () => {
                const todayKey = new Date().toDateString();
                
                const dayIndex = AppState.prayerTracker.history.findIndex(d => d.date === todayKey);
                
                if (dayIndex >= 0) {
                    AppState.prayerTracker.history[dayIndex] = AppState.prayerTracker.today;
                } else {
                    AppState.prayerTracker.history.push(AppState.prayerTracker.today);
                    
                    if (AppState.prayerTracker.history.length > 30) {
                        AppState.prayerTracker.history.shift();
                    }
                }
                
                localStorage.setItem('prayerTracker', JSON.stringify(AppState.prayerTracker));
            },
            
            updateChart: () => {
                const ctx = document.getElementById('prayer-chart');
                if (!ctx) return;
                
                ctx.innerHTML = `
                    <div style="display:flex; flex-direction:column; gap:5px; padding:10px">
                        ${AppState.prayerTracker.history.slice(-7).map(day => {
                            const date = new Date(day.date).toLocaleDateString('ar-EG', {weekday: 'short'});
                            return `
                                <div style="display:flex; align-items:center; gap:10px">
                                    <div style="width:60px">${date}</div>
                                    <div style="flex:1; background:rgba(255,255,255,0.1); height:20px; border-radius:10px">
                                        <div style="background:var(--accent); height:100%; width:${day.score}%; border-radius:10px"></div>
                                    </div>
                                    <div style="width:40px; text-align:right">${day.score}%</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        };
// ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ ŸàÿßŸÑÿ±ŸÇŸäÿ© (ŸÖÿµÿ≠ÿ≠ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ) ====================
const QuranManager = {
    audio: null,
    isPlaying: false,
    allReciters: [],
    roqyahList: [],
    currentMode: 'quran', // 'quran' or 'roqyah'
    selectedSurahId: null,
    selectedSurahName: null,

    init: () => {
        QuranManager.audio = document.getElementById('quran-audio');
        if (!QuranManager.audio) return;
        
        // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿµŸàÿ™
        QuranManager.audio.addEventListener('error', (e) => {
            console.error("Audio Error", e);
            NotificationManager.show("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿµŸàÿ™Ÿä", true);
        });

        // ÿπŸÜÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿµŸàÿ™
        QuranManager.audio.onended = () => {
            QuranManager.isPlaying = false;
            QuranManager.updatePlayButton();
        };

        QuranManager.injectTabs();
        QuranManager.fetchReciters();
        QuranManager.fetchRoqyah();
    },

    injectTabs: () => {
        if (document.getElementById('tab-quran')) return;
        const container = document.querySelector('.quran-container');
        const searchInput = document.getElementById('search-quran');
        
        const tabsDiv = document.createElement('div');
        tabsDiv.style.cssText = "display:flex; gap:10px; margin-bottom:15px;";
        tabsDiv.innerHTML = `
            <button onclick="QuranManager.switchMode('quran')" id="tab-quran" class="btn-outline" style="flex:1; background:var(--accent); color:var(--bg-color)">üìñ ÿßŸÑŸÖÿµÿ≠ŸÅ</button>
            <button onclick="QuranManager.switchMode('roqyah')" id="tab-roqyah" class="btn-outline" style="flex:1;">üåø ÿßŸÑÿ±ŸÇŸäÿ©</button>
        `;
        container.insertBefore(tabsDiv, searchInput.parentNode);
    },

    switchMode: (mode) => {
        SoundManager.playClick();
        QuranManager.currentMode = mode;
        const tabQuran = document.getElementById('tab-quran');
        const tabRoqyah = document.getElementById('tab-roqyah');
        const qariSelectDiv = document.getElementById('qari-select').parentNode; // ÿßŸÑŸÄ Div ÿßŸÑÿ∞Ÿä Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ Select
        const searchInput = document.getElementById('search-quran');

        // === ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ™ŸÖÿßŸÖÿßŸã ÿπŸÜÿØ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ===
        document.getElementById('ayah-player').style.display = 'none'; // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖÿ¥ÿ∫ŸÑ
        document.getElementById('quran-reader-view').style.display = 'none'; // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ±ÿ¶
        document.getElementById('surah-options-modal').classList.remove('active'); // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖŸàÿØÿßŸÑ
        document.getElementById('surah-options-modal').style.display = 'none';
        
        QuranManager.stop(); // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ÿµŸàÿ™ ŸäÿπŸÖŸÑ

        if (mode === 'quran') {
            // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑŸÇÿ±ÿ¢ŸÜ
            tabQuran.style.background = 'var(--accent)';
            tabQuran.style.color = 'var(--bg-color)';
            tabRoqyah.style.background = 'transparent';
            tabRoqyah.style.color = 'var(--text-color)';
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇÿßÿ±ÿ¶
            if(document.getElementById('qari-select')) {
                document.getElementById('qari-select').style.display = 'block';
                // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÅŸàŸÇŸá ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
                if(document.getElementById('qari-select').previousElementSibling) {
                    document.getElementById('qari-select').previousElementSibling.style.display = 'block';
                }
            }
            
            if(searchInput) {
                searchInput.value = '';
                searchInput.placeholder = "ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ≥Ÿàÿ±...";
            }
            QuranManager.renderSurahs(Constants.surahList);
        } else {
            // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ±ŸÇŸäÿ©
            tabRoqyah.style.background = 'var(--accent)';
            tabRoqyah.style.color = 'var(--bg-color)';
            tabQuran.style.background = 'transparent';
            tabQuran.style.color = 'var(--text-color)';
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇÿßÿ±ÿ¶
            if(document.getElementById('qari-select')) {
                document.getElementById('qari-select').style.display = 'none';
                // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÅŸàŸÇŸá
                if(document.getElementById('qari-select').previousElementSibling) {
                    document.getElementById('qari-select').previousElementSibling.style.display = 'none';
                }
            }

            if(searchInput) {
                searchInput.value = '';
                searchInput.placeholder = "ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ±ŸÇŸäÿ©...";
            }
            QuranManager.renderRoqyahList(QuranManager.roqyahList);
        }
    },

    fetchReciters: async () => {
        const qariSelect = document.getElementById('qari-select');
        if(!qariSelect) return;
        qariSelect.innerHTML = '<option>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿ±ÿßÿ°...</option>';
        try {
            const response = await fetch('https://www.mp3quran.net/api/v3/reciters?language=ar&rewaya=1'); 
            const data = await response.json();
            if (data.reciters && data.reciters.length > 0) {
                QuranManager.allReciters = data.reciters.sort((a, b) => a.name.localeCompare(b.name));
                QuranManager.populateRecitersSelect();
            }
        } catch (e) {
            console.error(e);
            qariSelect.innerHTML = '<option>ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿ±ÿßÿ°</option>';
        }
    },

     fetchRoqyah: async () => {
        const customRoqyah = [
            { 
                id: 'r1', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© 1 - ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ¨Ÿàÿ±ÿßŸÜŸä ÿ£ÿ®Ÿà ÿßŸÑÿπÿßŸÑŸäÿ©", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r09.mp3" 
            },
            { 
                id: 'r2', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© 2 - ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ¨Ÿàÿ±ÿßŸÜŸä ÿ£ÿ®Ÿà ÿßŸÑÿπÿßŸÑŸäÿ©", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r08.mp3" 
            },
            { 
                id: 'r3', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ŸÖÿ¥ÿßÿ±Ÿä ÿßŸÑÿπŸÅÿßÿ≥Ÿä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r07.mp3" 
            },
            { 
                id: 'r4', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ÿ≥ÿπÿØ ÿßŸÑÿ∫ÿßŸÖÿØŸä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r06.mp3" 
            },
            { 
                id: 'r5', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© ÿßŸÑŸÖÿ∑ŸàŸÑÿ© - ŸÜÿßÿµÿ± ÿßŸÑŸÇÿ∑ÿßŸÖŸä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r10.mp3" 
            },
            { 
                id: 'r6', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿπÿ¨ŸÖŸä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r05.mp3" 
            },
            { 
                id: 'r7', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - Ÿäÿßÿ≥ÿ± ÿßŸÑÿØŸàÿ≥ÿ±Ÿä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r01.mp3" 
            },
            { 
                id: 'r8', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© (ÿßŸÑŸÖÿ∑ŸàŸÑÿ©) - ÿ•ÿØÿ±Ÿäÿ≥ ÿ£ÿ®ŸÉÿ±", 
                url: "https://download.tvquran.com/download/selections/9/590e6069d646b.mp3" 
            },
            { 
                id: 'r9', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ®ŸÑŸäŸáÿØ", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r02.mp3" 
            },
            { 
                id: 'r10', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© (ÿßŸÑŸÖÿ∑ŸàŸÑÿ©) - ŸÖÿßŸáÿ± ÿßŸÑŸÖÿπŸäŸÇŸÑŸä", 
                url: "https://download.tvquran.com/download/selections/68/590e615aa1d3f.mp3" 
            },
            { 
                id: 'r11', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ŸÜÿ®ŸäŸÑ ÿßŸÑÿπŸàÿ∂Ÿä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r04.mp3" 
            },
            { 
                id: 'r12', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ŸÅÿßÿ±ÿ≥ ÿπÿ®ÿßÿØ", 
                url: "https://download.tvquran.com/download/selections/64/590e62138dcdf.mp3" 
            },
            { 
                id: 'r13', 
                name: "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ© - ÿÆÿßŸÑÿØ ÿßŸÑŸÇÿ≠ÿ∑ÿßŸÜŸä", 
                url: "https://download.tvquran.com/download/TvQuran.com__Rouqia/TvQuran.com__r03.mp3" 
            }
        ];

        QuranManager.roqyahList = customRoqyah;
    },

        populateRecitersSelect: () => {
        const qariSelect = document.getElementById('qari-select');
        if(!qariSelect) return;
        
        // ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        qariSelect.innerHTML = '';
        
        // 1. ÿ•ÿ∂ÿßŸÅÿ© ÿÆŸäÿßÿ± "ÿßÿÆÿ™ÿ± ÿßŸÑŸÇÿßÿ±ÿ¶" ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
        const defaultOption = document.createElement('option');
        defaultOption.value = "";
        defaultOption.text = "--- ÿßÿÆÿ™ÿ± ÿßŸÑŸÇÿßÿ±ÿ¶ ---";
        defaultOption.disabled = true; // ŸÑÿß ŸäŸÖŸÉŸÜ ÿßÿÆÿ™Ÿäÿßÿ±Ÿá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
        defaultOption.selected = true; // ŸÖÿ≠ÿØÿØ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
        qariSelect.appendChild(defaultOption);

        // 2. ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿßŸÇŸä ÿßŸÑŸÇÿ±ÿßÿ°
        QuranManager.allReciters.forEach(reciter => {
            if(reciter.moshaf && reciter.moshaf.length > 0) {
                const option = document.createElement('option');
                option.value = reciter.id;
                option.text = reciter.name;
                option.dataset.server = reciter.moshaf[0].server;
                option.dataset.surahList = reciter.moshaf[0].surah_list;
                qariSelect.appendChild(option);
            }
        });

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÇÿßÿ±ÿ¶ ŸÖÿ≠ŸÅŸàÿ∏ ÿ≥ÿßÿ®ŸÇÿßŸã (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        // ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ±ŸäÿØ ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± "ÿßÿÆÿ™ÿ± ÿßŸÑŸÇÿßÿ±ÿ¶" ÿØÿßÿ¶ŸÖÿßŸã ÿ≠ÿ™Ÿâ ŸÑŸà ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÖÿ≠ŸÅŸàÿ∏ÿå ÿßÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ∑Ÿàÿ± ÿßŸÑÿ´ŸÑÿßÿ´ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©
        const savedQari = localStorage.getItem('lastQariId');
        if (savedQari) {
             qariSelect.value = savedQari;
        }

        QuranManager.updateQariInfo();
        // ÿ•ÿπÿßÿØÿ© ÿ±ÿ≥ŸÖ ÿßŸÑÿ≥Ÿàÿ± ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (ÿ£Ÿà ÿ•ÿÆŸÅÿßÿ¶Ÿáÿß ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±)
        QuranManager.renderSurahs(Constants.surahList);
    },


        updateQariInfo: () => {
        const select = document.getElementById('qari-select');
        const qariInfo = document.getElementById('qari-info');
        
        if (!select || !qariInfo) return;

        // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ© (ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±)ÿå ŸÜÿÆŸÅŸä ŸÜÿµ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
        if (select.value === "") {
            qariInfo.innerText = ""; 
            return;
        }

        const name = select.options[select.selectedIndex].text;
        qariInfo.innerText = `ÿßŸÑŸÇÿßÿ±ÿ¶: ${name}`;
    },


        renderSurahs: (list) => {
        const container = document.getElementById('surah-list');
        container.innerHTML = ''; 
        const select = document.getElementById('qari-select');
        
        // === ÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ¨ÿØŸäÿØ: ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇÿßÿ±ÿ¶ ===
        // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÇŸäŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ© (ÿ£Ÿä ÿ£ŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÖ ŸäÿÆÿ™ÿ± ÿ®ÿπÿØ)ÿå ŸÜÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸàŸÜŸàŸÇŸÅ ÿßŸÑÿØÿßŸÑÿ©
        if (!select || select.value === "") {
            container.innerHTML = `
                <div style="text-align:center; padding:30px; opacity:0.7; grid-column: 1/-1;">
                    <i class="fas fa-hand-pointer" style="font-size:2rem; margin-bottom:10px; display:block"></i>
                    ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇÿßÿ±ÿ¶ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£ÿπŸÑÿßŸá ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≥Ÿàÿ± ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
                </div>
            `;
            return;
        }

        let availableSurahs = [];
        // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ dataset ŸÇÿ®ŸÑ ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
        if (select.selectedIndex !== -1 && select.options[select.selectedIndex].dataset.surahList) {
            availableSurahs = select.options[select.selectedIndex].dataset.surahList.split(',');
        }

        list.forEach(surah => {
            const isAvailable = availableSurahs.includes(String(surah.id));
            if (isAvailable || availableSurahs.length === 0) {
                const div = document.createElement('div');
                div.className = 'surah-card';
                div.innerHTML = `
                    <div class="surah-number">${surah.id}</div>
                    <div class="surah-name">ÿ≥Ÿàÿ±ÿ© ${surah.name}</div>
                `;
                div.onclick = () => QuranManager.showOptions(surah.id, `ÿ≥Ÿàÿ±ÿ© ${surah.name}`);
                container.appendChild(div);
            }
        });
    },


    renderRoqyahList: (list) => {
        const container = document.getElementById('surah-list');
        container.innerHTML = ''; 
        list.forEach(item => {
            const div = document.createElement('div');
            div.className = 'surah-card';
            div.style.borderColor = '#4CAF50';
            div.innerHTML = `
                <div class="surah-number" style="background:#4CAF50"><i class="fas fa-heart-pulse"></i></div>
                <div class="surah-name" style="font-size:0.9rem">${item.name}</div>
            `;
            // ŸáÿßŸÖ: ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ Ÿäÿ¥ÿ∫ŸÑ ÿßŸÑÿµŸàÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸàŸÑÿß ŸäŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàÿØÿßŸÑ
            div.onclick = () => {
                QuranManager.playItem(item.url, item.name, 'roqyah');
            };
            container.appendChild(div);
        });
    },

    // --- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ (Modal) ---

    showOptions: (id, name) => {
        SoundManager.playClick();
        QuranManager.selectedSurahId = id;
        QuranManager.selectedSurahName = name;
        
        document.getElementById('selected-surah-title').textContent = name;
        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ classlist ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ™ŸÅÿßÿπŸÑ ŸÖÿπ CSS ÿßŸÑÿ¨ÿØŸäÿØ
        const modal = document.getElementById('surah-options-modal');
        modal.classList.add('active');
        modal.style.display = 'flex'; // ÿ™ÿ£ŸÉŸäÿØ ÿ•ÿ∂ÿßŸÅŸä
    },

    confirmAction: (action) => {
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ
        const modal = document.getElementById('surah-options-modal');
        modal.classList.remove('active');
        modal.style.display = 'none';

        const id = QuranManager.selectedSurahId;
        const name = QuranManager.selectedSurahName;

        if (action === 'listen') {
            // ÿßÿ≥ÿ™ŸÖÿßÿπ ŸÅŸÇÿ∑ (ŸäŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ÿßŸÑÿπÿßÿØŸä)
            QuranManager.playItem(id, name, 'surah');
        
        } else if (action === 'read') {
            // ŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑ (ŸäŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ±ÿ¶ ŸàŸäÿÆŸÅŸä ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±)
            QuranManager.openReader(id, name, false);
            
        } else if (action === 'tafseer') {
            // ŸÇÿ±ÿßÿ°ÿ© Ÿàÿ™ŸÅÿ≥Ÿäÿ± (ŸäŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ±ÿ¶ ŸàŸäÿ∏Ÿáÿ± ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±)
            QuranManager.openReader(id, name, true);
            
        } else if (action === 'sync') {
            // ŸÇÿ±ÿßÿ°ÿ© Ÿàÿßÿ≥ÿ™ŸÖÿßÿπ (ŸäŸÅÿ™ÿ≠ ÿßŸÑÿßÿ´ŸÜŸäŸÜ)
            QuranManager.playItem(id, name, 'surah'); 
            QuranManager.openReader(id, name, false, true); 
        }
    },

    // --- ÿßŸÑŸÇÿßÿ±ÿ¶ ÿßŸÑŸÖÿ∑Ÿàÿ± ---

    openReader: async (id, name, showTafseer = true, isSyncMode = false) => {
        LoaderManager.show();
        const readerView = document.getElementById('quran-reader-view');
        const contentDiv = document.getElementById('reader-content');
        const miniPlayer = document.getElementById('mini-audio-player');
        
        document.getElementById('reader-surah-name').textContent = name;
        
        // ÿ•ÿπÿØÿßÿØ ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±
        if (showTafseer) {
            contentDiv.classList.remove('hide-tafseer');
        } else {
            contentDiv.classList.add('hide-tafseer');
        }

        // ÿ•ÿπÿØÿßÿØ Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©
        if (isSyncMode) {
            miniPlayer.style.display = 'flex';
            document.getElementById('reader-content').style.paddingBottom = '80px'; 
        } else {
            miniPlayer.style.display = 'none';
            document.getElementById('reader-content').style.paddingBottom = '20px';
            // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ Ÿàÿ∂ÿπ ŸÖÿ≤ÿßŸÖŸÜÿ©ÿå ŸÜŸàŸÇŸÅ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÇÿØŸäŸÖ ŸÑÿπÿØŸÖ ÿßŸÑÿ™ÿØÿßÿÆŸÑ
            if(QuranManager.currentMode === 'quran') QuranManager.stop();
        }

        contentDiv.innerHTML = '<div style="text-align:center; margin-top:50px; color:var(--accent)">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ¢Ÿäÿßÿ™...</div>';
        readerView.style.display = 'flex';

        try {
            const url = `https://api.alquran.cloud/v1/surah/${id}/editions/quran-uthmani,ar.muyassar`;
            const response = await fetch(url);
            const data = await response.json();

            if (data.code === 200) {
                const uthmaniData = data.data[0].ayahs;
                const tafseerData = data.data[1].ayahs;
                
                let html = '';
                
                if (id !== 9) {
                    html += `<div style="text-align:center; font-family:'Amiri'; font-size:1.8rem; margin-bottom:30px; color:var(--accent)">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸéŸáŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê</div>`;
                }

                uthmaniData.forEach((ayah, index) => {
                    let text = ayah.text;
                    if (id !== 1 && id !== 9 && index === 0) {
                        text = text.replace("ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸëŸéŸáŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê", "").trim();
                    }
                    const tafseer = tafseerData[index].text;

                    html += `
                        <div class="ayah-container">
                            <div class="ayah-text">
                                ${text} <span class="ayah-number-badge">${ayah.numberInSurah}</span>
                            </div>
                            <div class="tafseer-text">
                                <i class="fas fa-book-reader" style="color:var(--accent); margin-left:5px"></i> 
                                ${tafseer}
                            </div>
                        </div>
                    `;
                });

                contentDiv.innerHTML = html;
            } else {
                contentDiv.innerHTML = '<div style="text-align:center; padding:20px;">ÿπÿ∞ÿ±ÿßŸãÿå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.</div>';
            }
        } catch (e) {
            console.error(e);
            contentDiv.innerHTML = '<div style="text-align:center; padding:20px;">ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™.</div>';
        } finally {
            LoaderManager.hide();
        }
    },

    closeReader: () => {
        SoundManager.playClick();
        document.getElementById('quran-reader-view').style.display = 'none';
        document.getElementById('mini-audio-player').style.display = 'none';
    },

    // --- ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ŸàÿßŸÑÿµŸàÿ™ ---

    playItem: (identifier, title, type) => {
        const player = document.getElementById('ayah-player');
        
        // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ¥ÿ∫ŸÑ
        document.getElementById('current-surah').innerText = title;
        document.getElementById('current-ayah').innerText = (type === 'surah') ? "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸéŸáŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê" : "ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ©";
        
        if (player) {
            player.style.display = 'block';
            
            // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ±ŸÇŸäÿ©ÿå ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ±ÿ¶ (ŸÑŸÖŸÜÿπ ÿßŸÑÿ™ÿØÿßÿÆŸÑ)
            if(type === 'roqyah') {
                document.getElementById('quran-reader-view').style.display = 'none';
                document.getElementById('qari-info').innerText = "ŸÇÿ≥ŸÖ ÿßŸÑÿ±ŸÇŸäÿ© ÿßŸÑÿ¥ÿ±ÿπŸäÿ©";
            }
            
            // ÿßŸÑÿ≥ŸÉÿ±ŸàŸÑ ŸÑŸÑŸÖÿ¥ÿ∫ŸÑ
            player.scrollIntoView({ behavior: 'smooth' });
        }

        let audioUrl = "";
        if (type === 'surah') {
            const select = document.getElementById('qari-select');
            if(select) {
                const server = select.options[select.selectedIndex].dataset.server;
                const surahIdPadded = String(identifier).padStart(3, '0');
                audioUrl = `${server}${surahIdPadded}.mp3`;
                localStorage.setItem('lastQariId', select.value);
            }
        } else {
            // ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ±ŸÇŸäÿ©ÿå identifier ŸáŸà ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
            audioUrl = identifier;
        }
        
        QuranManager.playAudio(audioUrl);
    },

    playAudio: async (url) => {
        if (!QuranManager.audio) return;
        
        QuranManager.audio.pause();
        QuranManager.audio.src = url;
        QuranManager.audio.load();
        
        try {
            await QuranManager.audio.play();
            QuranManager.isPlaying = true;
            QuranManager.updatePlayButton();
        } catch (error) {
            if (error.name !== 'AbortError') {
                console.error("Play error:", error);
                NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...", true);
            }
        }
    },

    play: () => {
        if (QuranManager.audio && QuranManager.audio.src) {
            QuranManager.audio.play().catch(e => console.log(e));
            QuranManager.isPlaying = true;
            QuranManager.updatePlayButton();
        }
    },

    pause: () => {
        if (QuranManager.audio) {
            QuranManager.audio.pause();
            QuranManager.isPlaying = false;
            QuranManager.updatePlayButton();
        }
    },

    stop: () => {
        if (QuranManager.audio) {
            QuranManager.audio.pause();
            QuranManager.audio.currentTime = 0;
            QuranManager.isPlaying = false;
            QuranManager.updatePlayButton();
        }
    },

    updatePlayButton: () => {
        const btnContainer = document.querySelector('.player-controls');
        if(btnContainer && btnContainer.children[0]) {
            const playBtn = btnContainer.children[0];
            if(QuranManager.isPlaying) {
                playBtn.innerHTML = '<i class="fas fa-pause"></i> ÿ•ŸäŸÇÿßŸÅ';
                playBtn.onclick = QuranManager.pause;
            } else {
                playBtn.innerHTML = '<i class="fas fa-play"></i> ÿ™ÿ¥ÿ∫ŸäŸÑ';
                playBtn.onclick = QuranManager.play;
            }
        }
        
        const miniContainer = document.getElementById('mini-audio-player');
        if(miniContainer) {
            const miniPlayBtn = miniContainer.querySelectorAll('button')[1];
            if(miniPlayBtn) {
                 if(QuranManager.isPlaying) {
                    miniPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    miniPlayBtn.onclick = QuranManager.pause;
                } else {
                    miniPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    miniPlayBtn.onclick = QuranManager.play;
                }
            }
        }
    },

    search: (term) => {
        if (QuranManager.currentMode === 'quran') {
            const filtered = Constants.surahList.filter(s => s.name.includes(term));
            QuranManager.renderSurahs(filtered);
        } else {
            const filtered = QuranManager.roqyahList.filter(r => r.name.includes(term));
            QuranManager.renderRoqyahList(filtered);
        }
    },

    changeQari: () => {
        QuranManager.updateQariInfo();
        QuranManager.renderSurahs(Constants.surahList);
    },

    download: () => {
        if(QuranManager.audio && QuranManager.audio.src) {
             window.open(QuranManager.audio.src, '_blank');
        } else {
            NotificationManager.show("ŸÇŸÖ ÿ®ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸÇÿ∑ÿπ ÿ£ŸàŸÑÿßŸã ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ", true);
        }
    }
};


// ==================== ÿØÿßŸÑÿ© ÿ™ŸáŸäÿ¶ÿ© ŸÇŸàÿßÿ¶ŸÖ ÿ∑ÿ±ŸÇ ÿßŸÑÿ≠ÿ≥ÿßÿ® ====================
const initMethodSelects = () => {
    // ŸÜŸÜÿ¥ÿ¶ ŸÉŸàÿØ HTML ŸÑŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ≠ÿØÿ© ŸÅŸä Constants
    let optionsHTML = "";
    // ŸÜŸÇŸàŸÖ ÿ®ÿ™ÿ±ÿ™Ÿäÿ® ŸÖÿπŸäŸÜ ÿ•ÿ∞ÿß ÿ£ÿ±ÿØÿ™ÿå ÿ£Ÿà ŸÜÿπÿ™ŸÖÿØ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
    // ŸáŸÜÿß ÿ≥ŸÜÿ∂ÿπ ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ¥ŸäŸàÿπÿßŸã ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ ŸäÿØŸàŸäÿßŸã ÿ•ÿ∞ÿß ÿ£ÿ±ÿØŸÜÿßÿå ÿ£Ÿà ŸÜÿπÿ±ÿ∂ ÿßŸÑÿ¨ŸÖŸäÿπ
    const priority = [5, 4, 3, 2, 1]; // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ∏ŸáŸàÿ±: ŸÖÿµÿ±ÿå ŸÖŸÉÿ©ÿå ÿßŸÑÿ±ÿßÿ®ÿ∑ÿ©...
    
    // ÿ£ŸàŸÑÿßŸã ŸÜÿ∂ŸäŸÅ ÿßŸÑÿ∑ÿ±ŸÇ ÿ∞ÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©
    priority.forEach(id => {
        if(Constants.calculationMethods[id]) {
            optionsHTML += `<option value="${id}">${Constants.calculationMethods[id].name}</option>`;
        }
    });

    // ÿ´ŸÖ ŸÜÿ∂ŸäŸÅ ÿßŸÑÿ®ÿßŸÇŸä
    for (const [id, data] of Object.entries(Constants.calculationMethods)) {
        if (!priority.includes(parseInt(id))) {
            optionsHTML += `<option value="${id}">${data.name}</option>`;
        }
    }

    // ŸÜŸÖŸÑÿ£ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≤ŸäÿØ)
    const settingsSelect = document.getElementById('method-select');
    if (settingsSelect) settingsSelect.innerHTML = optionsHTML;

    // ŸÜŸÖŸÑÿ£ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ© (ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ©)
    const setupSelect = document.getElementById('setup-method');
    if (setupSelect) setupSelect.innerHTML = optionsHTML;
};

        
// ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä) ====================
const SettingsManager = {
    // ÿØÿßŸÑÿ© ŸÑÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿ®ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑŸÅŸàÿ±Ÿä
    initListeners: () => {
        const toggles = [
            { id: 'adhan-toggle', action: () => SoundManager.playClick() },
            { id: 'click-toggle', action: () => AppState.clickSound = document.getElementById('click-toggle').checked },
            { id: 'vibrate-toggle', action: () => AppState.vibration = document.getElementById('vibrate-toggle').checked },
            { id: 'notification-toggle', action: () => AppState.notifications = document.getElementById('notification-toggle').checked },
            { id: 'weather-toggle', action: () => SettingsManager.toggleWeather() },
            // ŸÜÿ™ÿ±ŸÉ ÿ≤ÿ± ÿßŸÑŸÖŸàŸÇÿπ ŸÑÿ£ŸÜŸá ŸäŸÖÿ™ŸÑŸÉ ÿØÿßŸÑÿ© ÿÆÿßÿµÿ© toggleGeolocation
        ];

        toggles.forEach(item => {
            const el = document.getElementById(item.id);
            if(el) {
                el.addEventListener('change', () => {
                    item.action(); // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑÿ≤ÿ±
                    SettingsManager.save(); // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÅŸàÿ±ÿßŸã
                });
            }
        });
    },

    // ÿØÿßŸÑÿ© ÿÆÿßÿµÿ© ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ∑ŸÇÿ≥ ŸÑÿ≠ÿ∏ŸäÿßŸã
    toggleWeather: () => {
        const isEnabled = document.getElementById('weather-toggle').checked;
        AppState.weatherEnabled = isEnabled;
        
        const weatherInfo = document.getElementById('weather-info');
        const weatherCard = document.getElementById('weather-card');

        if(isEnabled) {
            WeatherManager.fetch(); // ÿ¨ŸÑÿ® Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ∑ŸÇÿ≥
        } else {
            // ÿ•ÿÆŸÅÿßÿ° ŸÅŸàÿ±Ÿä ŸÑŸÑÿπŸÜÿßÿµÿ±
            if(weatherInfo) weatherInfo.style.display = 'none';
            if(weatherCard) weatherCard.style.display = 'none';
        }
    },

    save: () => {
        // ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
        localStorage.setItem('adhanToggle', document.getElementById('adhan-toggle').checked);
        localStorage.setItem('clickToggle', document.getElementById('click-toggle').checked);
        localStorage.setItem('vibrateToggle', document.getElementById('vibrate-toggle').checked);
        localStorage.setItem('notificationToggle', document.getElementById('notification-toggle').checked);
        localStorage.setItem('weatherToggle', document.getElementById('weather-toggle').checked);
        localStorage.setItem('geolocationToggle', document.getElementById('geolocation-toggle').checked);
        localStorage.setItem('calculationMethod', AppState.method);
        
        // ÿ•ÿ¥ÿπÿßÿ± ÿÆŸÅŸäŸÅ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        // NotificationManager.show("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™");
    },

    load: () => {
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ´ŸäŸÖ
        const theme = localStorage.getItem('theme') || 'kaaba';
        ThemeManager.change(theme);
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ≠ÿßŸÑÿ© ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑÿπÿßŸÖ
        const savedMute = localStorage.getItem('isMuted');
        if(savedMute !== null) {
            AppState.isMuted = (savedMute === 'true');
            const muteIcon = document.getElementById('mute-icon');
            if(muteIcon) muteIcon.className = AppState.isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
        }

        // ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑÿ±ÿ®ÿ∑Ÿáÿß
        const settingsMap = {
            'adhanToggle': 'adhan-toggle',
            'clickToggle': 'click-toggle',
            'vibrateToggle': 'vibrate-toggle',
            'notificationToggle': 'notification-toggle',
            'weatherToggle': 'weather-toggle',
            'geolocationToggle': 'geolocation-toggle'
        };

        // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÇŸäŸÖ Ÿàÿ™ÿ∑ÿ®ŸäŸÇŸáÿß ÿπŸÑŸâ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        for (const [key, elementId] of Object.entries(settingsMap)) {
            const savedValue = localStorage.getItem(key);
            const element = document.getElementById(elementId);
            if (element && savedValue !== null) {
                element.checked = (savedValue === 'true');
            }
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿß ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑŸá
        AppState.clickSound = document.getElementById('click-toggle')?.checked ?? true;
        AppState.vibration = document.getElementById('vibrate-toggle')?.checked ?? true;
        AppState.notifications = document.getElementById('notification-toggle')?.checked ?? true;
        AppState.geolocationEnabled = document.getElementById('geolocation-toggle')?.checked ?? false;
        
        // --- ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ∑ŸÇÿ≥ ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ---
        const weatherEnabled = document.getElementById('weather-toggle')?.checked ?? true;
        AppState.weatherEnabled = weatherEnabled;
        
        if (!weatherEnabled) {
            // ÿ•ÿ¨ÿ®ÿßÿ± ÿßŸÑÿ•ÿÆŸÅÿßÿ° ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿÆŸäÿßÿ± ŸÖÿ∫ŸÑŸÇÿßŸã
            const info = document.getElementById('weather-info');
            const card = document.getElementById('weather-card');
            if(info) info.style.display = 'none';
            if(card) card.style.display = 'none';
        } else {
            // ÿ¨ŸÑÿ® ÿßŸÑÿ∑ŸÇÿ≥ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÅÿπŸÑÿßŸã
            WeatherManager.fetch();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®
        const savedMethod = localStorage.getItem('calculationMethod');
        if(savedMethod) {
            AppState.method = parseInt(savedMethod);
            const methodSelect = document.getElementById('method-select');
            if (methodSelect) methodSelect.value = savedMethod;
        }
        
        const methodName = Constants.calculationMethods[AppState.method]?.name || 'ÿ£ŸÖ ÿßŸÑŸÇÿ±Ÿâ';
        const methodElement = document.getElementById('method-name');
        if (methodElement) methodElement.innerText = methodName;

        // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ (ŸÑÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä)
        SettingsManager.initListeners();
    },

    resetApp: () => {
        SoundManager.playClick();
        if(confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑ÿü ÿ≥Ÿäÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.")) {
            localStorage.clear();
            location.reload();
        }
    },
    
    changeCalculationMethod: () => {
        SoundManager.playClick();
        const select = document.getElementById('method-select');
        if(select) {
            AppState.method = parseInt(select.value);
            PrayerManager.fetchData();
            SettingsManager.save(); // ÿ≠ŸÅÿ∏ ŸÖÿ®ÿßÿ¥ÿ± ÿπŸÜÿØ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±
            
            const methodName = Constants.calculationMethods[AppState.method]?.name;
            NotificationManager.show(`ÿ™ŸÖ ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ÿ•ŸÑŸâ ${methodName}`);
        }
    }
};


        
        // ==================== ÿØŸàÿßŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ====================
        const toggleMute = () => {
    SoundManager.playClick();
    AppState.isMuted = !AppState.isMuted;
    
    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
    localStorage.setItem('isMuted', AppState.isMuted);
    
    document.getElementById('mute-icon').className = AppState.isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
    NotificationManager.show(AppState.isMuted ? "ÿ™ŸÖ ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™" : "ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™");
};

        
        const changeTheme = (theme) => ThemeManager.change(theme);
        const navTo = (page) => PageManager.navigateTo(page);
        const startCompass = () => CompassManager.start();
        const changeDhikr = (index) => DhikrManager.changeDhikr(index);
        const incrementTasbih = () => DhikrManager.increment();
        const resetTasbih = () => DhikrManager.reset();
        const saveDhikr = () => DhikrManager.save();
        const loadDhikr = () => DhikrManager.load();
        const prevMonth = () => CalendarManager.prevMonth();
        const nextMonth = () => CalendarManager.nextMonth();
        const newQuiz = () => QuizManager.newQuiz();
        const nextQuestion = () => QuizManager.nextQuestion();
        const selectLogo = (logo) => CardManager.selectLogo(logo);
        const updateCard = () => CardManager.update();
        const downloadCard = () => CardManager.download();
        const shareCard = () => CardManager.share();
        const uploadBackground = (e) => CardManager.uploadBackground(e);
        const selectBackground = (index) => CardManager.selectBackground(index);
        const playMakkahStream = () => StreamManager.playMakkahStream();
        const playMadinahStream = () => StreamManager.playMadinahStream();
        const playRadioCairo = () => StreamManager.playRadioCairo();
        const openYouTubeMakkah = () => StreamManager.openYouTubeMakkah();
        const openYouTubeMadinah = () => StreamManager.openYouTubeMadinah();
        const playRadioMakkah = () => StreamManager.playRadioMakkah();
        const playRadioMadinah = () => StreamManager.playRadioMadinah();
        const resetTodayPrayers = () => PrayerTrackerManager.resetTodayPrayers();
        const changeCity = () => toggleLocationSearch(true);
        const changeCalculationMethod = () => SettingsManager.changeCalculationMethod();
        const saveSettings = () => SettingsManager.save();
        const resetApp = () => SettingsManager.resetApp();
        const filterDua = (category) => DuaManager.filterDua(category);
        const searchEvents = () => EventManager.searchEvents(document.getElementById('search-events').value);
        const searchDuas = () => DuaManager.searchDuas(document.getElementById('search-duas').value);
        const addQuranMinute = () => {
            AchievementManager.increment('quranMinutes');
            NotificationManager.show('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÇŸäŸÇÿ© ŸÇÿ±ÿ¢ŸÜ ÿ•ŸÑŸâ ÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ŸÉ');
        };
        // ==================== ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖŸÅŸÇŸàÿØÿ© ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ© ====================

// 1. ÿØŸàÿßŸÑ ÿßŸÑŸÇÿ±ÿ¢ŸÜ (ÿ™ÿ±ÿ®ÿ∑ ÿßŸÑÿ≤ÿ± ŸÅŸä HTML ÿ®ŸÄ QuranManager)
const searchQuran = () => QuranManager.search(document.getElementById('search-quran').value);
const changeQari = () => QuranManager.changeQari();
const playQuran = () => QuranManager.play();
const pauseQuran = () => QuranManager.pause();
const stopQuran = () => QuranManager.stop();
const downloadAyah = () => QuranManager.download();



// 1. ÿ™ÿπÿ±ŸäŸÅ ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿ≠ÿØÿ´ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
let deferredPrompt;

// 2. ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑÿ≠ÿØÿ´ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ (Ÿäÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑŸá ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿßŸÑŸÖÿ™ÿµŸÅÿ≠)
window.addEventListener('beforeinstallprompt', (e) => {
    // ŸÖŸÜÿπ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÖŸÜ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÅŸàÿ±ÿßŸã
    e.preventDefault();
    // ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ≠ÿØÿ´ ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ŸÑÿßÿ≠ŸÇÿßŸã ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ≤ÿ±
    deferredPrompt = e;
    console.log("ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ´ÿ®Ÿäÿ™");
    
    // ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: ŸäŸÖŸÉŸÜŸÉ ŸáŸÜÿß ÿ•ÿ∏Ÿáÿßÿ± ÿ≤ÿ± ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿÆŸÅŸäŸá ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
    // document.getElementById('install-button').style.display = 'block';
});

// 3. ÿØÿßŸÑÿ© ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ≤ÿ± (ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÇÿØŸäŸÖÿ© ÿ®Ÿáÿ∞Ÿá)
const triggerPWAInstall = async () => {
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ŸÖÿ™ÿßÿ≠ÿßŸã (ŸÑŸÑÿ£ŸÜÿØÿ±ŸàŸäÿØ ŸàÿßŸÑŸÉÿ±ŸàŸÖ)
    if (deferredPrompt) {
        // ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ©
        deferredPrompt.prompt();
        
        // ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿ±ÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ŸÇÿ®ŸàŸÑ ÿ£Ÿà ÿ±ŸÅÿ∂)
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to the install prompt: ${outcome}`);
        
        // ÿ™ÿµŸÅŸäÿ± ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ£ŸÜ ÿßŸÑÿ≠ÿØÿ´ Ÿäÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑
        deferredPrompt = null;
    } else {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖÿØÿπŸàŸÖÿßŸã (ŸÖÿ´ŸÑ iPhone ÿ£Ÿà ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ´ÿ®ÿ™ ÿ®ÿßŸÑŸÅÿπŸÑ)
        // ŸÜÿ∏Ÿáÿ± ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸäÿØŸàŸäÿ© ŸÉŸÖÿß ŸáŸä
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        if (isIOS) {
             NotificationManager.show("ÿπŸÑŸâ ÿßŸÑÿ¢ŸäŸÅŸàŸÜ: ÿßÿ∂ÿ∫ÿ∑ ÿ≤ÿ± ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ‚èç ÿ´ŸÖ ÿßÿÆÿ™ÿ± 'ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©' ‚ûï");
        } else {
             NotificationManager.show("ŸÑŸÑÿ™ÿ´ÿ®Ÿäÿ™: ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ (‚ãÆ) ÿ´ŸÖ ÿßÿÆÿ™ÿ± 'ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ' ÿ£Ÿà 'ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©'");
        }
    }
};




const exportAllData = () => {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = "backup_moazen.json";
    a.click();
    NotificationManager.show("ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©");
};

const exportToCSV = () => {
    // ÿ™ÿµÿØŸäÿ± ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑÿ¥Ÿáÿ± ÿßŸÑÿ≠ÿßŸÑŸä
    if (!AppState.times) return;
    let csvContent = "data:text/csv;charset=utf-8,ÿßŸÑŸäŸàŸÖ,ÿßŸÑŸÅÿ¨ÿ±,ÿßŸÑÿ∏Ÿáÿ±,ÿßŸÑÿπÿµÿ±,ÿßŸÑŸÖÿ∫ÿ±ÿ®,ÿßŸÑÿπÿ¥ÿßÿ°\n";
    
    // ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ŸáŸÜÿß ŸÜÿ≠ÿ™ÿßÿ¨ ŸÑŸÑŸàÿµŸàŸÑ ŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ŸÇŸàŸäŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜÿ©ÿå 
    // ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑ ÿ≥ŸÜŸÇŸàŸÖ ÿ®ÿ™ÿµÿØŸäÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™Ÿàÿ∂Ÿäÿ≠Ÿäÿ© ÿ£Ÿà ÿ™ÿ∑ŸàŸäÿ± CalendarManager ŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    NotificationManager.show("ÿ≥Ÿäÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ¨ÿØŸàŸÑ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿØŸÖ");
};

const takeScreenshot = () => {
    NotificationManager.show("ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑÿ¥ÿßÿ¥ÿ©...");
    html2canvas(document.getElementById('page-calendar')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'calendar.png';
        link.href = canvas.toDataURL();
        link.click();
    });
};

const viewStats = () => {
    // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿπÿ±ÿ∂ ÿ®ŸäŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸàÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä
    const chart = document.getElementById('prayer-chart').parentNode;
    if(chart.style.display === 'none') {
        chart.style.display = 'block';
    } else {
         NotificationManager.show("ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ®ÿßŸÑŸÅÿπŸÑ");
    }
};

const toggleGeolocation = () => {
    // 1. ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ© Ÿàÿ≠ŸÅÿ∏Ÿáÿß
    const isChecked = document.getElementById('geolocation-toggle').checked;
    AppState.geolocationEnabled = isChecked;
    localStorage.setItem('geolocationToggle', isChecked);
    
    if(isChecked) {
        // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßŸÑÿ™ŸÅÿπŸäŸÑÿå ŸÜÿ≠ÿØÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ¢ŸÜ
        CityManager.detectLocation();
    } else {
        // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇÿå ŸÅŸÇÿ∑ ŸÜÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ©
        NotificationManager.show("ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑŸÖŸàŸÇÿπ");
    }
};



		
const closeModal = () => {
    const modal = document.getElementById('custom-modal');
    if (modal) {
        modal.remove();
    }
};			
// ==================== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸäÿ© ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±ÿ© ====================
const SetupManager = {
    searchTimeout: null,
    selectedCityData: null, // ŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ≠ŸÅÿ∏

    checkFirstRun: () => {
        const savedLoc = localStorage.getItem('userLocation');
        if (!savedLoc) {
            SetupManager.show();
        } else {
            const modal = document.getElementById('setup-modal');
            if(modal) modal.style.display = 'none';
        }
    },

    show: () => {
        const modal = document.getElementById('setup-modal');
        if(modal) {
            modal.style.display = 'flex';
            setTimeout(() => {
                const input = document.getElementById('city-search');
                if(input) input.focus();
            }, 500);
        }
    },

    searchCity: (query) => {
        const resultsDiv = document.getElementById('search-results');
        query = query.toLowerCase().trim();

        if (query.length < 2) {
            resultsDiv.style.display = 'none';
            return;
        }

        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<div style="padding:10px; text-align:center; color:var(--accent)"><i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´...</div>';

        clearTimeout(SetupManager.searchTimeout);
        SetupManager.searchTimeout = setTimeout(async () => {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&accept-language=ar&limit=5`);
                const data = await response.json();

                resultsDiv.innerHTML = '';
                
                if (data.length === 0) {
                    resultsDiv.innerHTML = '<div style="padding:10px; text-align:center;">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿ™ÿßÿ¶ÿ¨</div>';
                    return;
                }

                data.forEach(place => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.innerHTML = `<span>${place.display_name.split('ÿå')[0]}</span> <span style="font-size:0.8rem; opacity:0.7; display:block">${place.display_name}</span>`;
                    
                    div.onclick = () => {
                        const lat = parseFloat(place.lat);
                        const lng = parseFloat(place.lon);
                        const name = place.display_name.split('ÿå')[0];
                        
                        // ŸÜÿ≠ÿØÿØ ÿ£ŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßÿÆÿ™ÿßÿ± ŸäÿØŸàŸäÿßŸã (isGPS: false)
                        SetupManager.selectedCityData = { name, lat, lng, isGPS: false };
                        
                        document.getElementById('city-search').value = name;
                        resultsDiv.style.display = 'none';
                        document.getElementById('selected-location-display').innerHTML = 
                            `<i class="fas fa-check-circle"></i> ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ: ${name}`;
                    };
                    resultsDiv.appendChild(div);
                });

            } catch (e) {
                console.error("Setup Search Error", e);
                resultsDiv.innerHTML = '<div style="padding:10px; text-align:center; color:red">ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ</div>';
            }
        }, 500);
    },

    useGPS: () => {
        const display = document.getElementById('selected-location-display');
        display.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ...';

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    let name = "ŸÖŸàŸÇÿπŸä ÿßŸÑÿ≠ÿßŸÑŸä";
                    try {
                        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`);
                        const data = await res.json();
                        name = data.address.city || data.address.town || data.address.village || "ŸÖŸàŸÇÿπŸä ÿßŸÑÿ≠ÿßŸÑŸä";
                    } catch(e) {}

                    // ŸÜÿ≠ÿØÿØ ÿ£ŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßÿ≥ÿ™ÿÆÿØŸÖ GPS (isGPS: true)
                    SetupManager.selectedCityData = { name, lat, lng, isGPS: true };
                    
                    document.getElementById('city-search').value = name;
                    display.innerHTML = `<i class="fas fa-satellite-dish"></i> ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠`;
                    NotificationManager.show("ÿ™ŸÖ ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠");
                },
                (err) => {
                    display.innerHTML = '<span style="color:#ff4444">ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπÿå ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿßÿ≥ŸÖ</span>';
                },
                { enableHighAccuracy: true }
            );
        } else {
            alert("ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ GPS");
        }
    },

    finish: () => {
        if (!SetupManager.selectedCityData) {
            NotificationManager.show("ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿ≠ÿØÿØ ŸÖŸàŸÇÿπŸÉ ÿ£ŸàŸÑÿßŸã!", true);
            return;
        }

        // 1. ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸàŸÇÿπ Ÿàÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®
        const method = parseInt(document.getElementById('setup-method').value);
        CityManager.saveLocation(
            SetupManager.selectedCityData.name,
            SetupManager.selectedCityData.lat,
            SetupManager.selectedCityData.lng,
            method
        );
        
        // 2. ÿ±ÿ®ÿ∑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™ (ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑŸÜÿßŸÇÿµÿ© ÿ≥ÿßÿ®ŸÇÿßŸã)
        const isSoundOn = document.getElementById('setup-sound-toggle').checked;
        
        // ÿ•ÿ∞ÿß ŸÅÿπŸÑ ÿßŸÑÿµŸàÿ™ ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ©ÿå ŸÜŸÑÿ∫Ÿä ÿßŸÑŸÉÿ™ŸÖ ŸàŸÜŸÅÿπŸÑ ÿßŸÑÿ£ÿ∞ÿßŸÜ ŸàÿßŸÑŸÜŸÇÿ±ÿßÿ™
        AppState.isMuted = !isSoundOn; 
        localStorage.setItem('isMuted', !isSoundOn);
        localStorage.setItem('adhanToggle', isSoundOn);
        localStorage.setItem('clickToggle', isSoundOn);
        // ŸÜŸÅÿπŸÑ ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ŸàÿßŸÑÿ∑ŸÇÿ≥ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
        localStorage.setItem('notificationToggle', 'true');
        localStorage.setItem('weatherToggle', 'true');

        // 3. ÿ±ÿ®ÿ∑ ÿ•ÿπÿØÿßÿØ GPS (ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑŸÜÿßŸÇÿµÿ© ÿ≥ÿßÿ®ŸÇÿßŸã)
        if(SetupManager.selectedCityData.isGPS) {
            localStorage.setItem('geolocationToggle', 'true');
            AppState.geolocationEnabled = true;
        } else {
            localStorage.setItem('geolocationToggle', 'false');
            AppState.geolocationEnabled = false;
        }

        // 4. ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
        document.getElementById('setup-modal').style.display = 'none';
        
        // 5. ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ´ŸäŸÖ ÿßŸÑŸÖÿÆÿ™ÿßÿ±
        const selectedThemeEl = document.querySelector('#setup-theme-grid .theme-option.active');
        if(selectedThemeEl) {
            ThemeManager.change(selectedThemeEl.dataset.theme);
        }

        // 6. ÿÆÿ∑Ÿàÿ© ŸÖŸáŸÖÿ© ÿ¨ÿØÿßŸã: ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿß ÿ™ŸÖ ÿ≠ŸÅÿ∏Ÿá
        SettingsManager.load();

        // 7. ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
        PrayerManager.fetchData();
        NotificationManager.show("ÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸÜÿ¨ÿßÿ≠! üöÄ");
        SoundManager.playClick();
    }
};




// ==================== ÿ•ÿØÿßÿ±ÿ© ÿÆÿ™ŸÖÿ© ÿßŸÑŸÇÿ±ÿ¢ŸÜ (ŸÖÿµÿ≠ÿ≠) ====================
const KhatmahManager = {
    plan: null,

    init: () => {
        const savedPlan = localStorage.getItem('khatmahPlan');
        if (savedPlan) {
            KhatmahManager.plan = JSON.parse(savedPlan);
            KhatmahManager.showDashboard();
        } else {
            KhatmahManager.showSetup();
        }

        const input = document.getElementById('khatmah-days');
        if (input) {
            input.addEventListener('input', KhatmahManager.calculatePreview);
            KhatmahManager.calculatePreview();
        }
    },

    calculatePreview: () => {
        const days = parseInt(document.getElementById('khatmah-days').value) || 30;
        const totalPages = 604;
        const dailyPages = Math.ceil(totalPages / days);
        const pagesPerPrayer = (dailyPages / 5).toFixed(1);
        
        const previewText = `${dailyPages} ÿµŸÅÿ≠ÿ© ŸäŸàŸÖŸäÿßŸã (ÿ≠ŸàÿßŸÑŸä ${Math.ceil(pagesPerPrayer)} ÿµŸÅÿ≠ÿßÿ™ ÿ®ÿπÿØ ŸÉŸÑ ÿµŸÑÿßÿ©)`;
        document.getElementById('khatmah-preview').innerText = previewText;
    },

    createPlan: () => {
        SoundManager.playClick();
        const days = parseInt(document.getElementById('khatmah-days').value);
        if (!days || days < 1) {
            NotificationManager.show("ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿπÿØÿØ ÿ£ŸäÿßŸÖ ÿµÿ≠Ÿäÿ≠", true);
            return;
        }

        const startDate = new Date();
        const endDate = new Date();
        endDate.setDate(startDate.getDate() + days);

        KhatmahManager.plan = {
            totalDays: days,
            startDate: startDate.toISOString(),
            targetDate: endDate.toISOString(),
            currentPage: 0,
            totalPages: 604,
            dailyTasks: {
                date: new Date().toDateString(),
                startPage: 0, // ŸÜŸÇÿ∑ÿ© ÿßÿ±ÿ™ŸÉÿßÿ≤ ÿ´ÿßÿ®ÿ™ÿ© ŸÑŸÑŸäŸàŸÖ
                prayers: { Fajr: false, Dhuhr: false, Asr: false, Maghrib: false, Isha: false }
            }
        };

        KhatmahManager.save();
        KhatmahManager.showDashboard();
        NotificationManager.show("ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿÆÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠! ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÑŸá ü§≤");
        PageManager.navigateTo('khatmah');
    },

    showSetup: () => {
        document.getElementById('khatmah-setup').style.display = 'block';
        document.getElementById('khatmah-dashboard').style.display = 'none';
        KhatmahManager.calculatePreview();
    },

    showDashboard: () => {
        document.getElementById('khatmah-setup').style.display = 'none';
        document.getElementById('khatmah-dashboard').style.display = 'block';
        KhatmahManager.updateUI();
    },

    updateUI: () => {
        if (!KhatmahManager.plan) return;

        // 1. ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ÿØÿßŸäÿ© ŸäŸàŸÖ ÿ¨ÿØŸäÿØ ÿ£Ÿà ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÜŸÇÿ∑ÿ© ÿßÿ±ÿ™ŸÉÿßÿ≤
        const todayStr = new Date().toDateString();
        // ÿ•ÿ∞ÿß ÿ™ÿ∫Ÿäÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ£Ÿà ŸÑŸÖ ÿ™ŸÉŸÜ startPage ŸÖÿπÿ±ŸÅÿ©ÿå ŸÜŸÇŸàŸÖ ÿ®ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿßÿ±ÿ™ŸÉÿßÿ≤
        if (KhatmahManager.plan.dailyTasks.date !== todayStr || typeof KhatmahManager.plan.dailyTasks.startPage === 'undefined') {
            KhatmahManager.plan.dailyTasks = {
                date: todayStr,
                // ŸÜÿ®ÿØÿ£ ÿßŸÑŸäŸàŸÖ ŸÖŸÜ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© (ŸÖŸáŸÖÿß ŸÉÿßŸÜÿ™)
                startPage: KhatmahManager.plan.currentPage,
                prayers: { Fajr: false, Dhuhr: false, Asr: false, Maghrib: false, Isha: false }
            };
            KhatmahManager.save();
        }

        // 2. ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©
        const percent = Math.round((KhatmahManager.plan.currentPage / 604) * 100);
        document.getElementById('khatmah-percent').innerText = `${percent}%`;
        document.getElementById('khatmah-progress-circle').setAttribute('stroke-dasharray', `${percent}, 100`);
        
        document.getElementById('target-days').innerText = KhatmahManager.plan.totalDays;
        document.getElementById('current-page-display').innerText = KhatmahManager.plan.currentPage;
        
        const endDate = new Date(KhatmahManager.plan.targetDate);
        document.getElementById('end-date-display').innerText = endDate.toLocaleDateString('ar-EG');

        // 3. ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸàÿ±ÿØ ÿßŸÑŸäŸàŸÖŸä (ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿßÿ±ÿ™ŸÉÿßÿ≤ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ© startPage)
        // Ÿáÿ∞ÿß Ÿäÿ∂ŸÖŸÜ ÿ£ŸÜ ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ŸÑÿß Ÿäÿ™ÿ∫Ÿäÿ± ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸäŸàŸÖ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        const startOfToday = KhatmahManager.plan.dailyTasks.startPage;
        const remainingPages = 604 - startOfToday; // ÿßŸÑŸÖÿ™ÿ®ŸÇŸä ŸÖŸÜ ÿ®ÿØÿßŸäÿ© ÿßŸÑŸäŸàŸÖ
        
        const today = new Date();
        const target = new Date(KhatmahManager.plan.targetDate);
        // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ© (ŸÑÿß ŸäŸÇŸÑ ÿπŸÜ 1 ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑŸÇÿ≥ŸÖÿ© ÿπŸÑŸâ ÿµŸÅÿ±)
        let remainingDays = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
        if (remainingDays < 1) remainingDays = 1;
        
        const dailyQuota = Math.ceil(remainingPages / remainingDays);
        const pagesPerPrayer = Math.ceil(dailyQuota / 5);

        // ÿ™ÿ≠ÿØŸäÿØ ŸÜÿ∑ÿßŸÇ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ŸÑŸÑŸäŸàŸÖ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
        const dayStartPage = startOfToday + 1;
        const dayEndPage = Math.min(604, startOfToday + dailyQuota);
        document.getElementById('daily-range').innerText = `ŸÖŸÜ ÿµŸÄ ${dayStartPage} ÿ•ŸÑŸâ ÿµŸÄ ${dayEndPage}`;

        // 4. ÿ±ÿ≥ŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        const list = document.getElementById('khatmah-prayers-list');
        list.innerHTML = '';

        const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        const prayerNames = {'Fajr':'ÿßŸÑŸÅÿ¨ÿ±', 'Dhuhr':'ÿßŸÑÿ∏Ÿáÿ±', 'Asr':'ÿßŸÑÿπÿµÿ±', 'Maghrib':'ÿßŸÑŸÖÿ∫ÿ±ÿ®', 'Isha':'ÿßŸÑÿπÿ¥ÿßÿ°'};
        
        // ÿπÿØÿßÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ Ÿäÿ®ÿØÿ£ ŸÖŸÜ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿßÿ±ÿ™ŸÉÿßÿ≤ ÿßŸÑÿ´ÿßÿ®ÿ™ÿ©
        let pageCounter = startOfToday + 1;

        prayers.forEach(prayer => {
            const isDone = KhatmahManager.plan.dailyTasks.prayers[prayer];
            const pStart = pageCounter;
            let pEnd = pageCounter + pagesPerPrayer - 1;
            
            // ÿ™ÿµÿ≠Ÿäÿ≠ ÿßŸÑŸÜŸáÿßŸäÿ© ÿ•ÿ∞ÿß ÿ™ÿ¨ÿßŸàÿ≤ÿ™ ÿßŸÑŸÖÿµÿ≠ŸÅ ÿ£Ÿà ŸáÿØŸÅ ÿßŸÑŸäŸàŸÖ
            if (pEnd > dayEndPage) pEnd = dayEndPage; 
            
            // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿµŸÅÿ≠ÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑŸàŸÇÿ™ ÿ™ÿ™ÿ¨ÿßŸàÿ≤ ŸáÿØŸÅ ÿßŸÑŸäŸàŸÖÿå ŸÜÿ¨ÿπŸÑŸáÿß ŸÅÿßÿ±ÿ∫ÿ© ÿ£Ÿà ŸÜŸàŸÇŸÅŸáÿß
            // (ÿ•ÿµŸÑÿßÿ≠: ŸÜÿ∏Ÿáÿ±Ÿáÿß ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿµŸÅÿ≠ÿßÿ™ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ©)
            if (pStart <= 604 && pStart <= dayEndPage) {
                const count = pEnd - pStart + 1;
                
                const div = document.createElement('div');
                div.className = `khatmah-task-row ${isDone ? 'completed' : ''}`;
                // ŸÜŸÖÿ±ÿ± ÿßŸÑÿπÿØÿØ ÿßŸÑŸÖÿ≠ÿØÿØ ŸÑŸáÿ∞Ÿá ÿßŸÑÿµŸÑÿßÿ©
                div.onclick = () => KhatmahManager.toggleTask(prayer, count);
                
                div.innerHTML = `
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="task-checkbox">
                            ${isDone ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                        <div>
                            <div style="font-weight:bold">ÿ®ÿπÿØ ÿµŸÑÿßÿ© ${prayerNames[prayer]}</div>
                            <div style="font-size:0.8rem; opacity:0.7">ÿßŸÇÿ±ÿ£ ${count} ÿµŸÅÿ≠ÿßÿ™ (ÿµŸÄ ${pStart} - ${pEnd})</div>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            }
            
            pageCounter = pEnd + 1;
        });
    },

    toggleTask: (prayer, pagesCount) => {
        SoundManager.playClick();
        
        const isCurrentlyDone = KhatmahManager.plan.dailyTasks.prayers[prayer];
        
        // ÿπŸÉÿ≥ ÿßŸÑÿ≠ÿßŸÑÿ©
        KhatmahManager.plan.dailyTasks.prayers[prayer] = !isCurrentlyDone;
        
        if (!isCurrentlyDone) {
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™ (ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤)
            KhatmahManager.plan.currentPage += pagesCount;
            NotificationManager.show(`ÿ£ÿ≠ÿ≥ŸÜÿ™! ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÇÿ±ÿßÿ°ÿ© ${pagesCount} ÿµŸÅÿ≠ÿ©`);
            AchievementManager.increment('quranMinutes', 5);
        } else {
            // ÿÆÿµŸÖ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ (ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤)
            KhatmahManager.plan.currentPage -= pagesCount;
        }

        // ÿ≠ÿØŸàÿØ ÿßŸÑÿ£ŸÖÿßŸÜ
        if (KhatmahManager.plan.currentPage > 604) KhatmahManager.plan.currentPage = 604;
        if (KhatmahManager.plan.currentPage < 0) KhatmahManager.plan.currentPage = 0;

        KhatmahManager.save();
        // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ≥Ÿäÿ≥ÿ™ÿÆÿØŸÖ startPage ÿßŸÑÿ´ÿßÿ®ÿ™ÿå ŸÑÿ∞ÿß ŸÑŸÜ ÿ™ÿ™ÿ∫Ÿäÿ± ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ©
        KhatmahManager.updateUI();

        if (KhatmahManager.plan.currentPage >= 604) {
            KhatmahManager.finishKhatmah();
        }
    },

    updateManualPage: () => {
        const newPage = prompt("ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿ¢ÿÆÿ± ÿµŸÅÿ≠ÿ© ŸàÿµŸÑÿ™ ÿ•ŸÑŸäŸáÿß:", KhatmahManager.plan.currentPage);
        if (newPage && !isNaN(newPage) && newPage >= 0 && newPage <= 604) {
            KhatmahManager.plan.currentPage = parseInt(newPage);
            
            // ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑŸäÿØŸàŸäÿå Ÿäÿ¨ÿ® ÿ™ÿ≠ÿØŸäÿ´ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿßÿ±ÿ™ŸÉÿßÿ≤ ŸÑŸÑŸäŸàŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑÿ™ÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            // Ÿàÿ•ŸÑÿß ÿ≥ÿ™ÿ∏Ÿáÿ± ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©
            KhatmahManager.plan.dailyTasks.startPage = parseInt(newPage);
            // ÿ™ÿµŸÅŸäÿ± ŸÖŸáÿßŸÖ ÿßŸÑŸäŸàŸÖ ŸÑÿ£ŸÜŸÜÿß ÿ∫Ÿäÿ±ŸÜÿß ÿßŸÑŸÖŸÉÿßŸÜ
            KhatmahManager.plan.dailyTasks.prayers = { Fajr: false, Dhuhr: false, Asr: false, Maghrib: false, Isha: false };
            
            KhatmahManager.save();
            KhatmahManager.updateUI();
            NotificationManager.show("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅÿ≠ÿ© ŸäÿØŸàŸäÿßŸã");
        }
    },

    finishKhatmah: () => {
        NotificationManager.show("üéâ ŸÖÿß ÿ¥ÿßÿ° ÿßŸÑŸÑŸá! ŸÖÿ®ÿßÿ±ŸÉ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿÆÿ™ŸÖÿ©");
        if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
    },

    deletePlan: () => {
        if(confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿÆÿ∑ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©ÿü")) {
            localStorage.removeItem('khatmahPlan');
            KhatmahManager.plan = null;
            KhatmahManager.init();
            NotificationManager.show("ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿÆÿ∑ÿ©");
        }
    },

    save: () => {
        localStorage.setItem('khatmahPlan', JSON.stringify(KhatmahManager.plan));
    }
};


        // ==================== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ====================
document.addEventListener('DOMContentLoaded', () => {
    // 1. ÿ£ŸàŸÑ ÿ¥Ÿäÿ°: ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
    initMethodSelects();
    
    // 2. ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ Ÿàÿ™ÿ∑ÿ®ŸäŸÇŸáÿß (ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ÿßŸÑÿ∑ŸÇÿ≥)
    SettingsManager.load();
    
    // 3. ÿ®ÿßŸÇŸä ÿßŸÑÿ™ŸáŸäÿ¶ÿ©
    CityManager.initCities();
    SetupManager.checkFirstRun(); 
    ClockManager.start();
    KhatmahManager.init(); // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ© ŸÅŸä ÿßŸÑŸÉŸàÿØ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ
    
    PrayerManager.fetchData();
    CalendarManager.updateMonthDisplay();
    DhikrManager.loadFromStorage();
    DuaManager.loadDuas();
    EventManager.loadEvents();
    CardManager.loadBackgrounds();
    QuizManager.newQuiz();
    PrayerTrackerManager.init();
    AchievementManager.init();
    QuranManager.init();
    
    // ÿßŸÑÿ∑ŸÇÿ≥ Ÿäÿ™ŸÖ ÿ•ÿØÿßÿ±ÿ™Ÿá ÿßŸÑÿ¢ŸÜ ÿπÿ®ÿ± SettingsManager.loadÿå ŸÑŸÉŸÜ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿØŸàÿ±Ÿä:
    if(AppState.weatherEnabled) {
        setInterval(WeatherManager.fetch, 30 * 60 * 1000);
    }
    
    document.querySelectorAll('.nav-sub-item').forEach(item => {
        item.addEventListener('click', function() {
            const page = this.dataset.page;
            PageManager.navigateTo(page);
        });
    });
    // ÿØÿßÿÆŸÑ script.js
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then((registration) => {
            console.log('Service Worker ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑŸá ÿ®ŸÜÿ¨ÿßÿ≠:', registration);
            
            // ÿ∑ŸÑÿ® ÿ•ÿ∞ŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÅŸàÿ± ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿ£Ÿà ÿπŸÜÿØ ÿ≤ÿ± ŸÖÿπŸäŸÜ
            Notification.requestPermission().then((permission) => {
                if (permission === 'granted') {
                    console.log('ÿ™ŸÖ ŸÖŸÜÿ≠ ÿ•ÿ∞ŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™');
                    // ŸáŸÜÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ ŸÅŸä Push Manager ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑÿØŸäŸÉ ÿ≥Ÿäÿ±ŸÅÿ±
                }
            });
        })
        .catch((error) => {
            console.log('ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ Service Worker:', error);
        });
}

    // ÿ•ÿ∂ÿßŸÅÿ© Save Settings ŸÉÿ•ÿ¨ÿ±ÿßÿ° ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÑŸÑÿ≤ÿ± ÿßŸÑŸÖŸàÿ¨ŸàÿØ ÿ£ÿ≥ŸÅŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    window.saveSettings = () => {
        SettingsManager.save();
        NotificationManager.show("ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸäÿØŸàŸäÿßŸã");
    };
    
    CompassManager.init();
    
    setTimeout(() => {
        LoaderManager.hide();
    }, 1500);
});

// ==================== ÿ™ŸÉÿßŸÖŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿµŸÑŸä (Native Integration) ====================

// ÿØÿßŸÑÿ© ŸÑÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ•ÿ∂ÿßŸÅÿ© Capacitor
async function scheduleNativeNotifications() {
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÉÿßÿ®ÿßÿ≥Ÿäÿ™Ÿàÿ±
    if (typeof Capacitor === 'undefined') return;

    const { LocalNotifications } = Capacitor.Plugins;

    // 1. ÿ∑ŸÑÿ® ÿ•ÿ∞ŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
    const perm = await LocalNotifications.requestPermissions();
    if (perm.display !== 'granted') return;

    // 2. ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©
    const pending = await LocalNotifications.getPending();
    if (pending.notifications.length > 0) {
        await LocalNotifications.cancel(pending);
    }

    if (!AppState.times) return;

    const notifications = [];
    let idCounter = 1;
    const now = new Date();

    // 3. ÿ™ÿ¨ŸáŸäÿ≤ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÑŸÑÿµŸÑŸàÿßÿ™ ÿßŸÑŸÇÿßÿØŸÖÿ©
    Constants.prayerKeys.forEach(key => {
        if (key === 'Sunrise') return; // ŸÑÿß ŸÜÿ§ÿ∞ŸÜ ŸÑŸÑÿ¥ÿ±ŸàŸÇ

        const timeStr = AppState.times[key]; // "15:30"
        const [hours, minutes] = timeStr.split(':').map(Number);
        
        const scheduleDate = new Date();
        scheduleDate.setHours(hours, minutes, 0);

        // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸàŸÇÿ™ ŸÇÿØ ŸÅÿßÿ™ ÿßŸÑŸäŸàŸÖÿå ŸÜÿ¨ÿØŸàŸÑŸáÿß ŸÑÿ∫ÿØŸç (ÿ£Ÿà ŸÜÿ™ÿ¨ÿßŸáŸÑŸáÿß ÿ≠ÿßŸÑŸäÿßŸã ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑)
        if (scheduleDate <= now) {
            scheduleDate.setDate(scheduleDate.getDate() + 1);
        }

        notifications.push({
            id: idCounter++,
            title: "ÿ≠ÿßŸÜ ŸàŸÇÿ™ ÿßŸÑÿµŸÑÿßÿ©",
            body: `ÿ≠Ÿä ÿπŸÑŸâ ÿßŸÑÿµŸÑÿßÿ©: ŸÖŸàÿπÿØ ÿµŸÑÿßÿ© ${Constants.prayerNames[key]}`,
            schedule: { at: scheduleDate },
            sound: "adhan.mp3", // ÿ≥ŸäÿπŸÖŸÑ ŸÑÿ£ŸÜŸÜÿß ŸÜÿ≥ÿÆŸÜÿß ÿßŸÑŸÖŸÑŸÅ ŸÅŸä android.yml
            smallIcon: "ic_stat_icon_config_sample", // ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            actionTypeId: "",
            extra: null
        });
    });

    // 4. ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ¨ÿØŸàŸÑÿ©
    if (notifications.length > 0) {
        await LocalNotifications.schedule({ notifications });
        console.log('ÿ™ŸÖ ÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿµŸÑŸàÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÑŸÑŸÜÿ∏ÿßŸÖ');
        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑
        // NotificationManager.show("ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ£ÿ∞ÿßŸÜ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©");
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ∑ŸÑÿ® ÿ•ÿ∞ŸÜ ÿßŸÑŸÖŸàŸÇÿπ ÿ®ÿ¥ŸÉŸÑ ÿµÿ±Ÿäÿ≠ ÿπŸÜÿØ ÿßŸÑŸÅÿ™ÿ≠
async function requestNativeLocation() {
    if (typeof Capacitor !== 'undefined' && Capacitor.Plugins.Geolocation) {
        try {
            const permission = await Capacitor.Plugins.Geolocation.requestPermissions();
            if(permission.location === 'granted') {
                CityManager.detectLocation(); // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿØÿßŸÑÿ™ŸÉ ÿßŸÑÿ£ÿµŸÑŸäÿ©
            }
        } catch (e) {
            console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿ∑ŸÑÿ® ÿ•ÿ∞ŸÜ ÿßŸÑŸÖŸàŸÇÿπ", e);
        }
    }
}

// ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑÿ¨ÿØŸäÿØÿ© ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        requestNativeLocation(); // ÿ∑ŸÑÿ® ÿßŸÑŸÖŸàŸÇÿπ ŸÅŸàÿ±ÿßŸã
    }, 2000);
});

// ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¨ÿØŸàŸÑÿ© ŸÉŸÑŸÖÿß ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸàÿßŸÇŸäÿ™
const originalRenderHome = PrayerManager.renderHome;
PrayerManager.renderHome = function() {
    originalRenderHome(); // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ ÿßŸÑŸÇÿØŸäŸÖ
    scheduleNativeNotifications(); // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¨ÿØŸàŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
};
